{"remainingRequest":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js!C:\\k1-services\\src\\services\\jwt.js","dependencies":[{"path":"C:\\k1-services\\src\\services\\jwt.js","mtime":1670977910675},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js","mtime":1670977935138}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZXhwb3J0IGRlZmF1bHQgY2xhc3MgSldUIHsKICBjb25zdHJ1Y3Rvcih0b2tlbikgewogICAgdGhpcy50b2tlbiA9IHRva2VuIHx8ICIiOwogICAgdGhpcy5jb25maWd1cmVhbGwoKTsKICB9CgogIGFkZHRva2VuKHRva2VuKSB7CiAgICB0aGlzLnRva2VuID0gdG9rZW47CiAgICB0aGlzLmNvbmZpZ3VyZWFsbCgpOwogIH0KCiAgY29uZmlndXJlYWxsKCkgewogICAgaWYgKHRoaXMudG9rZW4pIHsKICAgICAgdGhpcy50b2tlblBheWxvYWQgPSB0aGlzLnBhcnNlUGF5bG9hZCh0aGlzLnRva2VuKTsKICAgICAgdGhpcy50b2tlbklzVmFsaWQgPSB0aGlzLmlzVG9rZW5WYWxpZCh0aGlzLnRva2VuKTsKICAgICAgdGhpcy50b2tlbk9iamVjdCA9IHRoaXMuZ2V0UGFyc2VkVG9rZW4odGhpcy50b2tlbik7CiAgICB9CiAgfQoKICBwYXJzZVBheWxvYWQodG9rZW4pIHsKICAgIGxldCBwYXlsb2FkID0gbnVsbDsKCiAgICBpZiAodG9rZW4pIHsKICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCIuIilbMV07CiAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgvLS9nLCAiKyIpLnJlcGxhY2UoL18vZywgIi8iKTsKICAgICAgdmFyIGpzb25QYXlsb2FkID0gZGVjb2RlVVJJQ29tcG9uZW50KGF0b2IoYmFzZTY0KS5zcGxpdCgiIikubWFwKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuICIlIiArICgiMDAiICsgYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpOwogICAgICB9KS5qb2luKCIiKSk7CiAgICAgIGpzb25QYXlsb2FkLnJlcGxhY2UoImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZS8iLCAic3Fscm9sZXMiKTsKICAgICAgY29uc29sZS5sb2coIkpXVC5wYXJzZVBheWxvYWQ6IiwganNvblBheWxvYWQpOwogICAgICBwYXlsb2FkID0gSlNPTi5wYXJzZShqc29uUGF5bG9hZCk7CiAgICB9IC8vIGNvbnNvbGUubG9nKCdKd3RTZXJ2aWNlLnBhcnNlUGF5bG9hZDonLCBwYXlsb2FkKQoKCiAgICByZXR1cm4gcGF5bG9hZDsKICB9CgogIGlzVG9rZW5WYWxpZCh0b2tlbikgewogICAgaWYgKCF0b2tlbikgdG9rZW4gPSB0aGlzLmdldEF1dGhUb2tlbigpOwogICAgbGV0IGp3dCA9IHRoaXMucGFyc2VQYXlsb2FkKHRva2VuKTsKCiAgICBpZiAoIWp3dCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IERhdGUoand0LmV4cCAqIDEwMDApID4gbmV3IERhdGUoKTsKICAgIH0KICB9CgogIGdldFBhcnNlZFRva2VuKHRva2VuKSB7CiAgICBsZXQgcGF5bG9hZCA9IG51bGw7CiAgICBpZiAoIXRva2VuKSB0b2tlbiA9IHRoaXMuZ2V0QXV0aFRva2VuKCk7CiAgICBwYXlsb2FkID0gdGhpcy5wYXJzZVBheWxvYWQodG9rZW4pOwoKICAgIGlmIChwYXlsb2FkKSB7CiAgICAgIHBheWxvYWQuZXhwZGF0ZSA9IG5ldyBEYXRlKHBheWxvYWQuZXhwICogMTAwMCk7CiAgICAgIHBheWxvYWQuaXNleHBpcmVkID0gbmV3IERhdGUocGF5bG9hZC5leHAgKiAxMDAwKSA8IG5ldyBEYXRlKCk7CiAgICB9IC8vIGNvbnNvbGUubG9nKCJnZXRQYXJzZWRUb2tlbjoiLCBwYXlsb2FkKTsKCgogICAgcmV0dXJuIHBheWxvYWQ7CiAgfQoKfQ=="},{"version":3,"names":["JWT","constructor","token","configureall","addtoken","tokenPayload","parsePayload","tokenIsValid","isTokenValid","tokenObject","getParsedToken","payload","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","console","log","JSON","parse","getAuthToken","jwt","Date","exp","expdate","isexpired"],"sources":["C:/k1-services/src/services/jwt.js"],"sourcesContent":["export default class JWT {\r\n  constructor(token) {\r\n    this.token = token || \"\";\r\n    this.configureall();\r\n  }\r\n\r\n  addtoken(token) {\r\n    this.token = token;\r\n    this.configureall();\r\n  }\r\n\r\n  configureall() {\r\n    if (this.token) {\r\n      this.tokenPayload = this.parsePayload(this.token);\r\n      this.tokenIsValid = this.isTokenValid(this.token);\r\n      this.tokenObject = this.getParsedToken(this.token);\r\n    }\r\n  }\r\n\r\n  parsePayload(token) {\r\n    let payload = null;\r\n\r\n    if (token) {\r\n      var base64Url = token.split(\".\")[1];\r\n      var base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n      var jsonPayload = decodeURIComponent(\r\n        atob(base64)\r\n          .split(\"\")\r\n          .map(function(c) {\r\n            return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\r\n          })\r\n          .join(\"\")\r\n      );\r\n      jsonPayload.replace(\r\n        \"http://schemas.microsoft.com/ws/2008/06/identity/claims/role/\",\r\n        \"sqlroles\"\r\n      );\r\n      console.log(\"JWT.parsePayload:\", jsonPayload);\r\n      payload = JSON.parse(jsonPayload);\r\n    }\r\n\r\n    // console.log('JwtService.parsePayload:', payload)\r\n\r\n    return payload;\r\n  }\r\n\r\n  isTokenValid(token) {\r\n    if (!token) token = this.getAuthToken();\r\n\r\n    let jwt = this.parsePayload(token);\r\n\r\n    if (!jwt) {\r\n      return false;\r\n    } else {\r\n      return new Date(jwt.exp * 1000) > new Date();\r\n    }\r\n  }\r\n\r\n  getParsedToken(token) {\r\n    let payload = null;\r\n\r\n    if (!token) token = this.getAuthToken();\r\n\r\n    payload = this.parsePayload(token);\r\n\r\n    if (payload) {\r\n      payload.expdate = new Date(payload.exp * 1000);\r\n      payload.isexpired = new Date(payload.exp * 1000) < new Date();\r\n    }\r\n\r\n    // console.log(\"getParsedToken:\", payload);\r\n\r\n    return payload;\r\n  }\r\n}\r\n"],"mappings":"AAAA,eAAe,MAAMA,GAAN,CAAU;EACvBC,WAAW,CAACC,KAAD,EAAQ;IACjB,KAAKA,KAAL,GAAaA,KAAK,IAAI,EAAtB;IACA,KAAKC,YAAL;EACD;;EAEDC,QAAQ,CAACF,KAAD,EAAQ;IACd,KAAKA,KAAL,GAAaA,KAAb;IACA,KAAKC,YAAL;EACD;;EAEDA,YAAY,GAAG;IACb,IAAI,KAAKD,KAAT,EAAgB;MACd,KAAKG,YAAL,GAAoB,KAAKC,YAAL,CAAkB,KAAKJ,KAAvB,CAApB;MACA,KAAKK,YAAL,GAAoB,KAAKC,YAAL,CAAkB,KAAKN,KAAvB,CAApB;MACA,KAAKO,WAAL,GAAmB,KAAKC,cAAL,CAAoB,KAAKR,KAAzB,CAAnB;IACD;EACF;;EAEDI,YAAY,CAACJ,KAAD,EAAQ;IAClB,IAAIS,OAAO,GAAG,IAAd;;IAEA,IAAIT,KAAJ,EAAW;MACT,IAAIU,SAAS,GAAGV,KAAK,CAACW,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAhB;MACA,IAAIC,MAAM,GAAGF,SAAS,CAACG,OAAV,CAAkB,IAAlB,EAAwB,GAAxB,EAA6BA,OAA7B,CAAqC,IAArC,EAA2C,GAA3C,CAAb;MACA,IAAIC,WAAW,GAAGC,kBAAkB,CAClCC,IAAI,CAACJ,MAAD,CAAJ,CACGD,KADH,CACS,EADT,EAEGM,GAFH,CAEO,UAASC,CAAT,EAAY;QACf,OAAO,MAAM,CAAC,OAAOA,CAAC,CAACC,UAAF,CAAa,CAAb,EAAgBC,QAAhB,CAAyB,EAAzB,CAAR,EAAsCC,KAAtC,CAA4C,CAAC,CAA7C,CAAb;MACD,CAJH,EAKGC,IALH,CAKQ,EALR,CADkC,CAApC;MAQAR,WAAW,CAACD,OAAZ,CACE,+DADF,EAEE,UAFF;MAIAU,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCV,WAAjC;MACAL,OAAO,GAAGgB,IAAI,CAACC,KAAL,CAAWZ,WAAX,CAAV;IACD,CApBiB,CAsBlB;;;IAEA,OAAOL,OAAP;EACD;;EAEDH,YAAY,CAACN,KAAD,EAAQ;IAClB,IAAI,CAACA,KAAL,EAAYA,KAAK,GAAG,KAAK2B,YAAL,EAAR;IAEZ,IAAIC,GAAG,GAAG,KAAKxB,YAAL,CAAkBJ,KAAlB,CAAV;;IAEA,IAAI,CAAC4B,GAAL,EAAU;MACR,OAAO,KAAP;IACD,CAFD,MAEO;MACL,OAAO,IAAIC,IAAJ,CAASD,GAAG,CAACE,GAAJ,GAAU,IAAnB,IAA2B,IAAID,IAAJ,EAAlC;IACD;EACF;;EAEDrB,cAAc,CAACR,KAAD,EAAQ;IACpB,IAAIS,OAAO,GAAG,IAAd;IAEA,IAAI,CAACT,KAAL,EAAYA,KAAK,GAAG,KAAK2B,YAAL,EAAR;IAEZlB,OAAO,GAAG,KAAKL,YAAL,CAAkBJ,KAAlB,CAAV;;IAEA,IAAIS,OAAJ,EAAa;MACXA,OAAO,CAACsB,OAAR,GAAkB,IAAIF,IAAJ,CAASpB,OAAO,CAACqB,GAAR,GAAc,IAAvB,CAAlB;MACArB,OAAO,CAACuB,SAAR,GAAoB,IAAIH,IAAJ,CAASpB,OAAO,CAACqB,GAAR,GAAc,IAAvB,IAA+B,IAAID,IAAJ,EAAnD;IACD,CAVmB,CAYpB;;;IAEA,OAAOpB,OAAP;EACD;;AAzEsB"}]}