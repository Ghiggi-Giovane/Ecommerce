{"remainingRequest":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js!C:\\k1-services\\src\\store\\anon.js","dependencies":[{"path":"C:\\k1-services\\src\\store\\anon.js","mtime":1701905648766},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js","mtime":1670977935138}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgSnd0U2VydmljZSBmcm9tICIuLi9zZXJ2aWNlcy9qd3Quc2VydmljZSI7CmltcG9ydCBBcGlTZXJ2aWNlIGZyb20gIi4uL3NlcnZpY2VzL2FwaS5zZXJ2aWNlIjsKaW1wb3J0IFZ1ZUNvb2tpZXMgZnJvbSAidnVlLWNvb2tpZXMiOwpsZXQgbHNBbm9uID0gSnd0U2VydmljZS5nZXRMb2dpbkFub24oKTsKaWYgKCFsc0Fub24pIGxzQW5vbiA9IHsKICB0b2tlbjogbnVsbCwKICBhdXRoOiBmYWxzZSwKICBsYXN0TG9naW46IG51bGwKfTsKCi8vIHNlIGVzdMOhIGV4cGlyYWRvIGxpbXBhIG9zIGRhZG9zIC4uLgppZiAobHNBbm9uICYmIGxzQW5vbi52YWxpZGF0ZSA8IG5ldyBEYXRlKCkpIGxzQW5vbiA9IHsKICB0b2tlbjogbnVsbCwKICBhdXRoOiBmYWxzZSwKICBsYXN0TG9naW46IG51bGwKfTsKY29uc3Qgc3RhdGUgPSB7CiAgbG9naW5Bbm9uOiB7CiAgICB0b2tlbjogbHNBbm9uLnRva2VuIHx8IG51bGwsCiAgICBhdXRoOiBsc0Fub24uYXV0aCB8fCBmYWxzZSwKICAgIGxhc3RMb2dpbjogbHNBbm9uLmxhc3RMb2dpbiB8fCBudWxsLAogICAgdmFsaWRhdGU6IGxzQW5vbi52YWxpZGF0ZSB8fCBudWxsCiAgfQp9Owpjb25zdCBnZXR0ZXJzID0gewogIGd0eEFub25Ub2tlbjogc3RhdGUgPT4gc3RhdGUubG9naW5Bbm9uLnRva2VuLAogIGd0eGxvZ2luQW5vbjogc3RhdGUgPT4gc3RhdGUubG9naW5Bbm9uLAogIGd0eFN5c3RlbUFub25Ub2tlbjogc3RhdGUgPT4gc3RhdGUuc3lzdGVtLmFub25Ub2tlbgp9Owpjb25zdCBtdXRhdGlvbnMgPSB7CiAgc2V0TG9naW5Bbm9uOiAoc3RhdGUsIGp3dCkgPT4gewogICAgc3RhdGUubG9naW5Bbm9uLnRva2VuID0gand0ID8gand0LnRva2VuIHx8ICIiIDogIiI7CiAgICBzdGF0ZS5sb2dpbkFub24uYXV0aCA9IGp3dCA/IHRydWUgOiBmYWxzZTsKICAgIHN0YXRlLmxvZ2luQW5vbi5sYXN0TG9naW4gPSBuZXcgRGF0ZSgpOwogICAgc3RhdGUubG9naW5Bbm9uLnZhbGlkYXRlID0gand0ID8gbmV3IERhdGUoand0LmV4cCkgKiAxMDAwIDogMDsKICAgIHN0YXRlLmxvZ2luQW5vbi5wYXlsb2FkID0gand0ID8gand0LnBheWxvYWQgfHwgbnVsbCA6IG51bGw7CgogICAgLy8gY29uc29sZS5sb2coJ3NldExvZ2luQW5vbicsIHN0YXRlLmxvZ2luQW5vbikKICB9LAoKICBzZXRMb2dpbkFub25PZmY6IHN0YXRlID0+IHsKICAgIHN0YXRlLmxvZ2luQW5vbi50b2tlbiA9ICIiOwogICAgc3RhdGUubG9naW5Bbm9uLmF1dGggPSBmYWxzZTsKCiAgICAvLyByZW1vdmUgbm8gbG9jYWxTdG9yYWdlIC4uLgogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImxvZ2luQW5vbiIpOwogIH0sCiAgc2V0QW5vblRva2VuOiBzdGF0ZSA9PiB7CiAgICBzdGF0ZS5zeXN0ZW0uYW5vblRva2VuID0gQXBpU2VydmljZS5nZXQoIkF1dGhlbnRpY2F0aW9uL0dldEFub255bW91c1Rva2VuIikudGhlbih0b2tlbiA9PiB0b2tlbik7CiAgfQp9Owpjb25zdCBhY3Rpb25zID0gewogIGFjdExvZ2luQW5vbjogYXN5bmMgc3RhdGUgPT4gewogICAgLy9jb25zb2xlLmxvZygnSnd0U2VydmljZS5nZXRBbm9uVG9rZW4oKTonKSwgSnd0U2VydmljZS5nZXRBbm9uVG9rZW4oKTsKICAgIC8vY29uc29sZS5sb2coJ0p3dFNlcnZpY2UuaXNUb2tlblZhbGlkKCk6JyksIEp3dFNlcnZpY2UuaXNUb2tlblZhbGlkKCk7CiAgICAvL2lmICghSnd0U2VydmljZS5pc1Rva2VuVmFsaWQoSnd0U2VydmljZS5nZXRBbm9uVG9rZW4oKSkpIHsKICAgIEFwaVNlcnZpY2Uuc2V0QmFzaWNIZWFkZXIoKTsKICAgIGF3YWl0IEFwaVNlcnZpY2UucG9zdCgiQXV0aGVudGljYXRpb24vR2V0QW5vbnltb3VzVG9rZW4iKS50aGVuKHJlcyA9PiB7CiAgICAgIGxldCB0b2tlbiA9IHsKICAgICAgICB0b2tlbjogcmVzLmRhdGEuVG9rZW5BY2Nlc3MKICAgICAgfTsKICAgICAgbGV0IHBheWxvYWQgPSBKd3RTZXJ2aWNlLnBhcnNlUGF5bG9hZChyZXMuZGF0YS5Ub2tlbkFjY2Vzcyk7CiAgICAgIGlmIChwYXlsb2FkKSB7CiAgICAgICAgdG9rZW4uZXhwID0gcGF5bG9hZC5leHA7CiAgICAgICAgdG9rZW4ucGF5bG9hZCA9IHBheWxvYWQ7CiAgICAgIH0KCiAgICAgIC8vIGNvbnNvbGUubG9nKCdhY3RMb2dpbkFub246JywgdG9rZW4pCgogICAgICBzdGF0ZS5jb21taXQoInNldExvZ2luQW5vbiIsIHRva2VuKTsKICAgICAgQXBpU2VydmljZS5zYXZlU3RvcmUoImxvZ2luQW5vbiIsIHN0YXRlLnN0YXRlLmxvZ2luQW5vbik7CiAgICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQXV0aG9yaXphdGlvbiJdID0gYEJlYXJlciAke3Rva2VufWA7CiAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCJlcnJvcjogIiwgZXJyb3IpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYFtWVUVYXSAke2Vycm9yfWApOwogICAgfSk7CiAgICAvL30KICB9LAoKICBhY3RMb2dpbkFub25PZmY6IHN0YXRlID0+IHsKICAgIHN0YXRlLmNvbW1pdCgic2V0TG9naW5Bbm9uT2ZmIik7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgibG9naW5Bbm9uIik7CiAgfSwKICBhY3RBbm9uQXBpOiBzdGF0ZSA9PiB7CiAgICBzdGF0ZS5jb21taXQoInNldEFub25Ub2tlbiIpOwogIH0KfTsKCi8vIGJ1c2NhIG8gdG9rZW4gYW5vbmltbyBuYSBpbnN0YWxhw6fDo28gLi4uCgpleHBvcnQgZGVmYXVsdCB7CiAgc3RhdGUsCiAgbXV0YXRpb25zLAogIGdldHRlcnMsCiAgYWN0aW9ucwp9Ow=="},{"version":3,"names":["Vue","JwtService","ApiService","VueCookies","lsAnon","getLoginAnon","token","auth","lastLogin","validate","Date","state","loginAnon","getters","gtxAnonToken","gtxloginAnon","gtxSystemAnonToken","system","anonToken","mutations","setLoginAnon","jwt","exp","payload","setLoginAnonOff","localStorage","removeItem","setAnonToken","get","then","actions","actLoginAnon","setBasicHeader","post","res","data","TokenAccess","parsePayload","commit","saveStore","axios","defaults","headers","common","catch","error","console","log","Error","actLoginAnonOff","actAnonApi"],"sources":["C:/k1-services/src/store/anon.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport JwtService from \"../services/jwt.service\";\r\nimport ApiService from \"../services/api.service\";\r\nimport VueCookies from \"vue-cookies\";\r\n\r\nlet lsAnon = JwtService.getLoginAnon();\r\nif (!lsAnon) lsAnon = { token: null, auth: false, lastLogin: null };\r\n\r\n// se está expirado limpa os dados ...\r\nif (lsAnon && lsAnon.validate < new Date())\r\n  lsAnon = { token: null, auth: false, lastLogin: null };\r\n\r\nconst state = {\r\n  loginAnon: {\r\n    token: lsAnon.token || null,\r\n    auth: lsAnon.auth || false,\r\n    lastLogin: lsAnon.lastLogin || null,\r\n    validate: lsAnon.validate || null,\r\n  },\r\n};\r\n\r\nconst getters = {\r\n  gtxAnonToken: (state) => state.loginAnon.token,\r\n\r\n  gtxloginAnon: (state) => state.loginAnon,\r\n\r\n  gtxSystemAnonToken: (state) => state.system.anonToken,\r\n};\r\n\r\nconst mutations = {\r\n  setLoginAnon: (state, jwt) => {\r\n    state.loginAnon.token = jwt ? jwt.token || \"\" : \"\";\r\n    state.loginAnon.auth = jwt ? true : false;\r\n    state.loginAnon.lastLogin = new Date();\r\n    state.loginAnon.validate = jwt ? new Date(jwt.exp) * 1000 : 0;\r\n    state.loginAnon.payload = jwt ? jwt.payload || null : null;\r\n\r\n    // console.log('setLoginAnon', state.loginAnon)\r\n  },\r\n\r\n  setLoginAnonOff: (state) => {\r\n    state.loginAnon.token = \"\";\r\n    state.loginAnon.auth = false;\r\n\r\n    // remove no localStorage ...\r\n    localStorage.removeItem(\"loginAnon\");\r\n  },\r\n\r\n  setAnonToken: (state) => {\r\n    state.system.anonToken = ApiService.get(\r\n      \"Authentication/GetAnonymousToken\"\r\n    ).then((token) => token);\r\n  },\r\n};\r\n\r\nconst actions = {\r\n  actLoginAnon: async (state) => {\r\n    //console.log('JwtService.getAnonToken():'), JwtService.getAnonToken();\r\n    //console.log('JwtService.isTokenValid():'), JwtService.isTokenValid();\r\n    //if (!JwtService.isTokenValid(JwtService.getAnonToken())) {\r\n      ApiService.setBasicHeader();\r\n      await ApiService.post(\"Authentication/GetAnonymousToken\")\r\n        .then((res) => {\r\n          let token = { token: res.data.TokenAccess };\r\n\r\n          let payload = JwtService.parsePayload(res.data.TokenAccess);\r\n\r\n          if (payload) {\r\n            token.exp = payload.exp;\r\n            token.payload = payload;\r\n          }\r\n\r\n          // console.log('actLoginAnon:', token)\r\n\r\n          state.commit(\"setLoginAnon\", token);\r\n\r\n          ApiService.saveStore(\"loginAnon\", state.state.loginAnon);\r\n\r\n          Vue.axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n        })\r\n        .catch((error) => {\r\n          console.log(\"error: \", error);\r\n\r\n          throw new Error(`[VUEX] ${error}`);\r\n        });\r\n    //}\r\n  },\r\n\r\n  actLoginAnonOff: (state) => {\r\n    state.commit(\"setLoginAnonOff\");\r\n    localStorage.removeItem(\"loginAnon\");\r\n  },\r\n\r\n  actAnonApi: (state) => {\r\n    state.commit(\"setAnonToken\");\r\n  },\r\n};\r\n\r\n// busca o token anonimo na instalação ...\r\n\r\nexport default { state, mutations, getters, actions };\r\n"],"mappings":"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"}]}