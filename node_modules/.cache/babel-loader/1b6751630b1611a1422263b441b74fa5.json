{"remainingRequest":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js!C:\\k1-services\\src\\services\\api.service.js","dependencies":[{"path":"C:\\k1-services\\src\\services\\api.service.js","mtime":1670977910673},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js","mtime":1670977935138}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgVnVlQXhpb3MgZnJvbSAidnVlLWF4aW9zIjsKaW1wb3J0IEp3dFNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9qd3Quc2VydmljZSI7CmltcG9ydCBzdG9yZSBmcm9tICIuLi9zdG9yZSI7CmltcG9ydCB7IEFQSV9NT0RFTCwgQVBJX1VSTCwgQ09PS0lFX1RJTUVPVVQsIENPT0tJRV9BTk9OSU1PVVNUT0tFTiB9IGZyb20gIkAvc2VydmljZXMvY29uZmlnIjsKaW1wb3J0IGxvY2Fsc3RvcmUgZnJvbSAiQC9zZXJ2aWNlcy9sb2NhbHN0b3JlIjsgLy8gaW1wb3J0IFZ1ZUNvb2tpZXMgZnJvbSAidnVlLWNvb2tpZXMiOwovLyBpbXBvcnQgYXV0aCBmcm9tICJAL3N0b3JlL2F1dGgiOwoKaW1wb3J0IHJvdXRlciBmcm9tICIuLi9yb3V0ZXIiOwppbXBvcnQgT2JzZXJ2YWJsZSBmcm9tICIuL29ic2VydmFibGUiOyAvLyBuw6NvIHB1ZGUgdXNhciBvIFZ1ZUNvb2tpZXMgcG9pcyBlbGUgbsOjbyBlc3TDoSBjYXJyZWdhZG8gbmVzc2EgZXRhcGEgZG8gc2lzdGVtYSAuLi4KCmltcG9ydCBjb29raWVzIGZyb20gIi4vY29va2llIjsKaW1wb3J0IG1pbWVzIGZyb20gIi4uL2Fzc2V0cy9qc29uL21pbWV0eXBlcy5qc29uIjsKaW1wb3J0IExvY2FsYmFzZSBmcm9tICJsb2NhbGJhc2UiOwppbXBvcnQgand0U2VydmljZSBmcm9tICIuL2p3dC5zZXJ2aWNlIjsKY29uc3QgQXBpU2VydmljZSA9IHsKICAvL2NvbnN0cnVjdG9yKCkgewogIC8vICB0aGlzLmFwaW1vZGVsID0gQVBJX01PREVMOwogIC8vfSwKICAvLyBhcGltb2RlbCA9IEFQSV9NT0RFTCwKICBhcGltb2RlbDogewogICAgZ2V0KCkgewogICAgICByZXR1cm4gQVBJX01PREVMOwogICAgfQoKICB9LAogIGxvY2Fsc3RvcmVkYXRhOiBsb2NhbHN0b3JlLmdldFN0b3JlRGF0YSgpLAogIGVycm9yOiBbXSwKICAvLyBJTklDSU8gLSBvYnNlcnZhYmxlcyAuLi4KICBsb2FkT2JzZXJ2ZXI6IG5ldyBPYnNlcnZhYmxlKCksCiAgbG9naW5PYnNlcnZlcjogbmV3IE9ic2VydmFibGUoKSwKICBlcnJvck9ic2VydmVyOiBuZXcgT2JzZXJ2YWJsZSgpLAogIG5vdGlmeU9ic2VydmVyOiBuZXcgT2JzZXJ2YWJsZSgpLAogIGNoYXRPYnNlcnZlcjogbmV3IE9ic2VydmFibGUoKSwKICBhcGlSZXFPYnNlcnZlcjogbmV3IE9ic2VydmFibGUoKSwKICBhcGlSZW5ld1Rva2VuOiBuZXcgT2JzZXJ2YWJsZSgpLAogIC8vIEZJTSAtIG9ic2VydmFibGVzIC4uLgogIGxvY2FsREI6IG5ldyBMb2NhbGJhc2UoImRiIiksCgogIGluaXQoKSB7CiAgICBWdWUudXNlKFZ1ZUF4aW9zLCBheGlvcyk7CiAgICBWdWUuYXhpb3MuZGVmYXVsdHMuYmFzZVVSTCA9IEFQSV9VUkw7IC8vIFZ1ZS5heGlvcy5kZWZhdWx0cy53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOyAvLyBwYXJhIGF1dG9yaXphciBkb3dubG9hZHMgdmlhIGF4aW9zIGVycm86IG9icmlnb3UgYSB0ZXIgYXV0ZW50aWNhw6fDo28gZSBuw6NvIGNhcnJlZ2EgbWFpcyBhIHDDoWdpbmEgLi4uCgogICAgdGhpcy5zZXRCYXNpY0hlYWRlcigpOwogICAgdGhpcy5sb2NhbERCLmNvbmZpZy5kZWJ1ZyA9IGZhbHNlOyAvLyBjb25zb2xlLmxvZygnYXBpLnNlcnZpY2UuaW5pdDpoaXQnKQogICAgLy8gY29uc29sZS5sb2coJ0FQSVNlcnZpY2U6aW5pdC5sb2NhbHN0b3JlZGF0YTogJywgdGhpcy5sb2NhbHN0b3JlZGF0YSkKICAgIC8vIGNvbnNvbGUubG9nKCdBUElTZXJ2aWNlOmluaXQudXNlcm5hbWU6ICcsIEp3dFNlcnZpY2UuZ2V0VXNlck5hbWUoKSkKICB9LAoKICBnZXRMb2NhbERCRG9jdW1lbnQoY29sbGVjdGlvbiA9IFZ1ZS4kY29va2llcy5nZXQoImxhc3Rsb2dpbiIpIHx8ICdob3JsbGUnLCBrZXkpIHsKICAgIHJldHVybiB0aGlzLmxvY2FsREIuY29sbGVjdGlvbihjb2xsZWN0aW9uKS5kb2Moa2V5KS5nZXQoKTsKICB9LAoKICBzZXRMb2NhbERCRG9jdW1lbnQoZGF0YSwgY29sbGVjdGlvbiA9IFZ1ZS4kY29va2llcy5nZXQoImxhc3Rsb2dpbiIpIHx8ICdob3JsbGUnLCBrZXkpIHsKICAgIGNvbnNvbGUubG9nKFZ1ZS4kcm91dGUubmFtZSk7CgogICAgaWYgKGtleSkgewogICAgICB0aGlzLmxvY2FsREIuY29sbGVjdGlvbihjb2xsZWN0aW9uKS5hZGQoZGF0YSwga2V5KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubG9jYWxEQi5jb2xsZWN0aW9uKGNvbGxlY3Rpb24pLmFkZChkYXRhKTsKICAgIH0KICB9LAoKICBkZWxMb2NhbERCRG9jdW1lbnQoY29sbGVjdGlvbiwga2V5KSB7CiAgICB0aGlzLmxvY2FsREIuY29sbGVjdGlvbihjb2xsZWN0aW9uKS5kb2Moa2V5KS5kZWxldGUoKTsKICB9LAoKICBzZXRCYXNpY0hlYWRlcigpIHsKICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luIl0gPSAiKiI7CiAgICBWdWUuYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMiXSA9ICJHRVQsIFBPU1QsIFBVVCwgREVMRVRFIjsKICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyJdID0gIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMsIEFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiwgT3JpZ2luLCBBY2NlcHQsIENvbnRlbnQtVHlwZSI7CiAgICBWdWUuYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bIkNvbnRlbnQtVHlwZSJdID0gImFwcGxpY2F0aW9uL2pzb24iOwogICAgVnVlLmF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyJBY2NlcHQiXSA9ICJhcHBsaWNhdGlvbi9qc29uIjsKICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQXV0b3IiXSA9ICd7bm9tZTogIk1hcmNlbG8gSG9ybGxlIiwgZW1haWw6ICJqb2Vob3JAZ21haWwuY29tIn0nOwogICAgVnVlLmF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyJkb0xvYWRpbmciXSA9IHRydWU7CiAgfSwKCiAgc2V0QXV0aEhlYWRlcih0b2tlbikgewogICAgLyoNCiAgICAgICAgaWYgKCF0b2tlbikgdG9rZW4gPSBKd3RTZXJ2aWNlLmdldEF1dGhUb2tlbigpDQogICAgICAgIGlmICh0b2tlbikgew0KICAgICAgICAgICAgVnVlLmF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyJBdXRob3JpemF0aW9uIl0gPSBgQmVhcmVyICR7dG9rZW59YDsNCiAgICAgICAgICAgIFZ1ZUNvb2tpZXMuc2V0KCdhdXRoVG9rZW4nLCB0b2tlbiwgQ09PS0lFX1RJTUVPVVQpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygnQXBpU2VydmljZS5pbnRlcmNlcHRvcjogIkNvbmV4w6NvIGV4cGlyYWRhISInKQ0KICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goJ2FjdExvZ2luQXV0aE9mZicpDQogICAgICAgICAgICBzdG9yZS5jb21taXQoJ3NldEFsZXJ0JywgeyBtZXNzYWdlOiAnRXhwaXJhZG8gbyBwcmF6byBkZSBjb25leMOjbyEnLCB2YXJpYW50OiAnZGFuZ2VyJyB9KQ0KICAgICAgICB9DQogICAgICAgICAgcmV0dXJuICgodG9rZW4gfHwgJycpICE9ICcnKQ0KICAgICAgICAqLwogICAgcmV0dXJuIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQXV0aG9yaXphdGlvbiJdICE9PSAiIjsKICB9LAoKICBzZXRBbm9uSGVhZGVyKHRva2VuKSB7CiAgICBpZiAoIXRva2VuKSB0b2tlbiA9IEp3dFNlcnZpY2UuZ2V0QW5vblRva2VuKCk7CgogICAgaWYgKHRva2VuKSB7CiAgICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQXV0aG9yaXphdGlvbiJdID0gYEJlYXJlciAke3Rva2VufWA7IC8vIFZ1ZUNvb2tpZXMuc2V0KCJhbm9uVG9rZW4iLCB0b2tlbiwgQ09PS0lFX1RJTUVPVVQpOwogICAgfQoKICAgIHJldHVybiAodG9rZW4gfHwgIiIpICE9ICIiOwogIH0sCgogIGRlbFRva2VuSGVhZGVyKCkgewogICAgZGVsZXRlIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyJBdXRob3JpemF0aW9uIl07CiAgfSwKCiAgaXNMb2dnZWRpbigpIHsKICAgIC8vIHJldHVybiAoSnd0U2VydmljZS5nZXRMb2NhbHN0b3JlVG9rZW4oKSkgPyB0cnVlIDogZmFsc2UKICAgIHJldHVybiBKd3RTZXJ2aWNlLmdldExvY2Fsc3RvcmVUb2tlbigpOwogIH0sCgogIHF1ZXJ5KHJlc291cmNlLCBwYXJhbXMpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBWdWUuYXhpb3MuZ2V0KHJlc291cmNlLCBwYXJhbXMpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgLy8gY29uc29sZS5sb2coInF1ZXJ5OjplcnJvcjogIiwgZXJyb3IpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYFtSV1ZdIEFwaVNlcnZpY2UgJHtlcnJvcn1gKTsKICAgIH0KICB9LAoKICBnZXQocmVzb3VyY2UsIHBhcmFtcyA9IHt9LCBsb2FkaW5nID0gdHJ1ZSwgdGltZW91dCA9IDE1MDAwKSB7CiAgICAvLyBjb25zb2xlLmxvZygiand0U2VydmljZS5pc1Rva2VuVmFsaWQoKToiLCBqd3RTZXJ2aWNlLmlzVG9rZW5WYWxpZCgpKTsKICAgIGlmIChqd3RTZXJ2aWNlLmlzVG9rZW5WYWxpZCgpKSB7CiAgICAgIGlmICghcGFyYW1zLmhhc093blByb3BlcnR5KCJwYXJhbXMiKSkgewogICAgICAgIHBhcmFtcyA9IHsKICAgICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcGFyYW1zID0geyAuLi5wYXJhbXMsCiAgICAgICAgLi4uewogICAgICAgICAgdGltZW91dDogdGltZW91dAogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRyeSB7CiAgICAgICAgVnVlLmF4aW9zLmRlZmF1bHRzLmhlYWRlcnNbImRvTG9hZGluZyJdID0gbG9hZGluZzsgLy8gc3RvcmUuZGlzcGF0Y2goJ2FjdExvYWRpbmdWaXNpYmxlJywgdHJ1ZSkKICAgICAgICAvLyBjb25zb2xlLmxvZygiQXBpU2VydmljZS5nZXQ6IiwgcGFyYW1zKTsKCiAgICAgICAgcmV0dXJuIFZ1ZS5heGlvcy5nZXQocmVzb3VyY2UsIHBhcmFtcyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coImdldDo6ZXJyb3I6ICIsIGVycm9yKTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFtSV1ZdIEFwaVNlcnZpY2UgJHtlcnJvcn1gKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNwb25zZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgcmVqZWN0KHsKICAgICAgICAgIHJlc3BvbnNlOiB7CiAgICAgICAgICAgIGRhdGE6ICJUb2tlbiBpbnbDoWxpZG8gIG91IGV4cGlyYWRvIgogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LAoKICBwb3N0KHJlc291cmNlLCBwYXJhbXMgPSB7fSwgbG9hZGluZyA9IHRydWUpIHsKICAgIHRyeSB7CiAgICAgIFZ1ZS5heGlvcy5kZWZhdWx0cy5oZWFkZXJzWyJkb0xvYWRpbmciXSA9IGxvYWRpbmc7CiAgICAgIHJldHVybiBWdWUuYXhpb3MucG9zdChyZXNvdXJjZSwgcGFyYW1zKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJwb3N0OjplcnJvcjogIiwgZXJyb3IpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYFtSV1ZdIEFwaVNlcnZpY2UgJHtlcnJvcn1gKTsKICAgIH0KICB9LAoKICB1cGRhdGUocmVzb3VyY2UsIHBhcmFtcykgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIFZ1ZS5heGlvcy5wdXQocmVzb3VyY2UsIHBhcmFtcyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAvLyBjb25zb2xlLmxvZygidXBkYXRlOjplcnJvcjogIiwgZXJyb3IpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYFtSV1ZdIEFwaVNlcnZpY2UgJHtlcnJvcn1gKTsKICAgIH0KICB9LAoKICBwdXQocmVzb3VyY2UsIHBhcmFtcykgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIFZ1ZS5heGlvcy5wdXQoYCR7cmVzb3VyY2V9YCwgcGFyYW1zKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJwdXQ6OmVycm9yOiAiLCBlcnJvcik7CiAgICAgIHRocm93IG5ldyBFcnJvcihgW1JXVl0gQXBpU2VydmljZSAke2Vycm9yfWApOwogICAgfQogIH0sCgogIGRlbGV0ZShyZXNvdXJjZSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIFZ1ZS5heGlvcy5kZWxldGUocmVzb3VyY2UpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgLy8gY29uc29sZS5sb2coImRlbGV0ZTo6ZXJyb3I6ICIsIGVycm9yKTsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBbUldWXSBBcGlTZXJ2aWNlICR7ZXJyb3J9YCk7CiAgICB9CiAgfSwKCiAgLy8gYXV0aCBwb2RlIHNlciAwPXNlbTsgMT1hdXRoIGFub25pbW87IDI9YXV0aCBsb2dpbgogIC8vIG7Do28gZXN0w6Egc2VuZG8gdXNhZG8uLi4KICBjYWxsTWV0aG9kKG1ldGhvZCwgcmVzb3VyY2UgPSAiIiwgY29uZmlnID0ge30sIGF1dGggPSAwKSB7CiAgICBpZiAoYXV0aCA9PT0gMSkgewogICAgICB0aGlzLnNldEFub25IZWFkZXIoKTsKICAgIH0KCiAgICBpZiAoYXV0aCA9PT0gMikgewogICAgICB0aGlzLnNldEF1dGhIZWFkZXIoKTsKICAgIH0KCiAgICBpZiAobWV0aG9kID09PSAicXVlcnkiKSB7CiAgICAgIHJldHVybiB0aGlzLnF1ZXJ5KHJlc291cmNlLCBjb25maWcpOwogICAgfQoKICAgIGlmIChtZXRob2QgPT09ICJnZXQiKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChyZXNvdXJjZSk7CiAgICB9CgogICAgaWYgKG1ldGhvZCA9PT0gInBvc3QiKSB7CiAgICAgIHJldHVybiB0aGlzLnBvc3QocmVzb3VyY2UsIGNvbmZpZyk7CiAgICB9CgogICAgaWYgKG1ldGhvZCA9PT0gInVwZGF0ZSIpIHsKICAgICAgcmV0dXJuIHRoaXMudXBkYXRlKHJlc291cmNlLCBjb25maWcpOwogICAgfQoKICAgIGlmIChtZXRob2QgPT09ICJwdXQiKSB7CiAgICAgIHJldHVybiB0aGlzLnB1dChyZXNvdXJjZSwgY29uZmlnKTsKICAgIH0KCiAgICBpZiAobWV0aG9kID09PSAiZGVsZXRlIikgewogICAgICByZXR1cm4gdGhpcy5kZWxldGUocmVzb3VyY2UpOwogICAgfQogIH0sCgogIC8vIHRlc3RlCiAgcHJlcGFyZURhdGEocmVzcG9uc2UpIHsKICAgIGxldCBkYXRhID0gewogICAgICBidXN5OiBmYWxzZSwKICAgICAgYXBpcmVzcG9uc2U6IHJlc3BvbnNlLAogICAgICBzdWNjZXNzOiByZXNwb25zZSAmJiAocmVzcG9uc2UuU3VjY2VzcyB8fCByZXNwb25zZS5TdWNjZXNzID09ICJUcnVlIiksCiAgICAgIGVycm9yOiByZXNwb25zZSAmJiByZXNwb25zZS5FcnJvciB8fCBbXSwKICAgICAgZGF0YTogcmVzcG9uc2UgJiYgcmVzcG9uc2UuRGF0YSB8fCBbXQogICAgfTsgLy8gY29uc29sZS5sb2coIkFwaVNlcnZpY2UucmVzcG9uc2U6IiwgcmVzcG9uc2UpOwogICAgLy8gY29uc29sZS5sb2coIkFwaVNlcnZpY2UuZGF0YToiLCBkYXRhKTsKCiAgICByZXR1cm4gZGF0YTsKICB9LAoKICBjaGVja3VwZGF0ZShzdG9yZW5hbWUpIHsKICAgIGlmICghc3RvcmUuZ2V0dGVycy5ndHh1cGRhdGVzIHx8IHN0b3JlLmdldHRlcnMuZ3R4dXBkYXRlcy5sZW5ndGggPT0gMCkgewogICAgICBzdG9yZS5kaXNwYXRjaCgiYWN0VXBkYXRlcyIsIHN0b3JlbmFtZSkudGhlbigoKSA9PiB7CiAgICAgICAgLy8gY2hhbWEgbm92YW1lbnRlIHBxIGFnb3JhIHRlbSBvIHVwZGF0ZXMgLi4uCiAgICAgICAgdGhpcy5jaGVja3VwZGF0ZShzdG9yZW5hbWUpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIFRPRE86IGNyaWFyIGZ1bsOnw6NvIHF1ZSB2ZXJpZmljYSBzZSBhIHN0b3JlIGVzdMOhIGzDoSBvdSBzZSBwcmVjaXNhIGF0dWFsaXphciAuLi4KICAgICAgbGV0IGxTdG9yZSA9IGxvY2Fsc3RvcmUuZ2V0VXNlclN0b3JlRGF0YUJ5TmFtZShzdG9yZW5hbWUpOwogICAgICBpZiAobFN0b3JlKSBsU3RvcmUudXBkYXRlZGF0ZSA9IG5ldyBEYXRlKGxTdG9yZS51cGRhdGVkYXRlKTsgLy8gY29uc29sZS5sb2coJ0FwaVNlcnZpY2UubFN0b3JlOicsIGxTdG9yZSkKICAgICAgLy8gY29uc29sZS5sb2coJ0FwaVNlcnZpY2UuZ3R4dXBkYXRlczonLCBzdG9yZS5nZXR0ZXJzLmd0eHVwZGF0ZXMpCgogICAgICBjb25zdCB1cGRhdGUgPSBzdG9yZS5nZXR0ZXJzWyJndHh1cGRhdGVzIl0uZmluZCh1ID0+IHUuc3RvcmUgPT0gc3RvcmVuYW1lKSB8fCB7CiAgICAgICAgdXBkYXRlZGF0ZTogbmV3IERhdGUoKQogICAgICB9OyAvLyBjb25zb2xlLmxvZygnQXBpU2VydmljZS5zdG9yZW5hbWU6Jywgc3RvcmVuYW1lKQogICAgICAvLyBjb25zb2xlLmxvZygnQXBpU2VydmljZS5ndHh1cGRhdGVzOicsIHVwZGF0ZS51cGRhdGVkYXRlKQogICAgICAvLyBzZSBhIGRhdGEgZGEgw7psdGltYSBhdHVhbGl6YcOnw6NvIGZvciBtZW5vciBxdWUgYSBhdHVhbCwgZm9yw6dhIHVtYSBhdHVhbGl6YcOnw6NvIC4uLgoKICAgICAgaWYgKGxTdG9yZSAmJiBsU3RvcmUudXBkYXRlZGF0ZSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCdBcGlTZXJ2aWNlLmxTdG9yZTogICAgJywgbFN0b3JlLnVwZGF0ZWRhdGUpCiAgICAgICAgaWYgKGxTdG9yZS51cGRhdGVkYXRlIDwgdXBkYXRlLnVwZGF0ZWRhdGUpIGxTdG9yZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBsU3RvcmU7CiAgICB9CiAgfSwKCiAgLy8gbWV0b2RvcyBwYXJhIHNhbHZhciBubyB2dWV4Li4uCiAgc2V0U3RvcmUocm90YSwgcGFyYW1zLCBzdG9yZXMpIHsKICAgIC8vIHNlIHBhc3NhciBzb21lbnRlIG8gbm9tZSwgbW9udGEgbyBvYmpldG8KICAgIGlmICh0eXBlb2Ygc3RvcmVzID09ICJzdHJpbmciKSB7CiAgICAgIHN0b3JlcyA9IHsKICAgICAgICBuYW1lOiBzdG9yZXMsCiAgICAgICAgcm91dGU6IHJvdGEsCiAgICAgICAgZ2V0dGVyOiBgZ3R4JHtzdG9yZXN9YCwKICAgICAgICBzZXR0ZXI6IGBzZXQke3N0b3Jlc31gLAogICAgICAgIGFjdGlvbjogYGFjdCR7c3RvcmVzfWAKICAgICAgfTsKICAgIH0gLy8gdmVyaWZpY2Egc2UgcHJlY2lhIGF0dWFsaXphciBhIHN0b3JlIG91IHBlZ2FyIGRvIGxvY2FsU3RvcmFnZSAuLi4KCgogICAgbGV0IGxTdG9yZSA9IHRoaXMuY2hlY2t1cGRhdGUoc3RvcmVzLm5hbWUpOwoKICAgIGlmIChsU3RvcmUpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ0FQaVNlcnZpY2Uuc2V0U3RvcmU6IEdldCcsIHN0b3Jlcy5uYW1lLCAnZnJvbSBsb2NhbFN0b3JlJykKICAgICAgaWYgKGxTdG9yZS5oYXNPd25Qcm9wZXJ0eSgiZGF0YSIpKSBsU3RvcmUgPSBsU3RvcmUuZGF0YTsKICAgICAgaWYgKHN0b3Jlcy5zZXR0ZXIpIHN0b3JlLmNvbW1pdChzdG9yZXMuc2V0dGVyLCBsU3RvcmUpOwogICAgfSBlbHNlIHsKICAgICAgLy9jb25zb2xlLmxvZygnQVBpU2VydmljZS5zZXRTdG9yZTogR2V0Jywgc3RvcmVzLm5hbWUsICdmcm9tIEFQSScpCiAgICAgIC8vIGNvbnNvbGUubG9nKCdBcGlTZXJ2aWNlOiAnLCBzdG9yZXMuc2V0dGVyLCAnOicsIGxTdG9yZSkKICAgICAgLy8gc2UgZXN0w6EgYXV0ZW50aWNhZG8uLi4KICAgICAgaWYgKHN0b3JlLmdldHRlcnNbImd0eGxvZ2luQXV0aCJdKSB7CiAgICAgICAgQXBpU2VydmljZS5zZXRBdXRoSGVhZGVyKHN0b3JlLmdldHRlcnNbImd0eEF1dGhUb2tlbiJdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBBcGlTZXJ2aWNlLnNldEFub25IZWFkZXIoKTsKICAgICAgfQoKICAgICAgY29uc3QgY29uZmlnID0gewogICAgICAgIHBhcmFtczogewogICAgICAgICAgUGVzcXVpc2E6IHBhcmFtcyA/IHBhcmFtcy5wZXNxdWlzYSA6ICIlIiwKICAgICAgICAgIFBhZ2VOdW1iZXI6IHBhcmFtcyA/IHBhcmFtcy5QYWdlTnVtYmVyIDogMSwKICAgICAgICAgIFBhZ2VDb3VudDogcGFyYW1zID8gcGFyYW1zLlBhZ2VDb3VudCA6IDEwMAogICAgICAgIH0KICAgICAgfTsgLy8gY29uc29sZS5sb2coJ0FwaVNlcnZpY2U6OnJvdGEnLCByb3RhKQogICAgICAvLyBjb25zb2xlLmxvZygnQXBpU2VydmljZTo6Y29uZmlnJywgY29uZmlnKQoKICAgICAgQXBpU2VydmljZS5nZXQocm90YSwgY29uZmlnKS50aGVuKHJlcyA9PiB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3Jlcy5kYXRhOiAnLCByZXMuZGF0YSkKICAgICAgICAvLyBhZGljaW9uYSBhIGRhdGEgcXVlIGZvaSBhdHVhbGl6YWRvIC4uLgogICAgICAgIGlmIChyZXMuZGF0YS5TdWNjZXNzID09ICJUcnVlIiB8fCByZXMuZGF0YS5TdWNjZXNzKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhzdG9yZXMubmFtZSwgcmVzLmRhdGEuRGF0YSkKICAgICAgICAgIGlmIChzdG9yZXMuc2V0dGVyKSBzdG9yZS5jb21taXQoc3RvcmVzLnNldHRlciwgcmVzLmRhdGEuRGF0YSk7IC8vc2FsdmEgYSBzdG9yZSBubyBub21lIGRvIGxvZ2luIC4uLgogICAgICAgICAgLy8gbG9jYWxzdG9yZS5zZXRsb2NhbFN0b3JlKHN0b3Jlcy5uYW1lLCByZXMuZGF0YS5EYXRhKQoKICAgICAgICAgIGxvY2Fsc3RvcmUuc2V0VXNlclN0b3JlRGF0YShzdG9yZXMubmFtZSwgcmVzLmRhdGEuRGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgW0FwaVNlcnZpY2VdICR7cmVzLmRhdGEuZXJyb3J9YCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgLyogLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBcGlTZXJ2aWNlOjpzdG9yZXMuJywgc3RvcmVzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUuZXJyb3IoZXJyb3IubWVzc2FnZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoZXJyb3IpID09ICdzdHJpbmcnKSBjb25zb2xlLmxvZygnQXBpU2VydmljZS5zZXRTdG9yZSBzdHJpbmc6ICcsIGVycm9yKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihlcnJvcikgPT0gJ29iamVjdCcpIGNvbnNvbGUubG9nKCdBcGlTZXJ2aWNlLnNldFN0b3JlIG9iamVjdDogJywgZXJyb3IpDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFtBcGlTZXJ2aWNlXSAke2Vycm9yfWApDQogICAgICAgICAgICAgICAgICAgIH0pICovCgogICAgICAvKiB9IGVsc2Ugew0KICAgICAgICBjb25zb2xlLmVycm9yKCJVc3XDoXJpbyBuw6NvIGF1dGVudGljYWRvIik7DQogICAgICAgIHN0b3JlLmNvbW1pdCgic2V0QWxlcnQiLCB7DQogICAgICAgICAgbWVzc2FnZTogIlVzdcOhcmlvIG7Do28gYXV0ZW50aWNhZG8hIiwNCiAgICAgICAgICB2YXJpYW50OiAiZGFuZ2VyIiwNCiAgICAgICAgfSk7DQogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2xvZ2luQXV0aDonLCBzdG9yZS5nZXR0ZXJzWydndHhBdXRoQWxsJ10pDQogICAgICAgIHRocm93IG5ldyBFcnJvcigiW0FwaVNlcnZpY2VdIFVzdcOhcmlvIG7Do28gYXV0ZW50aWNhZG8iKTsNCiAgICAgIH0gKi8KICAgIH0KICB9LAoKICAvLyBkZXByYWNlZAogIHNhdmVTdG9yZShzdG9yZW5hbWUsIGRhdGEpIHsKICAgIC8vIGxldCBzYXZlc3RvcmUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JlbmFtZSkpCiAgICAvLyBpZiAoIXNhdmVzdG9yZSkgbG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmVuYW1lLCBKU09OLnN0cmluZ2lmeShkYXRhKSkKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHN0b3JlbmFtZSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyAvLyBzYWx2YSB0YW1iw6ltIG5hIHN0b3JlIGRvIHVzdWFyaW8gLi4uCiAgICAvLyBtZW5vcyBzZSBmb3IgZWxlIG1lc21vCgogICAgaWYgKHN0b3JlbmFtZSAhPT0gSnd0U2VydmljZS5nZXRVc2VyTmFtZSgpICYmIHN0b3JlbmFtZSAhPT0gImxvZ2luQW5vbiIpIHsKICAgICAgdGhpcy5zYXZlVXNlclN0YXRlKHN0b3JlbmFtZSwgZGF0YSk7CiAgICB9CiAgfSwKCiAgLy8gc2FsdmEgbyBzdGF0ZSBkbyB1c3XDoXJpbyBsb2dhZG8sIGUgYXR1YWxpemEgc2UgasOhIHRpdmVyIGRhZG9zIHNhbHZvcyBubyBsb2NhbHN0b3JlIHBhcmEKICAvLyBuw6NvIHBlcmRlciBhcyBzdG9yZXMgZGUgZGFkb3MgZG8gc3RvcmVkYXRhIC4uLgogIHNhdmVVc2VyU3RhdGUoc3RvcmVuYW1lLCBkYXRhKSB7CiAgICAvLyBwZWdhIGRvIGxvY2Fsc3RvcmUgc2UgZXhpc3RpciAuLi4KICAgIGxldCBsdXNlciA9IEp3dFNlcnZpY2UuZ2V0VXNlclN0b3JlKHN0b3JlbmFtZSk7IC8vIHNlIGrDoSB0ZW0gbyB1c3XDoXJpbyBzYWx2byBubyBsb2NhbHN0b3JlLCBhdHVhbGl6YSAuLi4KCiAgICBpZiAoIWx1c2VyKSB7CiAgICAgIGx1c2VyID0gZGF0YTsKICAgIH0gZWxzZSB7CiAgICAgIGx1c2VyLmF1dGggPSBkYXRhLmF1dGg7CiAgICAgIGx1c2VyLnRva2VuID0gZGF0YS50b2tlbjsKICAgICAgbHVzZXIubGFzdExvZ2luID0gZGF0YS5sYXN0TG9naW47CiAgICB9CgogICAgbG9jYWxzdG9yZS5zYXZlbG9jYWxTdG9yZShzdG9yZW5hbWUsIGx1c2VyKTsKICB9LAoKICBzYXZlU3RvcmVkYXRhKHN0b3JlbmFtZSwgZGF0YSkgewogICAgLy8gcGVnYSBkbyBsb2NhbHN0b3JlIHNlIGV4aXN0aXIgLi4uCiAgICBsZXQgbHVzZXIgPSBKd3RTZXJ2aWNlLmdldFVzZXJTdG9yZShzdG9yZW5hbWUpOyAvLyBzZSBuw6NvIHRlbSBvIHN0b3JlZGF0YSBjcmlhIHZhemlvCgogICAgaWYgKCFsdXNlci5zdG9yZWRhdGEpIGx1c2VyLnN0b3JlZGF0YSA9IFtdOwogICAgbGV0IGxkYXRhID0gbHVzZXIuc3RvcmVkYXRhLmZpbmQocyA9PiBzLnN0b3JlID09IHN0b3JlbmFtZSk7CgogICAgaWYgKCFsZGF0YSkgewogICAgICBsZGF0YSA9IHsKICAgICAgICBzdG9yZTogc3RvcmVuYW1lLAogICAgICAgIGRhdGE6IGRhdGEKICAgICAgfTsKICAgICAgbHVzZXIuc3RvcmVkYXRhLnB1c2gobGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgbGRhdGEuZGF0YSA9IGRhdGE7CiAgICB9IC8vIHNhbHZhIGEgc3RvcmUgbmEgc3RvcmUgZG8gbG9naW4gLi4uCgoKICAgIGxvY2Fsc3RvcmUuc2V0bG9jYWxTdG9yZShzdG9yZW5hbWUsIGxkYXRhKTsKICB9LAoKICAvLyBzYWx2YSBhIHN0b3JlIGNvbSBvIG5vbWUgZG8gdXN1w6FyaW8gbG9nYWRvIC4uLgogIHNhdmVTdG9yZVVzZXIodXNlcm5hbWUsIGRhdGEpIHsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJsb2dpbkF1dGgiLCB1c2VybmFtZSk7CiAgICB0aGlzLnNhdmVVc2VyU3RhdGUodXNlcm5hbWUsIGRhdGEpOwogIH0sCgogIGRvd25sb2FkRmlsZSh7CiAgICB1cmwsCiAgICBmaWxlbmFtZQogIH0pIHsKICAgIFZ1ZS5heGlvcy5nZXQodXJsLCB7CiAgICAgIHJlc3BvbnNlVHlwZTogImJsb2IiCiAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgY29uc3QgZXh0ID0gYC4ke3VybC5zcGxpdCgiLiIpLnJldmVyc2UoKVswXX1gOyAvLyBwZWdhIG8gw7psdGltbyBwb250byBxdWUgw6kgYSBleHRlbnPDo28gZG8gYXJxdWl2bwoKICAgICAgY29uc3QgbWltZSA9IG1pbWVzLmZpbmQobSA9PiBtLmV4dGVuc2FvID09IGV4dCkgfHwgImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSI7CiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0sIHsKICAgICAgICB0eXBlOiBtaW1lCiAgICAgIH0pOwogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICBsaW5rLmRvd25sb2FkID0gZmlsZW5hbWU7CiAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpOwogICAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CiAgfQoKfTsgLy8gaW5pY2lhIGFzIGNvbmZpZ3VyYcOnw7VlcyAuLi4KCkFwaVNlcnZpY2UuaW5pdCgpOyAvLyBJTklDSU8gLSBJbnRlcmNlcHRvcnMKLy8gcXVhbmRvIHJlcXVpc2l0YXIgdW0gZW5kcG9pbnQKCmF4aW9zLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShhc3luYyBjb25maWcgPT4gewogIGNvbnN0IHRva2VuID0gY29va2llcy5nZXRjb29raWUoInRva2VuIikgfHwgY29va2llcy5nZXRjb29raWUoImFub250b2tlbiIpIHx8ICIiOyAvLyBzZSBvIHRva2VuIG7Do28gw6kgbWFpcyB2w6FsaWRvLi4uCgogIGlmICghSnd0U2VydmljZS5pc1Rva2VuVmFsaWQodG9rZW4pKSB7CiAgICBpZiAoSnd0U2VydmljZS5nZXRVc2VyTmFtZSh0b2tlbikgPT0gIkFub255bW91c0FQSSIpIHsKICAgICAgLy8gcmVub3ZhCiAgICAgIGNvbnNvbGUubG9nKCdQcmVjaXNhIHJlbm92YXIgbyB0b2tlbiBhbm9uaW1vJyk7IC8vIEFwaVNlcnZpY2UuYXBpUmVuZXdUb2tlbi5ub3RpZnkoSnd0U2VydmljZS5nZXRVc2VyTmFtZSh0b2tlbikpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGNvbmZpZzsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKEp3dFNlcnZpY2UuZ2V0VXNlck5hbWUodG9rZW4pID09ICJBbm9ueW1vdXNBUEkiKSB7CiAgICAgIFZ1ZS4kY29va2llcy5zZXQoImFub250b2tlbiIsIHRva2VuLCBDT09LSUVfQU5PTklNT1VTVE9LRU4pOwogICAgfSBlbHNlIHsKICAgICAgVnVlLiRjb29raWVzLnNldCgidG9rZW4iLCB0b2tlbiwgQ09PS0lFX1RJTUVPVVQpOwogICAgfQoKICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyICR7dG9rZW59YDsKICB9CgogIGNvbnN0IGxvYWRpbmcgPSBjb25maWcuaGVhZGVyc1siZG9Mb2FkaW5nIl07CiAgaWYgKGxvYWRpbmcpIEFwaVNlcnZpY2UubG9hZE9ic2VydmVyLm5vdGlmeSh0cnVlKTsKICByZXR1cm4gY29uZmlnOwp9LCBlcnJvciA9PiB7CiAgUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsgLy8gcXVhbmRvIHJlc3BvbmRlciAKCmF4aW9zLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzID0+IHsKICAvLyBjb25zb2xlLmxvZygiQXBpU2VydmljZS5yb3V0ZXI6Iiwgcm91dGVyLmhpc3RvcnkuY3VycmVudC5wYXRoKTsKICAvLyBjb25zb2xlLmxvZygiQXBpU2VydmljZS5yZXNwb25zZToiLCByZXMuY29uZmlnLmRhdGEpOwogIGNvbnN0IG5vdGlmaWNhdGlvbnMgPSB7CiAgICB2YXJpYW50OiAic3VjY2VzcyIsCiAgICBtZXNzYWdlOiAiIgogIH07CgogIGlmIChyZXMuY29uZmlnLnVybCA9PT0gIkF1dGhlbnRpY2F0aW9uIikgewogICAgY29uc3QgdXNlciA9IEpTT04ucGFyc2UocmVzLmNvbmZpZy5kYXRhKTsKICAgIGNvbnN0IGlzQXV0aCA9IChyZXMuZGF0YS5Ub2tlbkFjY2VzcyB8fCAiIikgIT09ICIiOwoKICAgIGlmIChpc0F1dGgpIHsKICAgICAgcmVzLmNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyOiAke3Jlcy5kYXRhLlRva2VuQWNjZXNzfWA7CiAgICAgIFZ1ZS4kY29va2llcy5zZXQoInRva2VuIiwgcmVzLmRhdGEuVG9rZW5BY2Nlc3MsIENPT0tJRV9USU1FT1VUKTsKICAgICAgVnVlLiRjb29raWVzLnNldCgibGFzdGxvZ2luIiwgdXNlci5Vc2VyKTsKICAgICAgbm90aWZpY2F0aW9ucy5tZXNzYWdlID0gIkF1dGVudGljYWRvIGNvbSBzdWNlc3NvISI7CiAgICAgIG5vdGlmaWNhdGlvbnMudmFyaWFudCA9ICJzdWNjZXNzIjsKICAgICAgQXBpU2VydmljZS5ub3RpZnlPYnNlcnZlci5ub3RpZnkobm90aWZpY2F0aW9ucyk7CiAgICB9CgogICAgQXBpU2VydmljZS5sb2dpbk9ic2VydmVyLm5vdGlmeShpc0F1dGgpOwogIH0KCiAgaWYgKHJlcy5jb25maWcudXJsID09PSAiQXV0aGVudGljYXRpb24vR2V0QW5vbnltb3VzVG9rZW4iKSB7CiAgICBWdWUuYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9IGBCZWFyZXI6ICR7cmVzLmRhdGEuVG9rZW5BY2Nlc3N9YDsKICAgIFZ1ZS4kY29va2llcy5zZXQoImFub250b2tlbiIsIHJlcy5kYXRhLlRva2VuQWNjZXNzLCB7CiAgICAgIGV4cGlyZXM6ICIxRCIKICAgIH0pOyAvLyBjb25zb2xlLmxvZygiQW5vbnltb3VzOiIsICciQXV0ZW50aWNhZG8gY29tIHN1Y2Vzc28hIicpOwogIH0gLy8gaXNzbyB0ZXN0YSBhcyBkdWFzIEFQSXMgYSBOb3JtYWwgZSBhIHYyCgoKICBpZiAocmVzLmRhdGEuU3VjY2VzcyA9PT0gIkZhbHNlIiB8fCByZXMuZGF0YS5TdWNjZXNzID09PSBmYWxzZSkgewogICAgbm90aWZpY2F0aW9ucy52YXJpYW50ID0gImRhbmdlciI7CiAgICBub3RpZmljYXRpb25zLm1lc3NhZ2UgPSByZXMuZGF0YS5FcnJvcjsKICAgIEFwaVNlcnZpY2Uubm90aWZ5T2JzZXJ2ZXIubm90aWZ5KG5vdGlmaWNhdGlvbnMpOwogIH0KCiAgQXBpU2VydmljZS5sb2FkT2JzZXJ2ZXIubm90aWZ5KGZhbHNlKTsKICByZXR1cm4gcmVzOwp9LCBlcnIgPT4gewogIC8vIGNvbnNvbGUubG9nKCJBcGlTZXJ2aWNlLmVycm9yLnJvdXRlci5oaXN0b3J5LmN1cnJlbnQ6Iixyb3V0ZXIuaGlzdG9yeS5jdXJyZW50KTsKICAvLyBjb25zb2xlLmxvZygiZXJyOiIsIGVycik7CiAgY29uc3QgZXJyb3IgPSB7CiAgICBlcnJvcjogZXJyLAogICAgcmVzcG9uc2U6IG51bGwsCiAgICByb3V0ZTogcm91dGVyLmhpc3RvcnkuY3VycmVudC5wYXRoLAogICAgc3RhdHVzOiAwLAogICAgZGF0YTogbnVsbCwKICAgIGhlYWRlcnM6IG51bGwsCiAgICBtZXNzYWdlOiBudWxsLAogICAgdmFyaWFudDogIiIKICB9OwoKICBpZiAoZXJyLmNvZGUgPT0gIkVDT05OQUJPUlRFRCIpIHsKICAgIHN0b3JlLmRpc3BhdGNoKCJzZXRkYW5nZXIiLCAiVGVtcG8gZXhjZWRpZG8gcGFyYSBhIGV4ZWN1w6fDo28gZGVzdGEgcmVxdWlzacOnw6NvIik7CiAgICBlcnJvci5tZXNzYWdlID0gIlRlbXBvIGV4Y2VkaWRvIHBhcmEgYSBleGVjdcOnw6NvIGRlc3RhIHJlcXVpc2nDp8OjbyI7CiAgfSBlbHNlIHsKICAgIGlmICghZXJyLnJlc3BvbnNlKSB7CiAgICAgIC8vIHN0b3JlLmRpc3BhdGNoKAogICAgICAvLyAgICJzZXRkYW5nZXIiLAogICAgICAvLyAgICJFcnJvIGdlcmFsIGRlIHJlZGUhISFcblZlcmlmaXF1ZSBzdWEgY29uZXjDo28gY29tIGEgaW50ZXJuZXQiCiAgICAgIC8vICk7CiAgICAgIGVycm9yLm1lc3NhZ2UgPSAiRXJybyBnZXJhbCBkZSByZWRlISEhIFZlcmlmaXF1ZSBzdWEgY29uZXjDo28gY29tIGEgaW50ZXJuZXQiOwogICAgfSBlbHNlIHsKICAgICAgZXJyb3Iuc3RhdHVzID0gZXJyLnJlc3BvbnNlLnN0YXR1czsKICAgICAgZXJyb3IuZGF0YSA9IGVyci5yZXNwb25zZS5kYXRhOwogICAgICBlcnJvci5oZWFkZXJzID0gZXJyLnJlc3BvbnNlLmhlYWRlcnM7CiAgICAgIGVycm9yLnJlc3BvbnNlID0gZXJyLnJlc3BvbnNlOwoKICAgICAgc3dpdGNoIChlcnIucmVzcG9uc2Uuc3RhdHVzKSB7CiAgICAgICAgY2FzZSA0MDA6CiAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLmRhdGEuVXNlcikgewogICAgICAgICAgICAvLyBzdG9yZS5kaXNwYXRjaCgnc2V0ZGFuZ2VyJywgJ05lY2Vzc8OhcmlvIGluZm9ybWFyIG8gdXN1w6FyaW8nKQogICAgICAgICAgICAvLyBzdG9yZS5kaXNwYXRjaCgnc2V0YXV0aCcsIGZhbHNlKQogICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gIk5lY2Vzc8OhcmlvIGluZm9ybWFyIG8gdXN1w6FyaW8iOwogICAgICAgICAgICBlcnJvci52YXJpYW50ID0gImluZm8iOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGVyci5yZXNwb25zZS5kYXRhLlBhc3N3b3JkKSB7CiAgICAgICAgICAgICAgLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGRhbmdlcicsICdOZWNlc3PDoXJpbyBpbmZvcm1hciBhIHNlbmhhJykKICAgICAgICAgICAgICAvLyBzdG9yZS5kaXNwYXRjaCgnc2V0YXV0aCcsIGZhbHNlKQogICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSAiTmVjZXNzw6FyaW8gaW5mb3JtYXIgYSBzZW5oYSI7CiAgICAgICAgICAgICAgZXJyb3IudmFyaWFudCA9ICJpbmZvIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLmRhdGEuZGF0YSkgewogICAgICAgICAgICAgICAgLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGRhbmdlcicsIGA0MDAgLSAke2Vyci5yZXNwb25zZS5kYXRhLmRhdGFbMF19YCkKICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSBlcnIucmVzcG9uc2UuZGF0YS5kYXRhWzBdOwogICAgICAgICAgICAgICAgZXJyb3IudmFyaWFudCA9ICJ3YXJuaW5nIjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGRhbmdlcicsIGA0MDAgLSAke2Vyci5yZXNwb25zZS5kYXRhfWApCiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gZXJyLnJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICBlcnJvci52YXJpYW50ID0gIndhcm5pbmciOwogICAgICAgICAgICAgIH0gLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGF1dGgnLCBmYWxzZSkKICAgICAgICAgICAgICAvLyBWdWUubWV0aG9kcy50b2FzdGRhbmdlcignRXJybyBkZSBhdXRlbnRpY2HDp8OjbyEnKQoKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDQwMToKICAgICAgICAgIC8vIHN0b3JlLmRpc3BhdGNoKCdzZXRkYW5nZXInLCAnNDAxIC0gRXJybyBuYSBhdXRlbnRpY2HDp8OjbywgdmVyaWZpcXVlIHVzdcOhcmlvIGUgc2VuaGEnKQogICAgICAgICAgLy8gc3RvcmUuZGlzcGF0Y2goJ2xvZ29mZicpCiAgICAgICAgICBpZiAoZXJyLnJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgZXJyb3IubWVzc2FnZSA9IGVyci5yZXNwb25zZS5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXJyb3IubWVzc2FnZSA9ICJFcnJvIG5hIGF1dGVudGljYcOnw6NvLCB2ZXJpZmlxdWUgdXN1w6FyaW8gZSBzZW5oYSI7IC8vIEFwaVNlcnZpY2UubG9naW5FbWl0KGZhbHNlKTsKCiAgICAgICAgICAgIEFwaVNlcnZpY2UubG9naW5PYnNlcnZlci5ub3RpZnkoZmFsc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGVycm9yLnZhcmlhbnQgPSAiaW5mbyI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSA0MDQ6CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygicm91dGVyOiIsIHJvdXRlci5jdXJyZW50Um91dGUpOwogICAgICAgICAgLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGRhbmdlcicsICc0MDQgLSBQw6FnaW5hIGluZXhpc3RlbnRlJykKICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSAiUMOhZ2luYSBpbmV4aXN0ZW50ZSI7CiAgICAgICAgICBlcnJvci52YXJpYW50ID0gImRhbmdlciI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIC8vIHN0b3JlLmRpc3BhdGNoKCdzZXRkYW5nZXInLCAnT2NvcnJldSB1bSBlcnJvIG5hIHJlcXVpc2nDp8OjbycpCiAgICAgICAgICBlcnJvci5tZXNzYWdlID0gIk9jb3JyZXUgdW0gZXJybyBuYSByZXF1aXNpw6fDo28iOwogICAgICAgICAgZXJyb3IudmFyaWFudCA9ICJkYW5nZXIiOwogICAgICB9CiAgICB9CiAgfSAvLyBjb25zb2xlLmxvZygiQXBpU2VydmljZS5lcnI6IiwgZXJyKTsKICAvLyBjb25zb2xlLmxvZygiQXBpU2VydmljZS5lcnJvcjoiLCBlcnJvcik7CiAgLy8gQXBpU2VydmljZS5lcnJvckVtaXQoZXJyb3IpOwoKCiAgQXBpU2VydmljZS5lcnJvck9ic2VydmVyLm5vdGlmeShlcnJvcik7IC8vIGlmIChlcnJvci52YXJpYW50ID09ICJkYW5nZXIiKSB7CiAgLy8gIHN0b3JlLmRpc3BhdGNoKCJzZXRlcnJvcnMiLCBlcnJvcik7CiAgLy8gfSBlbHNlIHsKICAvLyAgIHN0b3JlLmRpc3BhdGNoKCJhY3RUb2FzdCIsIGVycm9yKTsKICAvLyB9CiAgLy8gc3RvcmUuZGlzcGF0Y2goJ3NldGxvYWRpbmcnLCBmYWxzZSkKICAvLyBBcGlTZXJ2aWNlLmxvYWRpbmdFbWl0KGZhbHNlKTsKCiAgQXBpU2VydmljZS5sb2FkT2JzZXJ2ZXIubm90aWZ5KGZhbHNlKTsKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTsKfSk7IC8vIEZJTSAtIEludGVyY2VwdG9ycwovLyBjb25zb2xlLmxvZygnQXBpU2VydmljZTo6ZGVwb2lzIGRlIGNoYW1hciBvIGluaXQnKQoKZXhwb3J0IGRlZmF1bHQgQXBpU2VydmljZTs="},{"version":3,"names":["Vue","axios","VueAxios","JwtService","store","API_MODEL","API_URL","COOKIE_TIMEOUT","COOKIE_ANONIMOUSTOKEN","localstore","router","Observable","cookies","mimes","Localbase","jwtService","ApiService","apimodel","get","localstoredata","getStoreData","error","loadObserver","loginObserver","errorObserver","notifyObserver","chatObserver","apiReqObserver","apiRenewToken","localDB","init","use","defaults","baseURL","setBasicHeader","config","debug","getLocalDBDocument","collection","$cookies","key","doc","setLocalDBDocument","data","console","log","$route","name","add","delLocalDBDocument","delete","headers","common","setAuthHeader","token","setAnonHeader","getAnonToken","delTokenHeader","isLoggedin","getLocalstoreToken","query","resource","params","Error","loading","timeout","isTokenValid","hasOwnProperty","Promise","response","reject","post","update","put","callMethod","method","auth","prepareData","busy","apiresponse","success","Success","Data","checkupdate","storename","getters","gtxupdates","length","dispatch","then","lStore","getUserStoreDataByName","updatedate","Date","find","u","setStore","rota","stores","route","getter","setter","action","commit","Pesquisa","pesquisa","PageNumber","PageCount","res","setUserStoreData","saveStore","localStorage","setItem","JSON","stringify","getUserName","saveUserState","luser","getUserStore","lastLogin","savelocalStore","saveStoredata","storedata","ldata","s","push","setlocalStore","saveStoreUser","username","downloadFile","url","filename","responseType","ext","split","reverse","mime","m","extensao","blob","Blob","type","link","document","createElement","href","URL","createObjectURL","download","click","revokeObjectURL","catch","interceptors","request","getcookie","set","Authorization","notify","notifications","variant","message","user","parse","isAuth","TokenAccess","User","expires","err","history","current","path","status","code","Password"],"sources":["C:/k1-services/src/services/api.service.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport axios from \"axios\";\r\nimport VueAxios from \"vue-axios\";\r\nimport JwtService from \"@/services/jwt.service\";\r\nimport store from \"../store\";\r\nimport { API_MODEL, API_URL, COOKIE_TIMEOUT, COOKIE_ANONIMOUSTOKEN } from \"@/services/config\";\r\nimport localstore from \"@/services/localstore\";\r\n// import VueCookies from \"vue-cookies\";\r\n// import auth from \"@/store/auth\";\r\nimport router from \"../router\";\r\nimport Observable from \"./observable\";\r\n\r\n// não pude usar o VueCookies pois ele não está carregado nessa etapa do sistema ...\r\nimport cookies from \"./cookie\";\r\n\r\nimport mimes from \"../assets/json/mimetypes.json\";\r\nimport Localbase from \"localbase\";\r\nimport jwtService from \"./jwt.service\";\r\n\r\nconst ApiService = {\r\n  //constructor() {\r\n  //  this.apimodel = API_MODEL;\r\n  //},\r\n  // apimodel = API_MODEL,\r\n  apimodel: {\r\n    get() {\r\n      return API_MODEL;\r\n    },\r\n  },\r\n\r\n  localstoredata: localstore.getStoreData(),\r\n\r\n  error: [],\r\n\r\n  // INICIO - observables ...\r\n\r\n  loadObserver: new Observable(),\r\n  loginObserver: new Observable(),\r\n  errorObserver: new Observable(),\r\n  notifyObserver: new Observable(),\r\n  chatObserver: new Observable(),\r\n  apiReqObserver: new Observable(),\r\n  apiRenewToken: new Observable(),\r\n  \r\n  // FIM - observables ...\r\n    \r\n  localDB: new Localbase(\"db\"),\r\n\r\n  init() {\r\n    Vue.use(VueAxios, axios);\r\n    Vue.axios.defaults.baseURL = API_URL;\r\n    // Vue.axios.defaults.withCredentials = true; // para autorizar downloads via axios erro: obrigou a ter autenticação e não carrega mais a página ...\r\n    this.setBasicHeader();\r\n\r\n    this.localDB.config.debug = false;\r\n    // console.log('api.service.init:hit')\r\n\r\n    // console.log('APIService:init.localstoredata: ', this.localstoredata)\r\n    // console.log('APIService:init.username: ', JwtService.getUserName())\r\n  },\r\n\r\n  getLocalDBDocument(collection = Vue.$cookies.get(\"lastlogin\") || 'horlle', key) {\r\n      \r\n    return this.localDB\r\n      .collection(collection)\r\n      .doc(key)\r\n      .get()\r\n\r\n  },\r\n\r\n  setLocalDBDocument(data, collection = Vue.$cookies.get(\"lastlogin\") || 'horlle', key) {\r\n    console.log(Vue.$route.name);\r\n    if (key) {\r\n      this.localDB.collection(collection).add(data, key);\r\n    } else {\r\n      this.localDB.collection(collection).add(data);\r\n    }\r\n  },\r\n\r\n  delLocalDBDocument(collection, key) {\r\n    this.localDB.collection(collection).doc(key).delete();\r\n  },\r\n\r\n  setBasicHeader() {\r\n    Vue.axios.defaults.headers.common[\"Access-Control-Allow-Origin\"] = \"*\";\r\n    Vue.axios.defaults.headers.common[\"Access-Control-Allow-Methods\"] =\r\n      \"GET, POST, PUT, DELETE\";\r\n    Vue.axios.defaults.headers.common[\"Access-Control-Allow-Headers\"] =\r\n      \"Access-Control-Allow-Methods, Access-Control-Allow-Origin, Origin, Accept, Content-Type\";\r\n    Vue.axios.defaults.headers.common[\"Content-Type\"] = \"application/json\";\r\n    Vue.axios.defaults.headers.common[\"Accept\"] = \"application/json\";\r\n    Vue.axios.defaults.headers.common[\"Autor\"] =\r\n      '{nome: \"Marcelo Horlle\", email: \"joehor@gmail.com\"}';\r\n    Vue.axios.defaults.headers.common[\"doLoading\"] = true;\r\n  },\r\n\r\n  setAuthHeader(token) {\r\n    /*\r\n        if (!token) token = JwtService.getAuthToken()\r\n        if (token) {\r\n            Vue.axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n            VueCookies.set('authToken', token, COOKIE_TIMEOUT)\r\n        } else {\r\n            console.log('ApiService.interceptor: \"Conexão expirada!\"')\r\n            store.dispatch('actLoginAuthOff')\r\n            store.commit('setAlert', { message: 'Expirado o prazo de conexão!', variant: 'danger' })\r\n        }\r\n\r\n        return ((token || '') != '')\r\n        */\r\n    return Vue.axios.defaults.headers.common[\"Authorization\"] !== \"\";\r\n  },\r\n\r\n  setAnonHeader(token) {\r\n    if (!token) token = JwtService.getAnonToken();\r\n\r\n    if (token) {\r\n      Vue.axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n      // VueCookies.set(\"anonToken\", token, COOKIE_TIMEOUT);\r\n    }\r\n\r\n    return (token || \"\") != \"\";\r\n  },\r\n\r\n  delTokenHeader() {\r\n    delete axios.defaults.headers.common[\"Authorization\"];\r\n  },\r\n\r\n  isLoggedin() {\r\n    // return (JwtService.getLocalstoreToken()) ? true : false\r\n    return JwtService.getLocalstoreToken();\r\n  },\r\n\r\n  query(resource, params) {\r\n    try {\r\n      return Vue.axios.get(resource, params);\r\n    } catch (error) {\r\n      // console.log(\"query::error: \", error);\r\n      throw new Error(`[RWV] ApiService ${error}`);\r\n    }\r\n  },\r\n\r\n  get(resource, params = {}, loading = true, timeout = 15000) {\r\n    // console.log(\"jwtService.isTokenValid():\", jwtService.isTokenValid());\r\n    if (jwtService.isTokenValid()) {\r\n      if (!params.hasOwnProperty(\"params\")) {\r\n        params = { params: params };\r\n      }\r\n      params = { ...params, ...{ timeout: timeout } };\r\n      try {\r\n        Vue.axios.defaults.headers[\"doLoading\"] = loading;\r\n        // store.dispatch('actLoadingVisible', true)\r\n        // console.log(\"ApiService.get:\", params);\r\n        return Vue.axios.get(resource, params);\r\n      } catch (error) {\r\n        // console.log(\"get::error: \", error);\r\n        throw new Error(`[RWV] ApiService ${error}`);\r\n      }\r\n    } else {\r\n      return new Promise((response, reject) => { reject({ response: { data: \"Token inválido  ou expirado\" } }) });\r\n    }\r\n  },\r\n\r\n  post(resource, params = {}, loading = true) {\r\n    try {\r\n      Vue.axios.defaults.headers[\"doLoading\"] = loading;\r\n      return Vue.axios.post(resource, params);\r\n    } catch (error) {\r\n      // console.log(\"post::error: \", error);\r\n      throw new Error(`[RWV] ApiService ${error}`);\r\n    }\r\n  },\r\n\r\n  update(resource, params) {\r\n    try {\r\n      return Vue.axios.put(resource, params);\r\n    } catch (error) {\r\n      // console.log(\"update::error: \", error);\r\n      throw new Error(`[RWV] ApiService ${error}`);\r\n    }\r\n  },\r\n\r\n  put(resource, params) {\r\n    try {\r\n      return Vue.axios.put(`${resource}`, params);\r\n    } catch (error) {\r\n      // console.log(\"put::error: \", error);\r\n      throw new Error(`[RWV] ApiService ${error}`);\r\n    }\r\n  },\r\n\r\n  delete(resource) {\r\n    try {\r\n      return Vue.axios.delete(resource);\r\n    } catch (error) {\r\n      // console.log(\"delete::error: \", error);\r\n      throw new Error(`[RWV] ApiService ${error}`);\r\n    }\r\n  },\r\n\r\n  // auth pode ser 0=sem; 1=auth anonimo; 2=auth login\r\n  // não está sendo usado...\r\n  callMethod(method, resource = \"\", config = {}, auth = 0) {\r\n    if (auth === 1) {\r\n      this.setAnonHeader();\r\n    }\r\n    if (auth === 2) {\r\n      this.setAuthHeader();\r\n    }\r\n\r\n    if (method === \"query\") {\r\n      return this.query(resource, config);\r\n    }\r\n    if (method === \"get\") {\r\n      return this.get(resource);\r\n    }\r\n    if (method === \"post\") {\r\n      return this.post(resource, config);\r\n    }\r\n    if (method === \"update\") {\r\n      return this.update(resource, config);\r\n    }\r\n    if (method === \"put\") {\r\n      return this.put(resource, config);\r\n    }\r\n    if (method === \"delete\") {\r\n      return this.delete(resource);\r\n    }\r\n  },\r\n\r\n  // teste\r\n  prepareData(response) {\r\n    let data = {\r\n      busy: false,\r\n      apiresponse: response,\r\n      success: response && (response.Success || response.Success == \"True\"),\r\n      error: (response && response.Error) || [],\r\n      data: (response && response.Data) || [],\r\n    };\r\n    // console.log(\"ApiService.response:\", response);\r\n    // console.log(\"ApiService.data:\", data);\r\n    return data;\r\n  },\r\n\r\n  checkupdate(storename) {\r\n    if (!store.getters.gtxupdates || store.getters.gtxupdates.length == 0) {\r\n      store.dispatch(\"actUpdates\", storename).then(() => {\r\n        // chama novamente pq agora tem o updates ...\r\n        this.checkupdate(storename);\r\n      });\r\n    } else {\r\n      // TODO: criar função que verifica se a store está lá ou se precisa atualizar ...\r\n      let lStore = localstore.getUserStoreDataByName(storename);\r\n      if (lStore) lStore.updatedate = new Date(lStore.updatedate);\r\n\r\n      // console.log('ApiService.lStore:', lStore)\r\n      // console.log('ApiService.gtxupdates:', store.getters.gtxupdates)\r\n\r\n      const update = store.getters[\"gtxupdates\"].find(\r\n        (u) => u.store == storename\r\n      ) || { updatedate: new Date() };\r\n\r\n      // console.log('ApiService.storename:', storename)\r\n      // console.log('ApiService.gtxupdates:', update.updatedate)\r\n\r\n      // se a data da última atualização for menor que a atual, força uma atualização ...\r\n      if (lStore && lStore.updatedate) {\r\n        // console.log('ApiService.lStore:    ', lStore.updatedate)\r\n        if (lStore.updatedate < update.updatedate) lStore = null;\r\n      }\r\n\r\n      return lStore;\r\n    }\r\n  },\r\n\r\n  // metodos para salvar no vuex...\r\n  setStore(rota, params, stores) {\r\n    // se passar somente o nome, monta o objeto\r\n    if (typeof stores == \"string\") {\r\n      stores = {\r\n        name: stores,\r\n        route: rota,\r\n        getter: `gtx${stores}`,\r\n        setter: `set${stores}`,\r\n        action: `act${stores}`,\r\n      };\r\n    }\r\n\r\n    // verifica se precia atualizar a store ou pegar do localStorage ...\r\n    let lStore = this.checkupdate(stores.name);\r\n\r\n    if (lStore) {\r\n      // console.log('APiService.setStore: Get', stores.name, 'from localStore')\r\n      if (lStore.hasOwnProperty(\"data\")) lStore = lStore.data;\r\n      if (stores.setter) store.commit(stores.setter, lStore);\r\n    } else {\r\n      //console.log('APiService.setStore: Get', stores.name, 'from API')\r\n      // console.log('ApiService: ', stores.setter, ':', lStore)\r\n\r\n      // se está autenticado...\r\n      if (store.getters[\"gtxloginAuth\"]) {\r\n        ApiService.setAuthHeader(store.getters[\"gtxAuthToken\"]);\r\n      } else {\r\n        ApiService.setAnonHeader();\r\n      }\r\n      const config = {\r\n        params: {\r\n          Pesquisa: params ? params.pesquisa : \"%\",\r\n          PageNumber: params ? params.PageNumber : 1,\r\n          PageCount: params ? params.PageCount : 100,\r\n        },\r\n      };\r\n\r\n      // console.log('ApiService::rota', rota)\r\n      // console.log('ApiService::config', config)\r\n\r\n      ApiService.get(rota, config).then((res) => {\r\n        // console.log('res.data: ', res.data)\r\n        // adiciona a data que foi atualizado ...\r\n        if (res.data.Success == \"True\" || res.data.Success) {\r\n          // console.log(stores.name, res.data.Data)\r\n          if (stores.setter) store.commit(stores.setter, res.data.Data);\r\n\r\n          //salva a store no nome do login ...\r\n          // localstore.setlocalStore(stores.name, res.data.Data)\r\n          localstore.setUserStoreData(stores.name, res.data.Data);\r\n        } else {\r\n          throw new Error(`[ApiService] ${res.data.error}`);\r\n        }\r\n      });\r\n      /* .catch(error => {\r\n                        console.log('ApiService::stores.', stores)\r\n                            // console.error(error.message)\r\n                        if (typeof(error) == 'string') console.log('ApiService.setStore string: ', error)\r\n                        if (typeof(error) == 'object') console.log('ApiService.setStore object: ', error)\r\n                        throw new Error(`[ApiService] ${error}`)\r\n                    }) */\r\n      /* } else {\r\n        console.error(\"Usuário não autenticado\");\r\n        store.commit(\"setAlert\", {\r\n          message: \"Usuário não autenticado!\",\r\n          variant: \"danger\",\r\n        });\r\n\r\n        // console.log('loginAuth:', store.getters['gtxAuthAll'])\r\n        throw new Error(\"[ApiService] Usuário não autenticado\");\r\n      } */\r\n    }\r\n  },\r\n\r\n  // depraced\r\n  saveStore(storename, data) {\r\n    // let savestore = JSON.parse(localStorage.getItem(storename))\r\n\r\n    // if (!savestore) localStorage.setItem(storename, JSON.stringify(data))\r\n\r\n    localStorage.setItem(storename, JSON.stringify(data));\r\n\r\n    // salva também na store do usuario ...\r\n    // menos se for ele mesmo\r\n    if (storename !== JwtService.getUserName() && storename !== \"loginAnon\") {\r\n      this.saveUserState(storename, data);\r\n    }\r\n  },\r\n\r\n  // salva o state do usuário logado, e atualiza se já tiver dados salvos no localstore para\r\n  // não perder as stores de dados do storedata ...\r\n  saveUserState(storename, data) {\r\n    // pega do localstore se existir ...\r\n    let luser = JwtService.getUserStore(storename);\r\n\r\n    // se já tem o usuário salvo no localstore, atualiza ...\r\n    if (!luser) {\r\n      luser = data;\r\n    } else {\r\n      luser.auth = data.auth;\r\n      luser.token = data.token;\r\n      luser.lastLogin = data.lastLogin;\r\n    }\r\n\r\n    localstore.savelocalStore(storename, luser);\r\n  },\r\n\r\n  saveStoredata(storename, data) {\r\n    // pega do localstore se existir ...\r\n    let luser = JwtService.getUserStore(storename);\r\n\r\n    // se não tem o storedata cria vazio\r\n    if (!luser.storedata) luser.storedata = [];\r\n\r\n    let ldata = luser.storedata.find((s) => s.store == storename);\r\n\r\n    if (!ldata) {\r\n      ldata = { store: storename, data: data };\r\n      luser.storedata.push(ldata);\r\n    } else {\r\n      ldata.data = data;\r\n    }\r\n\r\n    // salva a store na store do login ...\r\n    localstore.setlocalStore(storename, ldata);\r\n  },\r\n\r\n  // salva a store com o nome do usuário logado ...\r\n  saveStoreUser(username, data) {\r\n    localStorage.setItem(\"loginAuth\", username);\r\n    this.saveUserState(username, data);\r\n  },\r\n\r\n  downloadFile({ url, filename }) {\r\n    Vue.axios\r\n      .get(url, { responseType: \"blob\" })\r\n      .then((response) => {\r\n        const ext = `.${url.split(\".\").reverse()[0]}`; // pega o último ponto que é a extensão do arquivo\r\n        const mime =\r\n          mimes.find((m) => m.extensao == ext) || \"application/octet-stream\";\r\n        const blob = new Blob([response.data], {\r\n          type: mime,\r\n        });\r\n        const link = document.createElement(\"a\");\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = filename;\r\n        link.click();\r\n        URL.revokeObjectURL(link.href);\r\n      })\r\n      .catch(console.error);\r\n  },\r\n};\r\n\r\n// inicia as configurações ...\r\nApiService.init();\r\n\r\n// INICIO - Interceptors\r\n// quando requisitar um endpoint\r\naxios.interceptors.request.use(\r\n  async (config) => {\r\n    const token = cookies.getcookie(\"token\") || cookies.getcookie(\"anontoken\") || \"\";\r\n\r\n    // se o token não é mais válido...\r\n    if (!JwtService.isTokenValid(token)) {\r\n      if (JwtService.getUserName(token) == \"AnonymousAPI\") {\r\n        // renova\r\n        console.log('Precisa renovar o token anonimo');\r\n        // ApiService.apiRenewToken.notify(JwtService.getUserName(token));\r\n      } else {\r\n        return config;\r\n      }\r\n    } else {\r\n      if (JwtService.getUserName(token) == \"AnonymousAPI\") {\r\n        Vue.$cookies.set(\"anontoken\", token, COOKIE_ANONIMOUSTOKEN);\r\n      } else {\r\n        Vue.$cookies.set(\"token\", token, COOKIE_TIMEOUT);\r\n      }\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n\r\n    const loading = config.headers[\"doLoading\"];\r\n    if (loading) ApiService.loadObserver.notify(true);\r\n\r\n    return config;\r\n  },\r\n  (error) => {\r\n    Promise.reject(error);\r\n  }\r\n);\r\n\r\n// quando responder \r\naxios.interceptors.response.use(\r\n  (res) => {\r\n    // console.log(\"ApiService.router:\", router.history.current.path);\r\n    // console.log(\"ApiService.response:\", res.config.data);\r\n    const notifications = {\r\n      variant: \"success\",\r\n      message: \"\",\r\n    };\r\n    if (res.config.url === \"Authentication\") {\r\n      const user = JSON.parse(res.config.data);\r\n      const isAuth = (res.data.TokenAccess || \"\") !== \"\";\r\n      if (isAuth) {\r\n        res.config.headers.Authorization = `Bearer: ${res.data.TokenAccess}`;\r\n        Vue.$cookies.set(\"token\", res.data.TokenAccess, COOKIE_TIMEOUT);\r\n        Vue.$cookies.set(\"lastlogin\", user.User);\r\n        notifications.message = \"Autenticado com sucesso!\";\r\n        notifications.variant = \"success\";\r\n        ApiService.notifyObserver.notify(notifications);\r\n      }\r\n      ApiService.loginObserver.notify(isAuth);\r\n    }\r\n\r\n    if (res.config.url === \"Authentication/GetAnonymousToken\") {\r\n      Vue.axios.defaults.headers.common.Authorization = `Bearer: ${res.data.TokenAccess}`;\r\n      Vue.$cookies.set(\"anontoken\", res.data.TokenAccess, { expires: \"1D\" });\r\n      // console.log(\"Anonymous:\", '\"Autenticado com sucesso!\"');\r\n    }\r\n\r\n    // isso testa as duas APIs a Normal e a v2\r\n    if (res.data.Success === \"False\" || res.data.Success === false) {\r\n      notifications.variant = \"danger\";\r\n      notifications.message = res.data.Error;\r\n      ApiService.notifyObserver.notify(notifications);\r\n    }\r\n\r\n    ApiService.loadObserver.notify(false);\r\n    return res;\r\n  },\r\n  (err) => {\r\n    // console.log(\"ApiService.error.router.history.current:\",router.history.current);\r\n    // console.log(\"err:\", err);\r\n    const error = {\r\n      error: err,\r\n      response: null,\r\n      route: router.history.current.path,\r\n      status: 0,\r\n      data: null,\r\n      headers: null,\r\n      message: null,\r\n      variant: \"\",\r\n    };\r\n\r\n    if (err.code == \"ECONNABORTED\") {\r\n      store.dispatch(\r\n        \"setdanger\",\r\n        \"Tempo excedido para a execução desta requisição\"\r\n      );\r\n      error.message = \"Tempo excedido para a execução desta requisição\";\r\n    } else {\r\n      if (!err.response) {\r\n        // store.dispatch(\r\n        //   \"setdanger\",\r\n        //   \"Erro geral de rede!!!\\nVerifique sua conexão com a internet\"\r\n        // );\r\n        error.message =\r\n          \"Erro geral de rede!!! Verifique sua conexão com a internet\";\r\n      } else {\r\n        error.status = err.response.status;\r\n        error.data = err.response.data;\r\n        error.headers = err.response.headers;\r\n        error.response = err.response;\r\n        switch (err.response.status) {\r\n          case 400:\r\n            if (err.response.data.User) {\r\n              // store.dispatch('setdanger', 'Necessário informar o usuário')\r\n              // store.dispatch('setauth', false)\r\n              error.message = \"Necessário informar o usuário\";\r\n              error.variant = \"info\";\r\n            } else {\r\n              if (err.response.data.Password) {\r\n                // store.dispatch('setdanger', 'Necessário informar a senha')\r\n                // store.dispatch('setauth', false)\r\n                error.message = \"Necessário informar a senha\";\r\n                error.variant = \"info\";\r\n              } else {\r\n                if (err.response.data.data) {\r\n                  // store.dispatch('setdanger', `400 - ${err.response.data.data[0]}`)\r\n                  error.message = err.response.data.data[0];\r\n                  error.variant = \"warning\";\r\n                } else {\r\n                  // store.dispatch('setdanger', `400 - ${err.response.data}`)\r\n                  error.message = err.response.data;\r\n                  error.variant = \"warning\";\r\n                }\r\n                // store.dispatch('setauth', false)\r\n                // Vue.methods.toastdanger('Erro de autenticação!')\r\n              }\r\n            }\r\n            break;\r\n          case 401:\r\n            // store.dispatch('setdanger', '401 - Erro na autenticação, verifique usuário e senha')\r\n            // store.dispatch('logoff')\r\n            if (err.response.data) {\r\n              error.message = err.response.data;\r\n            } else {\r\n              error.message = \"Erro na autenticação, verifique usuário e senha\";\r\n              // ApiService.loginEmit(false);\r\n              ApiService.loginObserver.notify(false);\r\n            }\r\n            error.variant = \"info\";\r\n            break;\r\n          case 404:\r\n            // console.log(\"router:\", router.currentRoute);\r\n            // store.dispatch('setdanger', '404 - Página inexistente')\r\n            error.message = \"Página inexistente\";\r\n            error.variant = \"danger\";\r\n            break;\r\n          default:\r\n            // store.dispatch('setdanger', 'Ocorreu um erro na requisição')\r\n            error.message = \"Ocorreu um erro na requisição\";\r\n            error.variant = \"danger\";\r\n        }\r\n      }\r\n    }\r\n    // console.log(\"ApiService.err:\", err);\r\n    // console.log(\"ApiService.error:\", error);\r\n\r\n    // ApiService.errorEmit(error);\r\n    ApiService.errorObserver.notify(error);\r\n\r\n    // if (error.variant == \"danger\") {\r\n    //  store.dispatch(\"seterrors\", error);\r\n    // } else {\r\n    //   store.dispatch(\"actToast\", error);\r\n    // }\r\n\r\n    // store.dispatch('setloading', false)\r\n    // ApiService.loadingEmit(false);\r\n    ApiService.loadObserver.notify(false);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n// FIM - Interceptors\r\n\r\n// console.log('ApiService::depois de chamar o init')\r\n\r\nexport default ApiService;\r\n"],"mappings":"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"}]}