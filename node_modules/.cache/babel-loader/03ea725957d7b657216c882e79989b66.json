{"remainingRequest":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js!C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\k1-services\\src\\pages\\coleta\\views\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\k1-services\\src\\pages\\coleta\\views\\index.vue","mtime":1701906516453},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js","mtime":1670977935138},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js","mtime":1674603023821}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBcGlTZXJ2aWNlIGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2FwaS5zZXJ2aWNlJzsKaW1wb3J0IENvbGV0YUVBTiBmcm9tICcuLi8uLi8uLi9jb21wb25lbnRzL0NvbGV0YUVBTic7CmltcG9ydCB7IHNhdmVUb0NTViB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL2Nzdic7CmltcG9ydCB7IG1hcEFjdGlvbnMgfSBmcm9tICd2dWV4JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDb2xldGFMaXZyZScsCiAgYmVmb3JlTW91bnQoKSB7CiAgICB0aGlzLmNvbnN1bHRhQ29sZXRhcygpOwogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG5vbWU6IHsKICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgc2hvdzogZmFsc2UsCiAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgIHRpdGxlOiAnTm9tZSBkYSBjYXRlZ29yaWEnLAogICAgICAgIHBsYWNlaG9sZGVyOiAnSW5mb3JtZSBvIG5vbWUgZGEgY2F0ZWdvcmlhJwogICAgICB9LAogICAgICBjb2xldGFzOiBbXSwKICAgICAgY29uc3VsdGFjb2xldGFzOiBbXSwKICAgICAgY29sZXRhc3htbDogJycsCiAgICAgIGRlc3Rpbm86IG51bGwsCiAgICAgIGRlc3Rpbm9zOiBbewogICAgICAgIHZhbHVlOiAxLAogICAgICAgIHRleHQ6ICdDb25mZXLDqm5jaWEgZGUgSW1vYmlsaXphZG9zJwogICAgICB9LCB7CiAgICAgICAgdmFsdWU6IDIsCiAgICAgICAgdGV4dDogJ0NvbmZlcsOqbmNpYSBFeHBlZGnDp8O1ZXMnCiAgICAgIH0sIHsKICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICB0ZXh0OiAnLScsCiAgICAgICAgZGlzYWJsZWQ6IHRydWUKICAgICAgfSwgewogICAgICAgIHZhbHVlOiAtMSwKICAgICAgICB0ZXh0OiAnU2FsdmFyIGVtIEFycXVpdm8gQ1NWJwogICAgICB9XQogICAgfTsKICB9LAogIGNvbXBvbmVudHM6IHsKICAgIENvbGV0YUVBTgogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGNvbmZpZygpIHsKICAgICAgcmV0dXJuIGA8ZGF0YT48aWRDb2xldGFUaXBvPiR7dGhpcy5kZXN0aW5vfTwvaWRDb2xldGFUaXBvPjxOb21lQ2F0ZWdvcmlhPiR7dGhpcy5ub21lLnZhbHVlfTwvTm9tZUNhdGVnb3JpYT48L2RhdGE+YDsKICAgIH0sCiAgICBjb2xldGFzTk9lbnRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMuY29sZXRhcy5tYXAoYyA9PiB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGVhbjogYy5lYW4ucmVwbGFjZSgnXG4nLCAnJykKICAgICAgICB9OwogICAgICB9KTsKICAgIH0sCiAgICBwYWdlQ29sZXRhcygpIHsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgdGl0bGU6IGBDb2xldGFzIEVudmlhZGFzICggJHt0aGlzLmNvbnN1bHRhY29sZXRhcy5sZW5ndGh9IClgLAogICAgICAgIHRhYmxlOiB0cnVlLAogICAgICAgIGRhdGE6IHRoaXMuY29uc3VsdGFjb2xldGFzLAogICAgICAgIGZpZWxkczogW3sKICAgICAgICAgIGtleTogJ0NhdGVnb3JpYScsCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ0VhbicsCiAgICAgICAgICBzb3J0YWJsZTogdHJ1ZQogICAgICAgIH0sIHsKICAgICAgICAgIGtleTogJ0RhdGFDb2xldGEnLAogICAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgICB9XQogICAgICB9XTsKICAgIH0KICB9LAogIGJlZm9yZU1vdW50KCkgewogICAgdGhpcy5idXNjYVRpcG9zQ29sZXRhcygpOwogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwQWN0aW9ucyhbJ2FjdFRvYXN0J10pLAogICAgb25FbnZpYUNvbGV0YVhNTChjb2xldGFzKSB7CiAgICAgIHRoaXMuY29sZXRhc3htbCA9IGNvbGV0YXM7CiAgICAgIHRoaXMuJGJ2TW9kYWwuc2hvdygnY29sZXRhY2F0ZWdvcmlhJyk7CiAgICB9LAogICAgb25FbnZpYUNvbGV0YShjb2xldGFzKSB7CiAgICAgIHRoaXMuY29sZXRhcyA9IGNvbGV0YXM7CiAgICAgIHRoaXMuJGJ2TW9kYWwuc2hvdygnY29sZXRhY2F0ZWdvcmlhJyk7CiAgICB9LAogICAgZW52aWFDb2xldGFzKCkgewogICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZywKICAgICAgICBkYXRhOiB0aGlzLmNvbGV0YXN4bWwKICAgICAgfTsKCiAgICAgIC8vIHNhbHZhIGVtIGFycXVpdm8gdGV4dG8gLi4uCiAgICAgIGlmICh0aGlzLmRlc3Rpbm8gPT0gLTEpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygnZW52aWFDb2xldGFzOicsIHRoaXMuY29sZXRhcykKICAgICAgICBzYXZlVG9DU1YodGhpcy5jb2xldGFzTk9lbnRlciwgYCR7dGhpcy5ub21lLnZhbHVlfS5jc3ZgKTsKICAgICAgfQogICAgICBpZiAodGhpcy5kZXN0aW5vID4gMCkgewogICAgICAgIEFwaVNlcnZpY2Uuc2V0QXV0aEhlYWRlcigpOwogICAgICAgIEFwaVNlcnZpY2UucG9zdCgnU2Vydmljb3MvQ29sZXRhcy9JbnNlcnQnLCBwYXJhbXMpLnRoZW4ocmVzID0+IHsKICAgICAgICAgIHRoaXMuY29sZXRhcyA9IFtdOwogICAgICAgICAgdGhpcy5jb2xldGFzeG1sID0gJyc7CiAgICAgICAgICB0aGlzLmNvbnN1bHRhQ29sZXRhcygpOwogICAgICAgICAgdGhpcy5hY3RUb2FzdCh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICdSZWdpc3RybyBzYWx2byBjb20gc3VjZXNzbyAhJywKICAgICAgICAgICAgdmFyaWFudDogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvOiAnLCBlKTsKICAgICAgICAgIHRoaXMuYWN0VG9hc3QoewogICAgICAgICAgICBtZXNzYWdlOiAnRXJybyBhbyBpbmNsdWlyIG8gcmVnaXN0cm8gIScsCiAgICAgICAgICAgIHZhcmlhbnQ6ICdkYW5nZXInCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGNvbnN1bHRhQ29sZXRhcygpIHsKICAgICAgQXBpU2VydmljZS5zZXRBdXRoSGVhZGVyKCk7CiAgICAgIEFwaVNlcnZpY2UucG9zdCgnU2Vydmljb3MvQ29sZXRhcy9TZWxlY3QnLCB7fSkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMuY29uc3VsdGFjb2xldGFzID0gW107CiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gJzIwMCcgJiYgcmVzLmRhdGEuU3VjY2VzcyA9PSAnVHJ1ZScpIHRoaXMuY29uc3VsdGFjb2xldGFzID0gcmVzLmRhdGEuRGF0YTsKICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ0Vycm86ICcsIGUpOwogICAgICAgIHRoaXMuYWN0VG9hc3QoewogICAgICAgICAgbWVzc2FnZTogJ0Vycm8gYW8gY29uc3VsdGFyIGNvbGV0YXMgIScsCiAgICAgICAgICB2YXJpYW50OiAnZGFuZ2VyJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBidXNjYVRpcG9zQ29sZXRhcygpIHsKICAgICAgQXBpU2VydmljZS5zZXRBdXRoSGVhZGVyKCk7CiAgICAgIEFwaVNlcnZpY2UucG9zdCgnU2Vydmljb3MvQ29sZXRhc1RpcG9zL1NlbGVjdCcsIHt9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT0gJzIwMCcgJiYgKHJlcy5kYXRhLlN1Y2Nlc3MgPT0gJ1RydWUnIHx8IHJlcy5kYXRhLlN1Y2Nlc3MpKSB7CiAgICAgICAgICB0aGlzLmRlc3Rpbm9zID0gW107CiAgICAgICAgICB0aGlzLmRlc3Rpbm9zID0gcmVzLmRhdGEuRGF0YS5tYXAobSA9PiAoewogICAgICAgICAgICB2YWx1ZTogbS5pZCwKICAgICAgICAgICAgdGV4dDogbS5EZXNjcmljYW8KICAgICAgICAgIH0pKTsKICAgICAgICAgIHRoaXMuZGVzdGlub3MucHVzaCh7CiAgICAgICAgICAgIHZhbHVlOiBudWxsLAogICAgICAgICAgICB0ZXh0OiAnLScsCiAgICAgICAgICAgIGRpc2FibGVkOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuZGVzdGlub3MucHVzaCh7CiAgICAgICAgICAgIHZhbHVlOiAtMSwKICAgICAgICAgICAgdGV4dDogJ1NhbHZhciBlbSBBcnF1aXZvIENTVicKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ0Vycm86ICcsIGUpOwogICAgICAgIHRoaXMuYWN0VG9hc3QoewogICAgICAgICAgbWVzc2FnZTogJ0Vycm8gYW8gY29uc3VsdGFyIHRpcG9zIGRlIGNvbGV0YXMgIScsCiAgICAgICAgICB2YXJpYW50OiAnZGFuZ2VyJwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;AAEA;EACAA;EACAC;IACA;EACA;EAEAC;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC,WACA;QAAAT;QAAAU;MAAA,GACA;QAAAV;QAAAU;MAAA,GACA;QAAAV;QAAAU;QAAAC;MAAA,GACA;QAAAX;QAAAU;MAAA;IAEA;EACA;EAEAE;IACAC;EACA;EAEAC;IACAC;MACA;IACA;IACAC;MACA;QAAA;UAAAC;QAAA;MAAA;IACA;IACAC;MACA,QACA;QAAAf;QACAgB;QACArB;QACAsB,SACA;UAAAC;UAAAC;QAAA,GACA;UAAAD;UAAAC;QAAA,GACA;UAAAD;UAAAC;QAAA;MACA,EACA;IACA;EACA;EAEAzB;IACA;EACA;EAEA0B;IACA;IAEAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;QAAAX;QAAAjB;MAAA;;MAEA;MACA;QACA;QACA6B;MACA;MAEA;QACAC;QACAA,mDACAC;UACA;UACA;UACA;UACA;YAAAC;YAAAC;UAAA;QACA,GACAC;UACAC;UACA;YAAAH;YAAAC;UAAA;QACA;MACA;IACA;IACAG;MACAN;MACAA,+CACAC;QACA;QACA,uDACA;MACA,GACAG;QACAC;QACA;UAAAH;UAAAC;QAAA;MACA;IACA;IACAI;MACAP;MACAA,oDACAC;QACA;UACA;UACA;YAAA7B;YAAAU;UAAA;UACA;YAAAV;YAAAU;YAAAC;UAAA;UACA;YAAAX;YAAAU;UAAA;QACA;MACA,GACAsB;QACAC;QACA;UAAAH;UAAAC;QAAA;MACA;IACA;EACA;AACA","names":["name","beforeMount","data","nome","value","show","type","title","placeholder","coletas","consultacoletas","coletasxml","destino","destinos","text","disabled","components","ColetaEAN","computed","config","coletasNOenter","ean","pageColetas","table","fields","key","sortable","methods","onEnviaColetaXML","onEnviaColeta","enviaColetas","saveToCSV","ApiService","then","message","variant","catch","console","consultaColetas","buscaTiposColetas"],"sourceRoot":"src/pages/coleta/views","sources":["index.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <!-- <b-button @click=\"buscaTiposColetas\">Busca tipos de coletas</b-button> -->\r\n        <b-card class=\"m-2\" bg-variant=\"dark\" text-variant=\"warning\">\r\n            <b-form-group \r\n                id=\"input-group-destino\"\r\n                label=\"Destino\"\r\n                label-for=\"input-destino\">\r\n                <b-form-select\r\n                    autofocus\r\n                    id=\"input-destino\"\r\n                    v-model=\"destino\"\r\n                    :options=\"destinos\">\r\n                </b-form-select>\r\n            </b-form-group>             \r\n        </b-card>\r\n\r\n        <ColetaEAN\r\n            :disableenvio=\"(destino || 0) == 0\"\r\n            :eanfields=\"[{key: 'ean', label: 'Ean'}, {key: 'actions', label: 'Ações'}]\"\r\n            :histfields=\"[{key: 'ean', label: 'Ean'}, {key: 'actions', label: 'Ações'}]\"\r\n            :customPages=\"pageColetas\"\r\n            @evt-coletas-xml=\"onEnviaColetaXML\"\r\n            @evt-coletas=\"onEnviaColeta\"\r\n        />\r\n\r\n<!--         coletasxml: {{coletasxml}}<br>\r\n        destino: {{(destino || 0) == 0}}<br>\r\n        config: {{config}} -->\r\n\r\n        <b-modal\r\n            id=\"modal-enviar\"\r\n            title=\"Escolha o destino da coleta\"\r\n            ok-only\r\n            :ok-disabled=\"!destino\"\r\n            @ok=\"enviaColetas\">\r\n\r\n            <b-form-group \r\n                id=\"input-group-destino\"\r\n                label=\"Destino\"\r\n                label-for=\"input-destino\">\r\n                <b-form-select\r\n                    id=\"input-destino\"\r\n                    v-model=\"destino\"\r\n                    :options=\"destinos\">\r\n                </b-form-select>\r\n            </b-form-group> \r\n\r\n        </b-modal>\r\n\r\n        <Inputmodal\r\n            idmodal=\"coletacategoria\"\r\n            v-model=\"nome.value\"\r\n            :type=\"nome.type\"\r\n            :title=\"nome.title\"\r\n            :placeholder=\"nome.placeholder\"\r\n            @inputmodel=\"enviaColetas\"\r\n        />\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport ApiService from '../../../services/api.service'\r\nimport ColetaEAN from '../../../components/ColetaEAN'\r\nimport { saveToCSV } from '../../../services/csv'\r\nimport { mapActions } from 'vuex'\r\n\r\nexport default {\r\n    name: 'ColetaLivre',\r\n    beforeMount() {\r\n        this.consultaColetas()\r\n    },\r\n\r\n    data() {\r\n        return {\r\n            nome: {\r\n                value: '',\r\n                show: false,\r\n                type: 'text',\r\n                title: 'Nome da categoria',\r\n                placeholder: 'Informe o nome da categoria'\r\n            },\r\n            coletas: [],\r\n            consultacoletas: [],\r\n            coletasxml: '',\r\n            destino: null,\r\n            destinos: [\r\n                { value: 1, text: 'Conferência de Imobilizados' },\r\n                { value: 2, text: 'Conferência Expedições' },\r\n                { value: null, text: '-', disabled: true },\r\n                { value: -1, text: 'Salvar em Arquivo CSV' },\r\n            ],\r\n        }\r\n    },\r\n\r\n    components: {\r\n        ColetaEAN\r\n    },\r\n\r\n    computed: {\r\n        config() {\r\n            return `<data><idColetaTipo>${this.destino}</idColetaTipo><NomeCategoria>${this.nome.value}</NomeCategoria></data>`\r\n        },\r\n        coletasNOenter() {\r\n          return this.coletas.map(c => { return { ean: c.ean.replace('\\n', '') } });\r\n        },\r\n        pageColetas() {\r\n            return [\r\n                { title: `Coletas Enviadas ( ${this.consultacoletas.length} )`\r\n                , table: true\r\n                , data: this.consultacoletas\r\n                , fields: [\r\n                    { key: 'Categoria', sortable: true },\r\n                    { key: 'Ean', sortable: true },\r\n                    { key: 'DataColeta', sortable: true }\r\n                ]}\r\n            ]\r\n        }\r\n    },\r\n\r\n    beforeMount() {\r\n      this.buscaTiposColetas();\r\n    },\r\n\r\n    methods: {\r\n        ...mapActions(['actToast']),\r\n\r\n        onEnviaColetaXML(coletas) {\r\n            this.coletasxml = coletas\r\n            this.$bvModal.show('coletacategoria')\r\n        },\r\n        onEnviaColeta(coletas) {\r\n            this.coletas = coletas\r\n            this.$bvModal.show('coletacategoria')\r\n        },\r\n        enviaColetas() {\r\n            const params = { config: this.config, data: this.coletasxml }\r\n\r\n            // salva em arquivo texto ...\r\n            if (this.destino == -1) {\r\n                // console.log('enviaColetas:', this.coletas)\r\n                saveToCSV( this.coletasNOenter,  `${this.nome.value}.csv` )\r\n            }\r\n\r\n            if (this.destino > 0) {\r\n                ApiService.setAuthHeader()\r\n                ApiService.post('Servicos/Coletas/Insert', params)\r\n                    .then((res) => {\r\n                        this.coletas = []\r\n                        this.coletasxml = ''\r\n                        this.consultaColetas()\r\n                        this.actToast({ message: 'Registro salvo com sucesso !', variant: 'success'})\r\n                    })\r\n                    .catch(e => {\r\n                        console.log('Erro: ', e)\r\n                        this.actToast({ message: 'Erro ao incluir o registro !', variant: 'danger'})\r\n                    })\r\n            }\r\n        },\r\n        consultaColetas() {\r\n            ApiService.setAuthHeader()\r\n            ApiService.post('Servicos/Coletas/Select', {})\r\n                .then((res) => {\r\n                    this.consultacoletas = []\r\n                    if ((res.status == '200') && (res.data.Success == 'True'))\r\n                      this.consultacoletas = res.data.Data\r\n                })\r\n                .catch(e => {\r\n                    console.log('Erro: ', e)\r\n                    this.actToast({ message: 'Erro ao consultar coletas !', variant: 'danger'})\r\n                })\r\n        },\r\n        buscaTiposColetas() {\r\n            ApiService.setAuthHeader()\r\n            ApiService.post('Servicos/ColetasTipos/Select', {})\r\n                .then((res) => {\r\n                  if ((res.status == '200') && (res.data.Success == 'True' || res.data.Success)) {\r\n                    this.destinos = [];\r\n                    this.destinos = res.data.Data.map(m => ({ value: m.id, text: m.Descricao }));\r\n                    this.destinos.push({ value: null, text: '-', disabled: true });\r\n                    this.destinos.push({ value: -1, text: 'Salvar em Arquivo CSV' });\r\n                  }\r\n                })\r\n                .catch(e => {\r\n                    console.log('Erro: ', e)\r\n                    this.actToast({ message: 'Erro ao consultar tipos de coletas !', variant: 'danger'})\r\n                })\r\n        }\r\n    }\r\n}\r\n</script>\r\n"]}]}