{"remainingRequest":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\k1-services\\src\\components\\SearchApiNumber.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\k1-services\\src\\components\\SearchApiNumber.vue","mtime":1670977910589},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\babel-loader\\lib\\index.js","mtime":1670977935138},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js","mtime":1670977935327}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgQVBJIGZyb20gIi4uL3NlcnZpY2VzL2FwaS5zZXJ2aWNlIjsNCmltcG9ydCBUYWJsZUVkaXRBcGkgZnJvbSAiLi9UYWJsZUVkaXRBcGkudnVlIjsNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIlNlYXJjaEFwaU51bWJlciIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBUYWJsZUVkaXRBcGksDQogIH0sDQogIHByb3BzOiB7DQogICAgdmFsdWU6IHsNCiAgICAgIHR5cGU6IE51bWJlciwNCiAgICAgIGRlZmF1bHQ6IDAsDQogICAgfSwNCiAgICBwa2lkOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiBNYXRoLnJhbmRvbSgzMikudG9TdHJpbmcoMzIpLnNwbGl0KCIuIiksDQogICAgICByZXF1aXJlZDogdHJ1ZSwNCiAgICB9LA0KICAgIHRpdGxlOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAiUGVzcXVpc2FyLi4uIiwNCiAgICB9LA0KICAgIHJvdXRlOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAiIiwNCiAgICB9LA0KICAgIGl0ZW1zOiB7DQogICAgICB0eXBlOiBBcnJheSwNCiAgICAgIGRlZmF1bHQoKSB7DQogICAgICAgIHJldHVybiBbXQ0KICAgICAgfQ0KICAgIH0sDQogICAgbG9va3VwOiB7DQogICAgICB0eXBlOiBPYmplY3QsDQogICAgICBkZWZhdWx0KCkgew0KICAgICAgICByZXR1cm4geyB2YWx1ZTogInZhbHVlIiwgdGV4dDogInRleHQiLCBsYWJlbHZhbHVlOiAnQ8OzZGlnbycsIGxhYmVsdGV4dDogJ0Rlc2NyacOnw6NvJyB9Ow0KICAgICAgfSwNCiAgICB9LA0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBzZWFyY2h2YWx1ZTogdGhpcy52YWx1ZSwNCiAgICAgIHNlYXJjaHRleHQ6IHRoaXMudmFsdWUgfHwgIiIsDQogICAgICBzZWFyY2hmbGRzOiB0aGlzLmxvb2t1cCwNCiAgICAgIGRhdGE6IFtdLA0KICAgICAgc2VsZWN0ZWQ6IHtbdGhpcy5sb29rdXAudmFsdWVdOiAwLCBbdGhpcy5sb29rdXAudmFsdWVdOiAiIn0gLA0KICAgICAgZGlydHk6IHRydWUsDQogICAgICBtb2RhbGlkOiBgbW9kYWxfJHt0aGlzLnBraWR9YCwNCiAgICAgIHJhbmRvbWlkOiBNYXRoLnJhbmRvbSgzMikudG9TdHJpbmcoMzIpLnNwbGl0KCIuIiksDQogICAgfTsNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBwYXJhbXMoKSB7DQogICAgICByZXR1cm4gew0KICAgICAgICBwZXNxdWlzYTogdGhpcy5zZWFyY2h0ZXh0LA0KICAgICAgICBib2R5OiB0aGlzLnNlYXJjaHRleHQsDQogICAgICB9Ow0KICAgIH0sDQogICAgZmllbGRzKCkgew0KICAgICAgcmV0dXJuIFsNCiAgICAgICAgeyBrZXk6IHRoaXMubG9va3VwLnZhbHVlLCBsYWJlbDogdGhpcy5sb29rdXAubGFiZWx2YWx1ZSB8fCB0aGlzLmxvb2t1cC52YWx1ZSwgc29ydGFibGU6IHRydWUsIHZpc2libGU6IHRydWUgfSwNCiAgICAgICAgeyBrZXk6IHRoaXMubG9va3VwLnRleHQsIGxhYmVsOiB0aGlzLmxvb2t1cC5sYWJlbHRleHQgfHwgdGhpcy5sb29rdXAudGV4dCwgc29ydGFibGU6IHRydWUsIHZpc2libGU6IHRydWUgfQ0KICAgICAgXQ0KICAgIH0sDQogICAgeHJhbmRvbWlkKCkgew0KICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKDMyKQ0KICAgICAgICAgIC50b1N0cmluZygzMikNCiAgICAgICAgICAuc3BsaXQoIi4iKTsNCiAgICB9LA0KICAgIGFwaSgpIHsNCiAgICAgIHJldHVybiBgaHR0cHM6Ly9hcGkuZ3J1cG9rMS5jb20uYnIvYXBpL3YyLyR7dGhpcy5yb3V0ZX1gOw0KICAgIH0sDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBuZXh0SW5wdXQoKSB7DQogICAgICB2YXIga2V5Ym9hcmRFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdLZXlib2FyZEV2ZW50Jyk7DQogICAgICB2YXIgaW5pdE1ldGhvZCA9IHR5cGVvZiBrZXlib2FyZEV2ZW50LmluaXRLZXlib2FyZEV2ZW50ICE9PSAndW5kZWZpbmVkJyA/ICdpbml0S2V5Ym9hcmRFdmVudCcgOiAnaW5pdEtleUV2ZW50JzsNCg0KICAgICAga2V5Ym9hcmRFdmVudFtpbml0TWV0aG9kXSgNCiAgICAgICAgJ2tleWRvd24nLCAvLyBldmVudCB0eXBlOiBrZXlkb3duLCBrZXl1cCwga2V5cHJlc3MNCiAgICAgICAgdHJ1ZSwgLy8gYnViYmxlcw0KICAgICAgICB0cnVlLCAvLyBjYW5jZWxhYmxlDQogICAgICAgIHdpbmRvdywgLy8gdmlldzogc2hvdWxkIGJlIHdpbmRvdw0KICAgICAgICBmYWxzZSwgLy8gY3RybEtleQ0KICAgICAgICBmYWxzZSwgLy8gYWx0S2V5DQogICAgICAgIGZhbHNlLCAvLyBzaGlmdEtleQ0KICAgICAgICBmYWxzZSwgLy8gbWV0YUtleQ0KICAgICAgICA5LCAvLyBrZXlDb2RlOiB1bnNpZ25lZCBsb25nIC0gdGhlIHZpcnR1YWwga2V5IGNvZGUsIGVsc2UgMA0KICAgICAgICAwLCAvLyBjaGFyQ29kZTogdW5zaWduZWQgbG9uZyAtIHRoZSBVbmljb2RlIGNoYXJhY3RlciBhc3NvY2lhdGVkIHdpdGggdGhlIGRlcHJlc3NlZCBrZXksIGVsc2UgMA0KICAgICAgKTsNCiAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoa2V5Ym9hcmRFdmVudCk7DQogICAgfSwNCiAgICBnZXRQZWRpZG8oKSB7DQoNCiAgICB9LA0KICAgIGFzeW5jIGJ1c2Nhcih2YWx1ZSkgew0KICAgICAgaWYgKHZhbHVlID4gMCkgew0KICAgICAgICB0aGlzLnNlYXJjaHRleHQgPSB2YWx1ZTsNCiAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7DQogICAgICB9DQogICAgICAvLyBjb25zb2xlLmxvZygnYnVzY2FyLmRpcnR5OicsIHRoaXMuZGlydHkpOw0KICAgICAgLy8gY29uc29sZS5sb2coJ2J1c2Nhci52YWx1ZTonLCB0aGlzLnZhbHVlKTsNCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7DQogICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLml0ZW1zLmZpbHRlcihmPT4oZlt0aGlzLnNlYXJjaGZsZHMudmFsdWVdLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKS5pbmNsdWRlcyh0aGlzLnNlYXJjaHRleHQudG9TdHJpbmcoKS50b1VwcGVyQ2FzZSgpKSB8fCBmW3RoaXMuc2VhcmNoZmxkcy50ZXh0XS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXModGhpcy5zZWFyY2h0ZXh0LnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKSkpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhd2FpdCBBUEkucG9zdCh0aGlzLnJvdXRlLCB0aGlzLnBhcmFtcykudGhlbigoYXBpZGF0YSkgPT4gew0KICAgICAgICAgICAgY29uc3QgcmVzID0gQVBJLnByZXBhcmVEYXRhKGFwaWRhdGEuZGF0YSk7DQogICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsNCiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gcmVzLmRhdGE7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBbXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5kYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBpZiAodGhpcy5kYXRhLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgICB0aGlzLnNlbGVjdGRhdGEodGhpcy5kYXRhKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy4kYnZNb2RhbC5zaG93KHRoaXMubW9kYWxpZCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBldnRzZWxlY3QoZGF0YSkgew0KICAgICAgY29uc29sZS5sb2coImV2dHNlbGVjdDoiLCBkYXRhKTsNCiAgICAgIHRoaXMuc2VsZWN0ZGF0YShkYXRhKTsNCiAgICAgIHRoaXMuJGJ2TW9kYWwuaGlkZSh0aGlzLm1vZGFsaWQpOw0KICAgIH0sDQogICAgZXZ0cGFnZShkYXRhKSB7DQogICAgICBjb25zb2xlLmxvZygiZXZ0cGFnZToiLCBkYXRhKTsNCiAgICB9LA0KICAgIHNlbGVjdGRhdGEoZGF0YSkgew0KICAgICAgdGhpcy5zZWxlY3RlZCA9IGRhdGFbMF07DQogICAgICB0aGlzLnNlYXJjaHZhbHVlID0gZGF0YVswXVt0aGlzLnNlYXJjaGZsZHMudmFsdWVdOw0KICAgICAgdGhpcy5zZWFyY2h0ZXh0ID0gZGF0YVswXVt0aGlzLnNlYXJjaGZsZHMudGV4dF07DQogICAgICB0aGlzLiRlbWl0KCJpbnB1dCIsIHRoaXMuc2VhcmNodmFsdWUpOw0KICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOw0KDQogICAgICB0aGlzLm5leHRJbnB1dCgpOw0KICAgICAgLy8gdGhpcy4kZW1pdCgna2V5ZG93bicsIHtrZXlDb2RlOiA5fSk7DQogICAgfSwNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBzZWFyY2h0ZXh0KHRleHQpIHsNCiAgICAgIHRoaXMuZGlydHkgPSAodGV4dCAhPT0gdGhpcy5zZWxlY3RlZFt0aGlzLnNlYXJjaGZsZHMudGV4dF0gJiYgdGV4dCAhPT0gIiIpOw0KICAgIH0sDQogICAgdmFsdWU6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIodmFsdWUpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3dhdGNoLnZhbHVlOmhpdCcpOw0KICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMuc2VhcmNodmFsdWUgKSB7DQogICAgICAgICAgdGhpcy5idXNjYXIodmFsdWUpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9LA0KfTsNCg=="},{"version":3,"sources":["SearchApiNumber.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SearchApiNumber.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div>\r\n    <!-- TODO:\r\n    1-resolver a questão de navegar para o próximo input quando achar o registro.\r\n    -->\r\n    <b-input-group :prepend=\"value.toString()\">\r\n      <b-form-input type=\"search\" v-model=\"searchtext\" @keyup.enter=\"buscar\" v-bind=\"$attrs\"/>\r\n      <b-input-group-append>\r\n        <b-button\r\n          text=\"Button\"\r\n          variant=\"primary\"\r\n          :disabled=\"!dirty\"\r\n          @click=\"buscar\"\r\n          ><b-icon-search/></b-button\r\n        >\r\n      </b-input-group-append>\r\n    </b-input-group>\r\n\r\n    <b-modal\r\n      :id=\"modalid\"\r\n      okOnly\r\n      size=\"xl\"\r\n      scrollable\r\n      no-close-on-backdrop\r\n      :title=\"title\"\r\n    >\r\n      <TableEditApi\r\n        :items=\"data\"\r\n        :fields=\"fields\"\r\n        :page=\"1\"\r\n        :perPage=\"10\"\r\n        :buttons=\"[]\"\r\n        @evt-page=\"evtpage\"\r\n        @evt-select=\"evtselect\"\r\n      />\r\n    </b-modal>\r\n\r\n    <!-- <pre>\r\n      {{fields}}\r\n    </pre> -->\r\n\r\n  </div>\r\n</template>\r\n<script>\r\nimport API from \"../services/api.service\";\r\nimport TableEditApi from \"./TableEditApi.vue\";\r\nexport default {\r\n  name: \"SearchApiNumber\",\r\n  components: {\r\n    TableEditApi,\r\n  },\r\n  props: {\r\n    value: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    pkid: {\r\n      type: String,\r\n      default: Math.random(32).toString(32).split(\".\"),\r\n      required: true,\r\n    },\r\n    title: {\r\n      type: String,\r\n      default: \"Pesquisar...\",\r\n    },\r\n    route: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    items: {\r\n      type: Array,\r\n      default() {\r\n        return []\r\n      }\r\n    },\r\n    lookup: {\r\n      type: Object,\r\n      default() {\r\n        return { value: \"value\", text: \"text\", labelvalue: 'Código', labeltext: 'Descrição' };\r\n      },\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      searchvalue: this.value,\r\n      searchtext: this.value || \"\",\r\n      searchflds: this.lookup,\r\n      data: [],\r\n      selected: {[this.lookup.value]: 0, [this.lookup.value]: \"\"} ,\r\n      dirty: true,\r\n      modalid: `modal_${this.pkid}`,\r\n      randomid: Math.random(32).toString(32).split(\".\"),\r\n    };\r\n  },\r\n  computed: {\r\n    params() {\r\n      return {\r\n        pesquisa: this.searchtext,\r\n        body: this.searchtext,\r\n      };\r\n    },\r\n    fields() {\r\n      return [\r\n        { key: this.lookup.value, label: this.lookup.labelvalue || this.lookup.value, sortable: true, visible: true },\r\n        { key: this.lookup.text, label: this.lookup.labeltext || this.lookup.text, sortable: true, visible: true }\r\n      ]\r\n    },\r\n    xrandomid() {\r\n      return Math.random(32)\r\n          .toString(32)\r\n          .split(\".\");\r\n    },\r\n    api() {\r\n      return `https://api.grupok1.com.br/api/v2/${this.route}`;\r\n    },\r\n  },\r\n  methods: {\r\n    nextInput() {\r\n      var keyboardEvent = document.createEvent('KeyboardEvent');\r\n      var initMethod = typeof keyboardEvent.initKeyboardEvent !== 'undefined' ? 'initKeyboardEvent' : 'initKeyEvent';\r\n\r\n      keyboardEvent[initMethod](\r\n        'keydown', // event type: keydown, keyup, keypress\r\n        true, // bubbles\r\n        true, // cancelable\r\n        window, // view: should be window\r\n        false, // ctrlKey\r\n        false, // altKey\r\n        false, // shiftKey\r\n        false, // metaKey\r\n        9, // keyCode: unsigned long - the virtual key code, else 0\r\n        0, // charCode: unsigned long - the Unicode character associated with the depressed key, else 0\r\n      );\r\n      document.dispatchEvent(keyboardEvent);\r\n    },\r\n    getPedido() {\r\n\r\n    },\r\n    async buscar(value) {\r\n      if (value > 0) {\r\n        this.searchtext = value;\r\n        this.dirty = true;\r\n      }\r\n      // console.log('buscar.dirty:', this.dirty);\r\n      // console.log('buscar.value:', this.value);\r\n      if (this.dirty) {\r\n        if (this.items.length > 0) {\r\n          this.data = this.items.filter(f=>(f[this.searchflds.value].toString().toUpperCase().includes(this.searchtext.toString().toUpperCase()) || f[this.searchflds.text].toString().toUpperCase().includes(this.searchtext.toString().toUpperCase())));\r\n        } else {\r\n          await API.post(this.route, this.params).then((apidata) => {\r\n            const res = API.prepareData(apidata.data);\r\n            if (res.success) {\r\n              this.data = res.data;\r\n            } else {\r\n              this.data = [];\r\n            }\r\n          });\r\n        }\r\n        if (this.data.length > 0) {\r\n          if (this.data.length == 1) {\r\n            this.selectdata(this.data);\r\n          } else {\r\n            this.$bvModal.show(this.modalid);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    evtselect(data) {\r\n      console.log(\"evtselect:\", data);\r\n      this.selectdata(data);\r\n      this.$bvModal.hide(this.modalid);\r\n    },\r\n    evtpage(data) {\r\n      console.log(\"evtpage:\", data);\r\n    },\r\n    selectdata(data) {\r\n      this.selected = data[0];\r\n      this.searchvalue = data[0][this.searchflds.value];\r\n      this.searchtext = data[0][this.searchflds.text];\r\n      this.$emit(\"input\", this.searchvalue);\r\n      this.dirty = false;\r\n\r\n      this.nextInput();\r\n      // this.$emit('keydown', {keyCode: 9});\r\n    },\r\n  },\r\n  watch: {\r\n    searchtext(text) {\r\n      this.dirty = (text !== this.selected[this.searchflds.text] && text !== \"\");\r\n    },\r\n    value: {\r\n      immediate: true,\r\n      handler(value) {\r\n        // console.log('watch.value:hit');\r\n        if (value !== this.searchvalue ) {\r\n          this.buscar(value);\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n</script>\r\n"]}]}