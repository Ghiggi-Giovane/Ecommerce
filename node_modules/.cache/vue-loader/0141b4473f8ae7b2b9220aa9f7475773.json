{"remainingRequest":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\k1-services\\src\\components\\ColetaEAN.vue?vue&type=style&index=0&id=4dbaac40&scoped=true&lang=css&","dependencies":[{"path":"C:\\k1-services\\src\\components\\ColetaEAN.vue","mtime":1670977910583},{"path":"C:\\k1-services\\node_modules\\css-loader\\dist\\cjs.js","mtime":1670977934642},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1670977935796},{"path":"C:\\k1-services\\node_modules\\postcss-loader\\src\\index.js","mtime":1670977935130},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js","mtime":1670977935327}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmJ0biB7DQogIG1hcmdpbi1yaWdodDogNXB4Ow0KICBtYXJnaW4tYm90dG9tOiA1cHg7DQp9DQo="},{"version":3,"sources":["ColetaEAN.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmjBA;AACA;AACA;AACA","file":"ColetaEAN.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"m-2\">\r\n    <b-card no-body>\r\n      <b-card-header>\r\n        <b-card no-body>\r\n          <b-card-text class=\"display-1 text-center\">\r\n            {{ gtxeanslidos }}\r\n          </b-card-text>\r\n          <b-card-text v-if=\"showinput\" class=\"mr-2 ml-2\">\r\n            <b-form-input\r\n              placeholder=\"Digite o código ean...\"\r\n              v-model=\"ean\"\r\n              @change=\"coletar(ean)\"\r\n              @keypress.enter=\"docoletar(ean)\"\r\n            ></b-form-input>\r\n          </b-card-text>\r\n\r\n          <b-card-footer class=\"text-center\">\r\n            <b-button\r\n              size=\"sm\"\r\n              variant=\"primary\"\r\n              @click=\"enviarColetas(coletastable)\"\r\n              :disabled=\"gtxeanslidos == 0 || disableenvio\"\r\n              >Enviar Coletas</b-button\r\n            >\r\n            <b-button size=\"sm\" variant=\"secondary\" @click=\"doinput\">{{\r\n              tipocoleta\r\n            }}</b-button>\r\n            <b-button size=\"sm\" variant=\"success\" v-b-modal.modal-scanbarcode\r\n              >Ler EAN</b-button\r\n            >\r\n            <b-button size=\"sm\" variant=\"warning\" v-b-modal.modal-barcode\r\n              >Scanner</b-button\r\n            >\r\n          </b-card-footer>\r\n        </b-card>\r\n\r\n        <b-alert class=\"mt-2\" :show=\"!focused\" :variant=\"lostfocus\" fade\r\n          >A janela perdeu o foco, clique aqui para iniciar a coleta</b-alert\r\n        >\r\n        <b-alert\r\n          class=\"mt-2\"\r\n          :show=\"alert.show\"\r\n          :variant=\"alert.variant\"\r\n          fade\r\n          >{{ alert.message }}</b-alert\r\n        >\r\n      </b-card-header>\r\n      <b-tabs card v-model=\"tabIndex\">\r\n        <b-tab :title=\"`Coletas ( ${gtxeanslidos || 0} )`\" active>\r\n          <b-card-text>\r\n            <b-table\r\n              striped\r\n              hover\r\n              selectable\r\n              selected-variant=\"success\"\r\n              :items=\"gtxeans128reads\"\r\n              :fields=\"eanfields\"\r\n              sort-icon-left\r\n            >\r\n              <template #cell(index)=\"data\">\r\n                {{ data.index + 1 }}\r\n              </template>\r\n              <template #cell(volumes)=\"data\">\r\n                {{ `${data.item.vol}/${data.item.vols}` }}\r\n              </template>\r\n              <template #cell(actions)=\"data\">\r\n                <b-button\r\n                  size=\"sm\"\r\n                  variant=\"danger\"\r\n                  @click=\"excluiItem(data.item)\"\r\n                  ><b-icon-trash size=\"sm\"\r\n                /></b-button>\r\n              </template>\r\n            </b-table>\r\n          </b-card-text>\r\n          <b-card-footer class=\"text-right\">\r\n            <b-button\r\n              size=\"sm\"\r\n              variant=\"danger\"\r\n              :disabled=\"eanscoletados == 0\"\r\n              @click=\"limparColeta()\"\r\n              >Limpar Coleta</b-button\r\n            >\r\n          </b-card-footer>\r\n        </b-tab>\r\n\r\n        <b-tab :title=\"`Historico ( ${gtxeanshistlidos || 0} )`\">\r\n          <b-card-text v-if=\"gtxeanshistlidos == 0\">\r\n            Nenhuma coleta registrada\r\n          </b-card-text>\r\n          <b-card-text>\r\n            <div class=\"accordion\" role=\"tablist\">\r\n              <b-card\r\n                no-body\r\n                class=\"mb-1\"\r\n                v-for=\"(t, i) of gtxeanshist\"\r\n                :key=\"i\"\r\n              >\r\n                <b-card-header header-tag=\"header\" class=\"p-1\" role=\"tab\">\r\n                  <b-button block v-b-toggle=\"`_${t.id}`\" variant=\"info\"\r\n                    >{{ i + 1 }} - {{ t.envio | Time }} (\r\n                    {{ t.eanslidos }} )</b-button\r\n                  >\r\n                </b-card-header>\r\n                <b-collapse\r\n                  :id=\"`_${t.id}`\"\r\n                  visible\r\n                  accordion=\"my-accordion\"\r\n                  role=\"tabpanel\"\r\n                >\r\n                  <b-card-body>\r\n                    <b-table\r\n                      size=\"sm\"\r\n                      :items=\"t.eans128reads\"\r\n                      :fields=\"histfields\"\r\n                      sort-icon-left\r\n                    >\r\n                      <template #cell(actions)=\"data\">\r\n                        <b-button\r\n                          size=\"sm\"\r\n                          variant=\"danger\"\r\n                          @click=\"excluihistItem(data.item, t)\"\r\n                          ><b-icon-trash size=\"sm\"\r\n                        /></b-button>\r\n                      </template>\r\n                      <template #cell(volumes)=\"data\">\r\n                        {{ `${data.item.vol}/${data.item.vols}` }}\r\n                      </template>\r\n                    </b-table>\r\n                    <b-card-footer>\r\n                      <b-button\r\n                        size=\"sm\"\r\n                        variant=\"primary\"\r\n                        @click=\"emitColetas(t.eansreads)\"\r\n                        >Reenviar Coleta</b-button\r\n                      >\r\n                      <b-button\r\n                        size=\"sm\"\r\n                        variant=\"secondary\"\r\n                        @click=\"limparhisColeta(t)\"\r\n                        >Excluir Coleta</b-button\r\n                      >\r\n                      <b-button\r\n                        size=\"sm\"\r\n                        variant=\"secondary\"\r\n                        @click=\"renomearcoleta(t)\"\r\n                        >Renomear</b-button\r\n                      >\r\n                    </b-card-footer>\r\n                  </b-card-body>\r\n                </b-collapse>\r\n              </b-card>\r\n            </div>\r\n          </b-card-text>\r\n        </b-tab>\r\n\r\n        <!-- CUSTOM PAGES -->\r\n        <b-tab\r\n          :title=\"page.title || `Page ${i}`\"\r\n          v-for=\"(page, i) of customPages\"\r\n          :key=\"i\"\r\n        >\r\n          <b-card-text v-if=\"page.table\">\r\n            <b-table\r\n              striped\r\n              hover\r\n              :items=\"page.data\"\r\n              :fields=\"page.fields\"\r\n              sort-icon-left\r\n            >\r\n              <template #cell(index)=\"data\">\r\n                {{ data.index + 1 }}\r\n              </template>\r\n            </b-table>\r\n          </b-card-text>\r\n        </b-tab>\r\n      </b-tabs>\r\n\r\n      <!-- <b-card-text>\r\n                renamehist:\r\n                <pre>\r\n                    {{ renamehist }}\r\n                </pre>\r\n            </b-card-text> -->\r\n    </b-card>\r\n\r\n    <b-modal\r\n      id=\"modal-barcode\"\r\n      title=\"Configuração do Scanner\"\r\n      ok-only\r\n      header-bg-variant=\"primary\"\r\n      header-text-variant=\"light\"\r\n    >\r\n      <BarcodeConfig model=\"C740\" />\r\n    </b-modal>\r\n\r\n    <b-modal\r\n      id=\"modal-scanbarcode\"\r\n      title=\"Aproxime o código de barras\"\r\n      ok-only\r\n      header-bg-variant=\"danger\"\r\n      header-text-variant=\"light\"\r\n    >\r\n      <BarcodeScanner @onScanner=\"onDecode\"></BarcodeScanner>\r\n    </b-modal>\r\n\r\n    <Inputmodal\r\n      idmodal=\"ColetaEANRename\"\r\n      v-model=\"rename.value\"\r\n      :type=\"rename.type\"\r\n      :title=\"rename.title\"\r\n      :placeholder=\"rename.placeholder\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions, mapGetters } from \"vuex\";\r\nimport xmljs from \"xml-js\";\r\nimport AccordionConsultas from \"../pages/consulta/components/AccordionConsultas.vue\";\r\nimport BarcodeConfig from \"../pages/coleta/components/BarcodeConfig\";\r\nimport BarcodeScanner from \"./BarcodeScanner\";\r\n\r\nexport default {\r\n  components: {\r\n    AccordionConsultas,\r\n    BarcodeConfig,\r\n    BarcodeScanner,\r\n  },\r\n\r\n  name: \"ColetaEAN\",\r\n\r\n  props: {\r\n    // eans: [], // v-model para retornar as coletas ...\r\n    disableenvio: {\r\n      type: Boolean,\r\n      default() {\r\n        return false;\r\n      },\r\n    },\r\n    ean128: {\r\n      type: Array,\r\n      default() {\r\n        return [\r\n          { field: \"lote\", tamanho: 6 }, // Numero do lote d producao\r\n          { field: \"seq\", tamanho: 5 }, // sequencial do lote\r\n          { field: \"emp\", tamanho: 2 }, // empresa que produziu o lote\r\n        ];\r\n      },\r\n    },\r\n    eanfields: {\r\n      type: Array,\r\n      default() {\r\n        return [\r\n          { key: \"lote\", label: \"Lote\", sortable: true },\r\n          { key: \"seq\", label: \"Seq\", sortable: true },\r\n          { key: \"volumes\", label: \"Volumes\", sortable: true },\r\n          { key: \"actions\", label: \"\" },\r\n        ];\r\n      },\r\n    },\r\n    histfields: {\r\n      type: Array,\r\n      default() {\r\n        return [\r\n          { key: \"lote\", label: \"Lote\", sortable: true },\r\n          { key: \"seq\", label: \"Seq\", sortable: true },\r\n          { key: \"volumes\", label: \"Volumes\", sortable: true },\r\n          { key: \"actions\", label: \"\" },\r\n        ];\r\n      },\r\n    },\r\n    customPages: {\r\n      type: Array,\r\n      default() {\r\n        return [];\r\n      },\r\n    },\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      focused: true,\r\n      alert: {\r\n        show: false,\r\n        message: \"\",\r\n        variant: \"success\",\r\n      },\r\n      tabIndex: 0,\r\n      showinput: false,\r\n      showbarcode: false,\r\n      lastean: \"\",\r\n      ean: \"\",\r\n      coletas: [],\r\n      lastcoletas: [],\r\n      rename: {\r\n        value: \"\",\r\n        show: false,\r\n        type: \"text\",\r\n        label: \"Novo nome\",\r\n        title: \"Renomear\",\r\n        placeholder: \"Informe o novo nome\",\r\n      },\r\n      renamehist: [],\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\r\n      \"gtxeans\",\r\n      \"gtxeansreads\",\r\n      \"gtxeanslidos\",\r\n      \"gtxeans128reads\",\r\n\r\n      \"gtxeanshist\",\r\n      \"gtxeanshistlidos\",\r\n    ]),\r\n\r\n    tipocoleta() {\r\n      return this.showinput ? \"Coleta com Leitor\" : \"Coleta Manual\";\r\n    },\r\n\r\n    eanscoletados() {\r\n      return this.gtxeans128reads.length;\r\n    },\r\n\r\n    eanslastcoletas() {\r\n      return this.lastcoletas.length;\r\n    },\r\n\r\n    //coletastable() { return this.coletas.map(e => {return {ean: e}}) },\r\n    coletastable() {\r\n      return this.gtxeans.map((e) => {\r\n        return { ean: e };\r\n      });\r\n    },\r\n\r\n    lostfocus() {\r\n      return !this.focused ? \"danger\" : \"light\";\r\n    },\r\n  },\r\n\r\n  created() {\r\n    this.listenColeta(true);\r\n\r\n    this.listenFocused(true);\r\n\r\n    this.setInterval(3000);\r\n  },\r\n\r\n  beforeDestroy() {\r\n    this.listenColeta(false);\r\n\r\n    this.listenFocused(false);\r\n\r\n    this.setInterval(0);\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      \"acteans\",\r\n      \"acteansclear\",\r\n      \"acteansdeletebyean\",\r\n      \"acteanssave\",\r\n\r\n      \"acteanshistclear\",\r\n      \"acteanshistdeletebyean\",\r\n    ]),\r\n\r\n    onDecode(result) {\r\n      console.log(\"onDecode:\", result);\r\n    },\r\n\r\n    doinput() {\r\n      this.showinput = !this.showinput;\r\n      this.listenColeta(false);\r\n    },\r\n\r\n    dobarcode() {\r\n      this.showbarcode = !this.showbarcode;\r\n      // this.listenColeta(false);\r\n    },\r\n\r\n    setInterval(tempo) {\r\n      setInterval(\r\n        function() {\r\n          this.alert.show = false;\r\n        }.bind(this),\r\n        tempo\r\n      );\r\n    },\r\n\r\n    listenFocused(sim) {\r\n      if (sim) {\r\n        window.addEventListener(\"focus\", () => (this.focused = true));\r\n        window.addEventListener(\"blur\", () => (this.focused = false));\r\n      } else {\r\n        window.removeEventListener(\"focus\", () => (this.focused = true));\r\n        window.removeEventListener(\"blur\", () => (this.focused = false));\r\n      }\r\n    },\r\n\r\n    listenColeta(sim) {\r\n      if (sim) {\r\n        console.log(\"Coletor.listenColeta:\", \"sim\");\r\n        window.addEventListener(\"keyup\", this.listenKeydown);\r\n      } else {\r\n        console.log(\"Coletor.listenColeta:\", \"não\");\r\n        window.removeEventListener(\"keyup\", this.listenKeydown);\r\n      }\r\n    },\r\n\r\n    listenKeydown(e) {\r\n      // console.log('addEventListener::keydown:hit', e)\r\n      if (e.key > -1 && e.key < 10) {\r\n        this.ean += e.key;\r\n        e.preventDefault();\r\n        // console.log('ean: ',this.ean)\r\n      }\r\n      if (e.key == \"Backspace\") {\r\n        this.ean = this.ean.substr(0, this.ean.length - 1);\r\n        this.lastean = this.ean;\r\n        e.preventDefault();\r\n      }\r\n      if (e.key == \"Delete\") {\r\n        this.ean = this.ean.substr(1);\r\n        this.lastean = this.ean;\r\n        e.preventDefault();\r\n      }\r\n\r\n      if (e.key == \"Enter\" && this.ean.length > 0) {\r\n        this.docoletar(this.ean);\r\n        e.preventDefault();\r\n      }\r\n    },\r\n\r\n    docoletar(ean) {\r\n      // console.log('docoletar:', ean)\r\n\r\n      if (!ean.includes(\"\\n\")) ean += \"\\n\";\r\n      this.coletar(ean);\r\n    },\r\n\r\n    coletar(ean) {\r\n      // console.log('coletar:', ean)\r\n      this.tabIndex = 0;\r\n\r\n      this.acteans(ean);\r\n\r\n      if (ean.includes(\"\\n\"))\r\n        if (!this.coletas.find((f) => f == ean)) {\r\n          this.alert.show = true;\r\n          this.alert.message = \"Coletado com sucesso!\";\r\n          this.alert.variant = \"success\";\r\n          this.coletas.push(ean);\r\n          this.$emit(\"input\", this.coletas);\r\n        } else {\r\n          this.alert.show = true;\r\n          this.alert.message = \"Coleta já realizada!\";\r\n          this.alert.variant = \"warning\";\r\n        }\r\n    },\r\n\r\n    getXML(json) {\r\n      return xmljs.json2xml(json, { compact: true, ignoreAttributes: false });\r\n    },\r\n\r\n    emitColetas(coletas) {\r\n      const jsonxml = this.getXML({ data: coletas });\r\n\r\n      // console.log('emitColetas.enviarColetas.xml: ', jsonxml)\r\n      this.$emit(\"evt-coletas-xml\", jsonxml);\r\n\r\n      // console.log('emitColetas.enviarColetas: ', coletas)\r\n      this.$emit(\"evt-coletas\", coletas);\r\n\r\n      this.coletas = [];\r\n    },\r\n\r\n    enviarColetas(coletas) {\r\n      this.acteanssave();\r\n      this.acteansclear();\r\n      this.emitColetas(coletas);\r\n\r\n      // console.log('enviarColetas.gtxeanslidos:', this.gtxeanshist)\r\n\r\n      // this.lastcoletas.find(k => k.id == coletas.id)\r\n    },\r\n\r\n    limparhisColeta(coleta) {\r\n      this.$root\r\n        .showmessage(\r\n          \"Deseja realmente excluir todas as coletas deste histórico ?\",\r\n          \"Intranet\"\r\n        )\r\n        .then((choice) => {\r\n          if (choice) {\r\n            this.acteanshistclear(coleta.id);\r\n            this.$emit(\"input\", []);\r\n          }\r\n        });\r\n    },\r\n\r\n    excluiItem(item) {\r\n      this.acteansdeletebyean(item);\r\n      console.log(\"excluiItem:\", item);\r\n    },\r\n\r\n    excluihistItem(item, ean) {\r\n      const eandelete = {\r\n        id: ean.id,\r\n        ean: item.ean,\r\n      };\r\n\r\n      this.acteanshistdeletebyean(eandelete);\r\n      console.log(\"excluihistItem:\", eandelete);\r\n    },\r\n\r\n    limparColeta() {\r\n      this.$root\r\n        .showmessage(\"Deseja realmente limpar estas coletas ?\", \"Intranet\")\r\n        .then((choice) => {\r\n          if (choice) this.acteansclear();\r\n        });\r\n    },\r\n\r\n    renomearcoleta(hist) {\r\n      // this.rename.show = !this.rename.show\r\n\r\n      this.$bvModal.show(\"ColetaEANRename\");\r\n\r\n      // console.log('renomearcoleta:', this.rename.show)\r\n\r\n      // console.log('renomearcoleta:', hist)\r\n\r\n      if (!this.renamehist.find((f) => f.id == hist.id)) {\r\n        this.renamehist.push({ id: hist.id, titulo: this.rename.value });\r\n      }\r\n    },\r\n\r\n    newid() {\r\n      return (\r\n        \"_\" +\r\n        Math.random()\r\n          .toString(36)\r\n          .substr(2, 13)\r\n      );\r\n    },\r\n  },\r\n\r\n  watch: {\r\n    gtxeansreads: {\r\n      deep: true,\r\n      handler() {\r\n        this.ean = \"\";\r\n      },\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.btn {\r\n  margin-right: 5px;\r\n  margin-bottom: 5px;\r\n}\r\n</style>\r\n"]}]}