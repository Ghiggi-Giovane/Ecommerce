{"remainingRequest":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\k1-services\\src\\pages\\carregamento\\views\\index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\k1-services\\src\\pages\\carregamento\\views\\index.vue","mtime":1674602801809},{"path":"C:\\k1-services\\node_modules\\css-loader\\dist\\cjs.js","mtime":1670977934642},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1670977935796},{"path":"C:\\k1-services\\node_modules\\postcss-loader\\src\\index.js","mtime":1670977935130},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js","mtime":1670977935327}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouY29sc2FsaWduIHsNCiAgdGV4dC1hbGlnbjogcmlnaHQ7DQp9DQpAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2MDBweCkgew0KICAuY29sc2FsaWduIHsNCiAgICB0ZXh0LWFsaWduOiBsZWZ0Ow0KICB9DQogIC5saXN0YSB7DQogICAgcGFkZGluZy1sZWZ0OiAzcHg7DQogICAgcGFkZGluZy1yaWdodDogM3B4Ow0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAq1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/carregamento/views","sourcesContent":["<template>\r\n  <div class=\"mx-auto container\">\r\n    <b-card class=\"my-2\" header-bg-variant=\"primary\" header-text-variant=\"white\">\r\n    <template #header>\r\n    <div class=\"d-flex w-100 justify-content-between\">\r\n      <h4 class=\"mb-0\">Controle de cargas</h4>\r\n      <b-button-group>\r\n      <b-button variant=\"light\" v-b-toggle.collapseform>\r\n        <b-icon-caret-up v-if=\"formcollapsed\"/>\r\n        <b-icon-caret-down v-else/>\r\n        Filtros\r\n        </b-button>\r\n        <b-dropdown split variant=\"success\" @click=\"updatestop=false\" title=\"Atualização de coletas\" v-if=\"updatestop\">\r\n          <template #button-content>\r\n           <b-icon-play />\r\n           </template>\r\n           <b-dropdown-item-button @click=\"updatetimeout=5000\"><b-icon-toggle-on v-if=\"updatetimeout==5000\"/><b-icon-toggle-off v-else/><span class=\"ml-2\">Timer em 5 Segundos</span></b-dropdown-item-button>\r\n           <b-dropdown-item-button @click=\"updatetimeout=15000\"><b-icon-toggle-on v-if=\"updatetimeout==15000\"/><b-icon-toggle-off v-else/><span class=\"ml-2\">Timer em 15 Segundos</span></b-dropdown-item-button>\r\n           <b-dropdown-item-button @click=\"updatetimeout=30000\"><b-icon-toggle-on v-if=\"updatetimeout==30000\"/><b-icon-toggle-off v-else/><span class=\"ml-2\">Timer em 30 Segundos</span></b-dropdown-item-button>\r\n           <b-dropdown-item-button @click=\"updatetimeout=60000\"><b-icon-toggle-on v-if=\"updatetimeout==60000\"/><b-icon-toggle-off v-else/><span class=\"ml-2\">Timer em 1 minuto</span></b-dropdown-item-button>\r\n        </b-dropdown>\r\n        <!-- <b-button variant=\"success\" @click=\"updatestop=false\" v-if=\"updatestop\">\r\n          <b-icon-play />\r\n        </b-button>         -->\r\n        <b-button variant=\"danger\" @click=\"updatestop=true\" title=\"Pausar a atualização de coletas\" v-else>\r\n          <b-icon-pause />\r\n        </b-button> \r\n        </b-button-group>      \r\n      </div>\r\n    </template>\r\n    <!--\r\n      selected: {{selected}}<br />\r\n      selectedchecked: {{selectedchecked}}<br />\r\n      selectedcheckedlength: {{selectedcheckedlength}}<br />\r\n      \r\n      marcasselected: {{marcasselected}}<br />\r\n      data: {{data}}<br />\r\n      romaneios[0]: {{romaneios[0]}}<br />\r\n      romaneios[2]: {{romaneios[2]}}\r\n       -->\r\n    <b-collapse id=\"collapseform\" v-model=\"formcollapsed\">\r\n    <b-row>\r\n      <b-col cols=\"12\" md=\"2\">\r\n      <b-form-group\r\n        id=\"input-group-idcarregamento\"\r\n        label-for=\"input-idcarregamento\"\r\n        label=\"Carga\"\r\n      >\r\n        <b-form-input\r\n          id=\"input-idcarregamento\"\r\n          type=\"number\"\r\n          v-model=\"form.idCarregamento\"\r\n        >\r\n        </b-form-input>\r\n      </b-form-group>\r\n      </b-col>\r\n      <b-col cols=\"12\" md=\"3\">\r\n      <b-form-group\r\n        id=\"input-group-database\"\r\n        label-for=\"input-database\"\r\n        label=\"Data Entrada\"\r\n      >\r\n        <b-form-datepicker\r\n          id=\"input-database\"\r\n          :date-format-options=\"{ year: 'numeric', month: '2-digit', day: '2-digit'}\" locale=\"pt\"\r\n          v-model=\"form.entrada\"\r\n        >\r\n        </b-form-datepicker>\r\n      </b-form-group>\r\n      </b-col>\r\n      <b-col cols=\"12\" md=\"4\">\r\n        <b-form-group\r\n        id=\"input-group-motorista\"\r\n        label-for=\"input-motorista\"\r\n        label=\"Motorista\"\r\n      >\r\n      <b-form-input id=\"input-motorista\" type=\"text\" v-model=\"form.motorista\" />\r\n      </b-form-group>\r\n      </b-col>\r\n      <b-col cols=\"12\" md=\"3\">\r\n        <b-form-group\r\n        id=\"input-group-placa\"\r\n        label-for=\"input-placa\"\r\n        label=\"Placa\"\r\n      >\r\n      <b-form-input id=\"input-placa\" type=\"text\" v-model=\"form.placa\" />\r\n      </b-form-group>\r\n      </b-col>\r\n    </b-row>\r\n\r\n    <b-row>\r\n      <b-col cols=\"12\">\r\n        <b-form-group\r\n        id=\"input-group-nometransp\"\r\n        label-for=\"input-nometransp\"\r\n        label=\"Transportadora\"\r\n      >\r\n      <b-form-input id=\"input-nometransp\" type=\"text\" v-model=\"form.nometransp\" />\r\n      </b-form-group>\r\n      </b-col>\r\n    </b-row>\r\n\r\n    <b-row>\r\n      <b-col cols=\"12\" class=\"mb-2 text-right\">\r\n        \r\n        <b-button variant=\"success\" @click=\"getCarregamento()\">\r\n          <b-icon-search />\r\n          Buscar\r\n        </b-button>\r\n        \r\n      </b-col>\r\n    </b-row>\r\n    <hr />\r\n    </b-collapse>\r\n\r\n    <b-row>\r\n      <b-col>\r\n        <b-input-group prepend=\"Filtro\" size=\"sm\" class=\"mb-2\">\r\n          <b-form-input\r\n            id=\"input-filtro\"\r\n            type=\"search\"\r\n            v-model=\"filtro\"\r\n            placeholder=\"Informe a carga, nome da transportadora, motorista ou placa...\"\r\n          ></b-form-input>\r\n        </b-input-group>\r\n      </b-col>\r\n    </b-row>\r\n    <b-row>\r\n      <b-col class=\"text-right\">\r\n        <div class=\"d-flex float-right align-items-center hspaced-4 mb-2\">\r\n          <b-dropdown size=\"sm\" text=\"Marcas\" variant=\"info\" right>\r\n            <b-form-checkbox\r\n              v-for=\"m of marcas\"\r\n              :key=\"m.id\"\r\n              class=\"mb-1 ml-1\" \r\n              switch\r\n              left\r\n              v-model=\"m.checked\">\r\n              {{m.reduzido}}\r\n            </b-form-checkbox>\r\n          </b-dropdown>\r\n          <b-form-checkbox switch v-model=\"filtroassinados\">Assinados</b-form-checkbox>\r\n        </div>\r\n      </b-col>\r\n    </b-row>\r\n\r\n    <b-row>\r\n    <b-col cols=\"12\" class=\"lista\">\r\n      <b-list-group>\r\n        <b-list-group-item \r\n          v-for=\"r in romaneios\"\r\n          v-b-toggle=\"`collapse-romaneio-${r.id}`\"\r\n          :variant=\"classselected(r)\" \r\n          :key=\"r.id\"\r\n          @click=\"doselected(r)\"\r\n          class=\"flex-column align-items-start\">\r\n\r\n          <div class=\"d-flex w-100 justify-content-between\">\r\n            <div class=\"mb-3\">Carga: <span class=\"mb-3\"><b><span v-copy @click.stop=\"\">{{r.id}}</span></b></span></div>\r\n            <div style=\"min-width: 80px;\">\r\n              <b-progress :value=\"r.perc\" :label=\"`${r.perc}%`\" :max=\"100\" :variant=\"classperc(r.perc)\" show-progress></b-progress>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"d-flex w-100 justify-content-between\">\r\n            <h5 class=\"mb-3\">{{r.codTransp}} - {{r.transp}}</h5>\r\n            <div style=\"min-width: 80px;\">\r\n            <b-row>\r\n              <b-col class=\"text-right\">\r\n                <span class=\"iconbutton\" @click.stop=\"assinar(r)\">\r\n                  <b-icon-pen-fill v-if=\"r.PercAssinados==100\" variant=\"success\" title=\"Assinar\" />\r\n                  <b-icon-pen-fill v-else variant=\"danger\" title=\"Assinar\" />\r\n                </span>\r\n              </b-col>\r\n              <b-col class=\"text-right\">\r\n                <span>\r\n                  <b-form-checkbox @change=\"marcar\"/>\r\n                </span>\r\n              </b-col>\r\n            </b-row>\r\n            </div>\r\n          </div>\r\n\r\n          <div>\r\n            <b-row>\r\n              <b-col cols=\"6\">\r\n                <b-row style=\"font-style: italic; font-size: 14px;\">\r\n                  <b-col class=\"text-nowrap\" cols=\"12\" lg=\"3\">Romaneios: <b>{{r.Romaneios.length}}</b></b-col>\r\n                  <b-col class=\"text-nowrap\" cols=\"12\" lg=\"3\">Pedidos: <b>{{r.TPedidos}}</b></b-col>\r\n                  <b-col class=\"text-nowrap\" cols=\"12\" lg=\"3\">Volumes: <b>{{r.volumes}}</b></b-col>\r\n                  <b-col class=\"text-nowrap\" cols=\"12\" lg=\"3\">Última Coleta: <b>{{r.ultimacoleta | time}}</b></b-col>\r\n                </b-row>\r\n              </b-col>\r\n              <b-col cols=\"6\" class=\"text-right\">\r\n                <b-row>\r\n                  <b-col cols=\"12\" lg=\"9\">\r\n                    <span><b>{{r.motorista}}</b></span>\r\n                  </b-col>\r\n                  <b-col cols=\"12\" lg=\"3\">\r\n                    <span class=\"text-nowrap\" v-copy @click.stop=\"\">{{r.placa}}</span>\r\n                  </b-col>\r\n                </b-row>\r\n              </b-col>\r\n            </b-row>\r\n          </div>\r\n\r\n\r\n          <b-collapse \r\n            :id=\"`collapse-romaneio-${r.id}`\"\r\n            v-model=\"r.collapsed\"\r\n          >\r\n          <b-list-group>\r\n            <b-list-group-item\r\n              v-for=\"p in r.Romaneios\"\r\n              :key=\"p.Romaneio\"\r\n              :variant=\"p.checked==true ? 'warning' : p.sigImage ? 'success' : ''\"\r\n              @click.stop=\"\"\r\n            >\r\n              <div class=\"d-flex w-100 justify-content-between\">\r\n                <div class=\"mb-3\">Romaneio: <span class=\"font-weight-bold mb-3\" v-copy>{{p.Romaneio}}</span></div>\r\n                <div style=\"min-width: 80px;\">\r\n                  <b-progress :value=\"p.PercColetados\" :label=\"`${p.PercColetados}%`\" :max=\"100\" :variant=\"classperc(p.PercColetados)\" show-progress></b-progress>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"d-flex w-100 justify-content-between\">\r\n                <div>\r\n                  <span class=\"text-nowrap iconbutton\" @click=\"modalpedidos(p.Pedidos)\">Pedidos: <b><span v-copy @click.stop=\"\">{{p.Pedidos.length}}</span></b></span> |\r\n                  <span class=\"text-nowrap\">Volumes: <b>{{p.TVolumes}}</b></span> |\r\n                  <span class=\"text-nowrap\">Peso: <b>{{p.PesoBruto}}</b></span> |\r\n                  <span class=\"text-nowrap\">Cubagem: <b>{{p.Cubagem}}</b></span>\r\n                </div>\r\n                <div>\r\n                  <b-row>\r\n                    <b-col>\r\n                      <span class=\"iconbutton\" v-if=\"p.sigImage\" @click.stop=\"assinarromaneio(r, p.Romaneio)\">\r\n                        <b-icon-pen-fill variant=\"success\" title=\"Assinar\" />\r\n                      </span>\r\n                    </b-col>\r\n                    <b-col>\r\n                      <b-form-checkbox v-model=\"p.checked\" @click.stop=\"\" />\r\n                    </b-col>\r\n                  </b-row>\r\n                </div>\r\n\r\n              </div>\r\n            </b-list-group-item>\r\n            </b-list-group>\r\n          </b-collapse>\r\n\r\n        </b-list-group-item>        \r\n      </b-list-group>\r\n      </b-col>\r\n    </b-row>\r\n    </b-card>\r\n    \r\n    <!-- MODAIS -->\r\n    <b-modal\r\n      id=\"modal-assinar\"\r\n      ref=\"modal-assinar\"\r\n      size=\"lg\"\r\n      scrollable\r\n      :title=\"signatureTitle\"\r\n      ok-only\r\n      ok-title=\"Confirmar Assinaturas\"\r\n      @shown=\"signatureShown\"\r\n      @ok=\"signatureOk\"\r\n      @hide=\"signatureHidden\"\r\n      :ok-disabled=\"!signatureValid\"\r\n    >\r\n    <b-card no-body>\r\n    <b-tabs card v-model=\"tabIndex\">\r\n      <b-tab title=\"Detalhes\" active>\r\n        <div class=\"p-3\">\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span>Transportadora:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\">{{selected.transp}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span class=\"colsalign\">Motorista:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\">{{selected.motorista}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span>Placa:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\">{{selected.placa}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span>Romaneios:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\" :class=\"selectedcheckedlength > 0 ? 'text-danger' : ''\">{{`${selectedcheckedlength > 0 ? selectedcheckedlength+' de ' : ''}`}}{{selected && selected.Romaneios && selected.Romaneios.length}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span>Volumes:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\">{{selected.volumes}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col class=\"colsalign\">\r\n            <span>Última Coleta:</span>\r\n          </b-col>\r\n          <b-col cols=\"12\" sm=\"8\">\r\n            <div class=\"font-weight-bold\">{{selected.ultimacoleta | dateBR}} {{selected.ultimacoleta | time}}</div>\r\n          </b-col>\r\n        </b-row>\r\n        </div>\r\n      </b-tab>\r\n      <b-tab title=\"Assinatura Motorista\">\r\n        <Signature\r\n          v-if=\"tabIndex==1\"\r\n          ref=\"signatureRef\"\r\n          :sigImage=\"sigImage\"\r\n          :buttons=\"['clear']\"\r\n          @evtSignatureChange=\"sigChange=true\"\r\n          v-model=\"sigImage\" />\r\n      </b-tab>\r\n      <b-tab title=\"Assinatura Conferente\">\r\n        <b-form-group\r\n          id=\"input-group-obsconferente\"\r\n          label-for=\"input-obsconferente\"\r\n          label=\"Observação\"\r\n        >\r\n        <b-form-textarea \r\n          id=\"input-obsconferente\"\r\n          rows=\"3\" v-model=\"sigObsConf\"\r\n        />\r\n        </b-form-group>\r\n        <b-form-group\r\n          id=\"input-group-opcoes\"\r\n          label-for=\"input-opcoes\"\r\n          label=\"Opções\"\r\n        >\r\n        <b-form-checkbox-group \r\n          id=\"input-opcoes\"\r\n          :options=\"signatureOptions\"\r\n          v-model=\"opcoes\"\r\n        />\r\n      </b-form-group>\r\n        <Signature\r\n          v-if=\"tabIndex==2\"\r\n          ref=\"signatureConfRef\"\r\n          :sigImage=\"sigImageConf\"\r\n          :buttons=\"['clear']\"\r\n          @evtSignatureChange=\"sigChangeConf=true\"\r\n          v-model=\"sigImageConf\" />\r\n      </b-tab>\r\n    </b-tabs>\r\n    </b-card>\r\n    </b-modal>\r\n\r\n    <b-modal\r\n      id=\"modal-pedidos\"\r\n      ref=\"modal-pedidos\"\r\n      size=\"lg\"\r\n      scrollable\r\n      :title=\"pedidosTitle\"\r\n      ok-only\r\n      ok-title=\"Fechar\"\r\n    >\r\n      <b-list-group>\r\n        <b-list-group-item \r\n          v-b-toggle=\"`collapse-pedido-${p.Pedido}`\"\r\n          v-for=\"p in pedidos\"\r\n          :key=\"p.Pedido\"\r\n          :variant=\"classpedidos(p)\"\r\n          @click.stop=\"pedidosselected = p\"\r\n          class=\"flex-column align-items-start\">\r\n\r\n          <div class=\"d-flex w-100 justify-content-between\">\r\n            <div class=\"mb-3\">Pedido: <span class=\"mb-3\"><b><span v-copy @click.stop=\"\">{{p.Pedido}}</span></b></span> | <span class=\"text-nowrap\">Notas: <b><span v-copy @click.stop=\"\">{{pedidosNotasSplit}}</span></b></span></div>\r\n            <div style=\"min-width: 80px;\">\r\n              <b-progress :value=\"p.Percentual\" :label=\"`${p.Percentual}%`\" :max=\"100\" :variant=\"classperc(p.Percentual)\" show-progress></b-progress>\r\n            </div>\r\n          </div>\r\n          <div class=\"d-flex w-100 justify-content-between\">\r\n            <h5 class=\"mb-3\">{{p.Codigo_Cliente}} - {{p.NomeCliente}}</h5>\r\n          </div>\r\n\r\n          <div class=\"d-flex w-100 justify-content-between\">\r\n            <div style=\"font-weight: italic; font-size: 14px;\">\r\n              <span class=\"text-nowrap\">Marca: <b>{{p.marca}}</b></span> |\r\n              <span class=\"text-nowrap\">Volumes: <b>{{p.Volumes}}</b></span> |\r\n              <span class=\"text-nowrap\">Cubagem: <b>{{p.Cubagem}}</b></span> |\r\n              <span class=\"text-nowrap\">Peso Bruto: <b>{{p.PesoBruto}}</b></span>\r\n            </div>\r\n            <!-- <span class=\"font-weight-bold\">{{r.motorista}} [ {{r.placa}} ]</span> -->\r\n          </div>\r\n\r\n          <b-collapse \r\n            :id=\"`collapse-pedido-${p.Pedido}`\"\r\n            v-model=\"p.collapsed\">\r\n          <b-list-group>\r\n            <b-list-group-item\r\n              v-for=\"n in p.Notas\"\r\n              :key=\"n.Numero_nota\"\r\n              @click.stop=\"\">\r\n              <div class=\"d-flex w-100 justify-content-between\">\r\n                <div class=\"mb-3\">Nota: <span class=\"font-weight-bold mb-3\" v-copy @click.stop=\"\">{{n.Numero_nota}}</span></div>\r\n                <div style=\"min-width: 80px;\">\r\n                  <b-progress :value=\"n.PercColeta\" :label=\"`${n.PercColeta}%`\" :max=\"100\" :variant=\"classperc(n.PercColeta)\" show-progress></b-progress>\r\n                </div>\r\n              </div>\r\n              <div class=\"d-flex w-100 justify-content-between\">\r\n                <div style=\"font-weight: italic; font-size: 14px;\">\r\n                  <span class=\"text-nowrap\">Volumes: <b>{{n.TVolumes}}</b></span> |\r\n                  <span class=\"text-nowrap\">Última Coleta: <b>{{n.UltimaColeta | dateBR}} {{n.UltimaColeta | time}}</b></span>\r\n                </div>\r\n                <!-- <span class=\"font-weight-bold\">{{r.motorista}} [ {{r.placa}} ]</span> -->\r\n              </div>\r\n            </b-list-group-item>\r\n          </b-list-group>\r\n          </b-collapse>\r\n        </b-list-group-item> \r\n      </b-list-group>\r\n    </b-modal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport API from \"../../../services/api.service\";\r\nimport Signature from \"../../../components/Signature\";\r\nimport Properties from \"../../../components/Properties\";\r\nexport default {\r\n  name: \"Carregamento\",\r\n  components: {\r\n    Signature,\r\n    Properties\r\n  },\r\n  data() {\r\n    return {\r\n      form: {\r\n        idCarregamento: 0,\r\n        entrada: new Date(),\r\n        nometransp: \"\",\r\n        motorista: \"\",\r\n        placa: \"\"\r\n      },\r\n      filtro: \"\",\r\n      filterOn: [\"id\", \"transp\", \"motorista\", \"placa\"],\r\n      filtroassinados: false,\r\n      filtrocoletados: true,\r\n      timer: null,\r\n      updatetimeout: 15000,\r\n      updatestop: false,\r\n      data: [],\r\n      marcas: [],\r\n      sigOpcoes: [],\r\n      tabIndex: 0,\r\n      sigImage: null,\r\n      sigImageConf: null,\r\n      sigObsConf: \"\",\r\n      sigChange: false,\r\n      sigChangeConf: false,\r\n      selected: [],\r\n      pedidosselected: null,\r\n      pedidos: [],\r\n      opcoes: [],\r\n      formcollapsed: false\r\n    };\r\n  },\r\n  computed: {\r\n    hoje() {\r\n      const h = new Date();\r\n      return h.getDay().toString().padStart(2,'0') + '/' + h.getMonth().toString().padStart(2,'0') + '/' + h.getFullYear().toString().padStart(4,'0');\r\n    },\r\n    fields() {\r\n      return  [\r\n        // { key: \"transp\", label: \"Transportadora\", sortable: true },\r\n        // { key: \"motorista\", sortable: true },\r\n        // { key: \"placa\", sortable: true },\r\n        // { key: \"perc\", label: \"Coletas\", sortable: true },\r\n        { key: \"carga\", label: \"Carga\"},\r\n        { key: \"actions\", label: \"\", sortable: false }\r\n      ]\r\n    },\r\n    params() {\r\n      return {\r\n        idCarregamento: this.form.idCarregamento,\r\n        entrada: this.form.entrada,\r\n        nometransp: this.form.nometransp,\r\n        motorista: this.form.motorista,\r\n        placa: this.form.placa\r\n      }\r\n    },\r\n    marcasselected() {\r\n      return this.marcas.filter(m=>m.checked);\r\n    },\r\n    romaneios() {\r\n      return this.data.map(r=>({\r\n        id: r.id,\r\n        codTransp: r.Codigo_Transp,\r\n        transp: r.Razao_Social,\r\n        motorista: r.Motorista,\r\n        ultimacoleta: r.UltimaColeta,\r\n        volumes: r.TVolumes,\r\n        coletados: r.TVolumesColetados,\r\n        TPedidos: r.TPedidos,\r\n        perc: r.PercColetados,\r\n        placa: r.Placa,\r\n        sigImage: r.sigImage,\r\n        sigImageConf: r.sigImageConf,\r\n        PercAssinados: r.PercAssinados,\r\n        sigObsConf: r.sigObsConf,\r\n        signed: ((r.sigImage && r.sigImage !== \"\") || (r.sigImageConf && r.sigImageConf !== \"\")) ? true : false,\r\n        Romaneios: r.Romaneios || [],\r\n        collapsed: r.collapsed,\r\n        checked: r.checked,\r\n        Opcoes: r.Opcoes,\r\n        _rowVariant: r.sigImage && r.sigImageConf ? 'success' : ''\r\n      })).filter(f=>this.romaneiosfiltros(f))\r\n      //.filter(f=>f.signed == this.filtroassinados && (f.perc > 99) == this.filtrocoletados )\r\n    },\r\n    paramsignature() {\r\n      return {\r\n        idCarregamento: this.selected.id,\r\n        sigImage: this.sigImage,\r\n        sigImageConf: this.sigImageConf,\r\n        sigObsConf: this.sigObsConf,\r\n        opcoes: JSON.stringify(this.opcoes),\r\n        romaneios: this.selected.Romaneios.filter(r=>r.checked)\r\n      }\r\n    },\r\n    signatureOptions() {\r\n      return this.sigOpcoes.map(o=>({\r\n        text: o.descricao,\r\n        value: o.id\r\n      }))\r\n    },\r\n    selectedchecked() {\r\n      return this.selected.Romaneios ? this.selected.Romaneios.filter(c=>c.checked) : [];\r\n    },\r\n    selectedcheckedlength() {\r\n      return this.selectedchecked.length || 0;\r\n    },\r\n    signatureFields() {\r\n      return {Transportadora: this.selected.transp, Motorista: this.selected.motorista, Placa: this.selected.placa};\r\n    },\r\n    signatureValid() {\r\n      return ((this.sigChange && this.sigImage && this.sigImage !== \"\") || (this.sigChangeConf && this.sigImageConf && this.sigImageConf !== \"\"));\r\n    },\r\n    signatureTitle() {\r\n      return \"Carga: \" + ((this.selected && this.selected.id) || \"\");\r\n    },\r\n    pedidosTitle() {\r\n      return \"Romaneio: \" + ((this.pedidos && this.pedidos[0] && this.pedidos[0].Romaneio) || \"\");\r\n    },\r\n    pedidosNotasSplit() {\r\n      return ((this.pedidos && this.pedidos[0] && this.pedidos[0].Notas && this.pedidos[0].Notas.map(n=>(n.Numero_nota)).join(\",\")) || \"\")\r\n    }\r\n  },\r\n  beforeMount() {\r\n//    this.getCarregamento();\r\n    API.getLocalDBDocument('carregamento').then(doc => {\r\n      this.idCarregamento = doc.idCarregamento || 0;\r\n      this.entrada = doc.entrada || new Date();\r\n      this.nometransp = doc.nometransp ||  \"\";\r\n      this.motorista = doc.motorista ||  \"\";\r\n      this.placa = doc.placa || \"\";\r\n      this.updatetimeout = doc.updatetimeout || this.updatetimeout;\r\n      this.filtroassinados = doc.filtroassinados || this.filtroassinados;\r\n      this.marcas = doc.marcas || this.marcas;\r\n      this.filtro = doc.filtro || this.filtro;\r\n    });\r\n\r\n    this.getCarregamentoOpcoes();\r\n    this.getMarcas();\r\n\r\n    // seta o timer que atualiza os totais ...\r\n    this.updatestop = false;\r\n    this.timer = setInterval(() => {\r\n      if (!this.updatestop)\r\n        this.getCarregamentoTotais();\r\n    }, this.updatetimeout);\r\n\r\n  },\r\n  methods: {\r\n    teste(val) {\r\n      console.log('teste:',val);\r\n      val.collapsed = !val.collapsed;\r\n    },\r\n    romaneiosfiltros(item) {\r\n      // console.log('romaneiosfiltros(item)', item);\r\n      let ret = false;\r\n      const marcas = this.marcas.filter(m => m.checked).map(m => (m.id)) || [];\r\n      //const marcas = []\r\n\r\n      // ret = ((item.signed == this.filtroassinados) && ((item.perc > 99) == this.filtrocoletados));\r\n      ret = ((item.PercAssinados == 100) == this.filtroassinados);\r\n\r\n      if (marcas.length > 0) {\r\n        ret = ret && (item.Romaneios.filter(r => r.Marcas.find(m => marcas.includes(m.id))).length > 0);\r\n      }\r\n\r\n\r\n      if (this.filtro !== \"\") {\r\n        ret = ret && (\r\n          item.id.toString().includes(this.filtro) ||\r\n          item.transp.includes(this.filtro.toUpperCase()) ||\r\n          item.motorista.includes(this.filtro.toUpperCase()) ||\r\n          item.placa.includes(this.filtro.toUpperCase())\r\n        )\r\n      }\r\n\r\n      return ret;\r\n\r\n    },\r\n    marcar(check) {\r\n      if (this.data.find(d=>d.id == this.selected.id)) {\r\n        this.data.find(d=>d.id == this.selected.id).Romaneios.map(r=>{\r\n          r.checked = check\r\n        })\r\n      }\r\n    },\r\n    modalpedidos(pedidos) {\r\n      this.pedidos = pedidos;\r\n      this.$bvModal.show(\"modal-pedidos\");\r\n    },\r\n    getMarcas() {\r\n      API.get(\"v2/Servicos/Marcas/Get\", {pesquisa: \"%\", PageSize: 30 })\r\n      .then((apidata)=>{\r\n        if ((apidata.data.Success == \"True\") || apidata.data.Success) {\r\n          const res = API.prepareData(apidata.data);\r\n          this.marcas = res.apiresponse.Data;\r\n        } else {\r\n          this.marcas = [];\r\n        }\r\n      })\r\n    },\r\n    getCarregamentoOpcoes() {\r\n      API.get(\"v2/Servicos/Carregamento/OpcoesGet\", {})\r\n      .then((apidata)=>{\r\n        if ((apidata.data.Success == \"True\") || apidata.data.Success) {\r\n          const res = API.prepareData(apidata.data);\r\n          this.sigOpcoes = res.apiresponse.Data;\r\n        } else {\r\n          this.sigOpcoes = [];\r\n        }\r\n      })\r\n    },\r\n    getCarregamento() {\r\n      this.updatestop = true;\r\n      API.get(\"v2/Servicos/Carregamento/Get\", this.params)\r\n      .then((apidata)=>{\r\n        if ((apidata.data.Success == \"True\") || apidata.data.Success) {\r\n          const res = API.prepareData(apidata.data);\r\n          this.data = res.apiresponse.Data;\r\n          this.formcollapsed = false;\r\n          API.setLocalDBDocument(this.$data, 'carregamento');\r\n        } else {\r\n          this.data = [];\r\n          this.formcollapsed = true;\r\n        }\r\n      });\r\n    },\r\n    getCarregamentoTotais() {\r\n\r\n      API.get(\"v2/Servicos/CarregamentoTotais/Get\", this.params, false)\r\n      .then((apidata)=>{\r\n        if ((apidata.data.Success == \"True\") || apidata.data.Success) {\r\n          const res = API.prepareData(apidata.data);\r\n\r\n          console.log('getCarregamentoTotais:hit');\r\n\r\n          res.apiresponse.Data.map(t => {\r\n            if (this.data.find(c => c.id == t.id)) {\r\n              this.data.find(c => c.id == t.id).TVolumesColetados = t.TVolumesColetados;\r\n              this.data.find(c => c.id == t.id).PercColetados = t.PercColetados;\r\n              this.data.find(c => c.id == t.id).sigImage = t.sigImage;\r\n\t\t          this.data.find(c => c.id == t.id).sigImageConf = t.sigImageConf;\r\n\t\t          this.data.find(c => c.id == t.id).sigObsConf = t.sigObsConf;\r\n\t\t          this.data.find(c => c.id == t.id).Opcoes = t.Opcoes;\r\n\t\t          this.data.find(c => c.id == t.id).UltimaColeta = t.UltimaColeta;\r\n            }\r\n          })\r\n        }\r\n      })      \r\n    },\r\n    async assinar(item) {\r\n      console.log('assinar.item:', item);\r\n      let perc = item.perc;\r\n\r\n      // sugerido não poder liberar sem estar 100% coletado\r\n      /*\r\n      if (perc < 100) {\r\n        this.$root.toastdanger(\"A carga não está 100% coletada, não é possível solicitar a assinatura !\");\r\n      }\r\n      */\r\n      if (perc < 100) {\r\n        await this.$root\r\n          .showmessage('A carga não está 100% coletada, deseja realmente solicitar a assinatura ?')\r\n          .then((choice)=>{\r\n            if (choice) {\r\n              perc = 100;\r\n            }\r\n          })\r\n      }\r\n\r\n      if (perc > 99.9) {\r\n        // this.selected = item;\r\n        this.doselected(item);\r\n\r\n        const params = {\r\n          idCarregamento: item.id,\r\n          Romaneios: this.selectedchecked.map(r=>(r.Romaneio)).join(',')\r\n        }\r\n        console.log('assinar.params:', params);\r\n\r\n        // busca a assinatuda da API ...\r\n        API.get(\"v2/Servicos/CarregamentoSignature/Get\", params, false)\r\n          .then((apidata) => {\r\n            const res = API.prepareData(apidata.data);\r\n            console.log('res:', res);\r\n            if (res.success && res.data.length>0) {\r\n              const data = res.data[0];\r\n              this.sigImage = data.sigImage || \"\";\r\n              this.sigImageConf = data.sigImageConf || \"\";\r\n              this.sigObsConf = data.sigObsConf || \"\";        \r\n              this.opcoes = JSON.parse(data.Opcoes || \"[]\");\r\n            } else {\r\n              this.sigImage = \"\";\r\n              this.sigImageConf = \"\";\r\n              this.sigObsConf = \"\";        \r\n              this.opcoes = [];\r\n            }\r\n            this.sigChange = false;\r\n            this.sigChangeConf = false;\r\n            \r\n            this.$bvModal.show(\"modal-assinar\");\r\n          });\r\n        /*\r\n        // console.log(\"assinar.opcoes:\", item.Opcoes);\r\n        if (item.Romaneios.find(r=>r.checked)) {\r\n          this.sigImage = item.Romaneios.find(r=>r.checked).sigImage;\r\n          this.sigImageConf = item.Romaneios.find(r=>r.checked).sigImageConf;\r\n          this.sigObsConf = item.Romaneios.find(r=>r.checked).sigObsConf;        \r\n          this.opcoes = JSON.parse(item.Romaneios.find(r=>r.checked).Opcoes || \"[]\");        \r\n        } else {\r\n          this.sigImage = item.sigImage;\r\n          this.sigImageConf = item.sigImageConf;\r\n          this.sigObsConf = item.sigObsConf;        \r\n          this.opcoes = JSON.parse(item.Opcoes || \"[]\"); \r\n        }\r\n        this.sigChange = false;\r\n        this.sigChangeConf = false;\r\n        // console.log(\"assinar.item:\", item);\r\n        this.$bvModal.show(\"modal-assinar\");\r\n        */\r\n      }\r\n    },\r\n    assinarromaneio(carga, romaneio) {\r\n      if (this.data.find(d=>d.id == carga.id)) {\r\n        // desmarca os outros ... \r\n        this.data.find(d=>d.id == carga.id).Romaneios.filter(r=>r.checked).map(m=>m.checked = false);\r\n        if (this.data.find(d=>d.id == carga.id).Romaneios.find(r=>r.Romaneio==romaneio)) {\r\n          this.data.find(d=>d.id == carga.id).Romaneios.find(r=>r.Romaneio==romaneio).checked = true\r\n          this.assinar(carga);\r\n        }\r\n      }\r\n    },\r\n    signatureShown() {\r\n      this.updatestop = true;\r\n    },\r\n    signatureHidden() {\r\n      this.updatestop = false;\r\n    },\r\n    signatureOk() {\r\n      // console.log(\"signatureOk.sigImage:\", this.sigImage);\r\n      API.post(\"v2/Servicos/Carregamento/SignatureSet\", this.paramsignature)\r\n      .then((apidata)=>{\r\n        if ((apidata.data.Success == \"True\") || apidata.data.Success) {\r\n          if (this.data.find(c=>c.id == this.selected.id)) {\r\n            this.data.find(c=>c.id == this.selected.id).sigImage = this.sigImage;\r\n            this.data.find(c=>c.id == this.selected.id).sigImageConf = this.sigImageConf;\r\n            this.data.find(c=>c.id == this.selected.id).sigObsConf = this.sigObsConf;this.data.find(c=>c.id == this.selected.id).Opcoes = JSON.stringify(this.opcoes);\r\n            this.data.find(c=>c.id == this.selected.id).Romaneios.filter(r=>r.checked).map(d=>{\r\n              d.sigImage = this.sigImage;\r\n              d.sigImageConf = this.sigImageConf;\r\n              d.sigObsConf = this.sigObsConf;\r\n              d.Opcoes = JSON.stringify(this.opcoes);\r\n              d.checked = false;\r\n            })\r\n          }\r\n          const res = API.prepareData(apidata.data);\r\n\r\n          this.$root.toastsuccess(res.data[0].Mensagem);\r\n          this.updatestop = false;\r\n\r\n          if ( (!this.sigImage || this.sigImage == \"\") || (!this.sigImageConf || this.sigImageConf == \"\") ) {\r\n            if ( (!this.sigImage || this.sigImage == \"\") ) this.$root.toastdanger('Assinatura do motorista não informada!');\r\n            if ( (!this.sigImageConf || this.sigImageConf == \"\") ) this.$root.toastdanger('Assinatura do conferente não informada!');\r\n          }\r\n        } else {\r\n          this.$root.toastdanger(apidata.Error);\r\n          this.formcollapsed = false;\r\n        }\r\n      });\r\n    },\r\n    doselected(item) {\r\n      this.selected = item;\r\n    },\r\n    classperc(perc) {\r\n      return (perc>99) ? \"success\" : \"primary\";\r\n    },\r\n    classselected(item) {\r\n      return (item.id == this.selected.id) ? \"primary\" : \"\";\r\n    },\r\n    classpedidos(item) {\r\n      return (this.pedidosselected && (item.Pedido == this.pedidosselected.Pedido)) ? \"primary\" : \"\";\r\n    }\r\n  },\r\n  watch: {\r\n    formcollapsed(collapsed) {\r\n      this.updatestop = collapsed;\r\n    },\r\n    updatetimeout() {\r\n      clearInterval(this.timer);\r\n      console.log('updatetimeout:', new Date());\r\n      this.timer = null;\r\n      this.timer = setInterval(() => {\r\n        console.log('Carregamento.timer:', new Date().toLocaleTimeString());\r\n      },  this.runtimeout());\r\n    },\r\n    runtimeout() {\r\n      if (!this.updatestop)\r\n        this.getCarregamentoTotais()\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    this.updatestop = true;\r\n    clearInterval(this.timer);\r\n    this.timer = null;\r\n  }\r\n};\r\n</script>\r\n<style>\r\n.colsalign {\r\n  text-align: right;\r\n}\r\n@media screen and (max-width: 600px) {\r\n  .colsalign {\r\n    text-align: left;\r\n  }\r\n  .lista {\r\n    padding-left: 3px;\r\n    padding-right: 3px;\r\n  }\r\n}\r\n</style>\r\n"]}]}