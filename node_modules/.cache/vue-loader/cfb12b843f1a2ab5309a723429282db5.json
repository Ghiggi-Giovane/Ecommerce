{"remainingRequest":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\k1-services\\src\\pages\\producaoidelli\\views\\conferenciaestoques.vue?vue&type=style&index=0&id=04d0aca2&scoped=true&lang=css&","dependencies":[{"path":"C:\\k1-services\\src\\pages\\producaoidelli\\views\\conferenciaestoques.vue","mtime":1701906516517},{"path":"C:\\k1-services\\node_modules\\css-loader\\dist\\cjs.js","mtime":1670977934642},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1674603024162},{"path":"C:\\k1-services\\node_modules\\postcss-loader\\src\\index.js","mtime":1670977935130},{"path":"C:\\k1-services\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1670977934221},{"path":"C:\\k1-services\\node_modules\\vue-loader\\lib\\index.js","mtime":1674603023821}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZG9jIHsNCiAgbWFyZ2luLXJpZ2h0OiAxMnB4Ow0KICBtYXJnaW4tbGVmdDogMTJweDsNCn0NCg=="},{"version":3,"sources":["conferenciaestoques.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2jBA;AACA;AACA;AACA","file":"conferenciaestoques.vue","sourceRoot":"src/pages/producaoidelli/views","sourcesContent":["<template>\r\n  <div class=\"m-2\">\r\n    <b-card header-bg-variant=\"dark\" header-text-variant=\"white\">\r\n      <template #header>\r\n        <div class=\"d-flex justify-content-between align-bottom\">\r\n          <h4 class=\"mb-0 align-middle\">Conferência de Estoque</h4>\r\n          <b-button v-b-toggle.collapse_deposito variant=\"primary\" size=\"sm\">\r\n            Mudar depósito\r\n            <b-icon-caret-up v-if=\"collapse_deposito\" />\r\n            <b-icon-caret-down v-else />\r\n          </b-button>\r\n        </div>\r\n      </template>\r\n\r\n      <b-collapse id=\"collapse_deposito\" v-model=\"collapse_deposito\">\r\n        <b-row>\r\n          <b-col cols=\"12\" md=\"6\">\r\n            <b-form-group label=\"Empresa\" label-for=\"input-empresa\">\r\n              <b-form-select\r\n                v-model=\"selected.empresa\"\r\n                :options=\"empresas\"\r\n                text-field=\"Reduzido\"\r\n                value-field=\"Codigo\"\r\n              >\r\n              </b-form-select>\r\n            </b-form-group>\r\n          </b-col>\r\n\r\n          <b-col cols=\"12\" md=\"6\">\r\n            <b-form-group label=\"Depósito\" label-for=\"input-dep\">\r\n              <b-form-select\r\n                :disabled=\"selected.empresa == 0\"\r\n                v-model=\"selected.deposito\"\r\n                :options=\"depositosList\"\r\n                text-field=\"Descricao\"\r\n                value-field=\"Codigo\"\r\n              >\r\n              </b-form-select>\r\n            </b-form-group>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row class=\"ml-3 mr-3\">\r\n          <b-input-group label=\"Item\" label-for=\"input-item\">\r\n            <template #append>\r\n              <b-button\r\n                :disabled=\"selected.item == ''\"\r\n                variant=\"outline-success\"\r\n                @click=\"buscarItem\"\r\n                >Buscar</b-button\r\n              >\r\n            </template>\r\n            <b-form-input\r\n              :disabled=\"selected.empresa == 0 || selected.deposito == 0\"\r\n              v-model=\"selected.item\"\r\n            >\r\n            </b-form-input>\r\n          </b-input-group>\r\n        </b-row>\r\n      </b-collapse>\r\n    </b-card>\r\n\r\n    <b-card\r\n      header-bg-variant=\"dark\"\r\n      header-text-variant=\"white\"\r\n      v-if=\"resItem.length != 0\"\r\n    >\r\n      <template #header>\r\n        <div class=\"d-flex justify-content-between align-bottom\">\r\n          <h5 class=\"mb-0 align-middle\">\r\n            {{ resItem.Item }} - {{ resItem.Descricao }}\r\n          </h5>\r\n        </div>\r\n      </template>\r\n      <div>\r\n        <b-row>\r\n          <b-col>\r\n            <h5>Estoque: {{ resItem.Estoque | ptBR }}</h5>\r\n          </b-col>\r\n          <b-col>\r\n            <h5>Unidade Medida: {{ resItem.UnidadeMedida }}</h5>\r\n          </b-col>\r\n        </b-row>\r\n        <b-row>\r\n          <b-col>\r\n            <h5>Fator de Conversão: {{ resItem.Fator_Conversao | ptBR }}</h5>\r\n          </b-col>\r\n          <b-col>\r\n            <h5>Empenho: {{ resItem.Empenho | ptBR }}</h5>\r\n          </b-col>\r\n        </b-row>\r\n\r\n        <b-row>\r\n          <b-col>\r\n            <b-form-group label=\"PNP\" label-for=\"input-item\">\r\n              <b-form-input v-model=\"pnp\"> </b-form-input>\r\n            </b-form-group>\r\n          </b-col>\r\n          <b-col>\r\n            <b-form-group label=\"PNF \" label-for=\"input-item\">\r\n              <b-form-input v-model=\"pnf\"> </b-form-input>\r\n            </b-form-group>\r\n          </b-col>\r\n        </b-row>\r\n      </div>\r\n    </b-card>\r\n    <b-card v-if=\"resItem.length != 0\">\r\n      <div class=\"doc\">\r\n        <b-row style=\"justify-content: space-between\">\r\n          <h3>Contagens</h3>\r\n          <div>\r\n            <b-row>\r\n              <h4 class=\"iconbutton mr-3\" @click=\"showModalContagens\">\r\n                <b-icon-plus-square variant=\"success\"></b-icon-plus-square>\r\n              </h4>\r\n            </b-row>\r\n          </div>\r\n        </b-row>\r\n      </div>\r\n      <b-table\r\n        foot-clone\r\n        no-footer-sorting\r\n        id=\"table-depositos-itens\"\r\n        head-variant=\"dark\"\r\n        sort\r\n        striped\r\n        bordered\r\n        hovers\r\n        responsive\r\n        small\r\n        select-mode=\"single\"\r\n        :items=\"contagem\"\r\n        :fields=\"fields\"\r\n      >\r\n        <template #cell(actions)=\"row\">\r\n          <b-icon-trash\r\n            class=\"text-center\"\r\n            font-scale=\"1.5\"\r\n            @click=\"deleteContagem(row.item)\"\r\n          ></b-icon-trash>\r\n        </template>\r\n        <template #cell(Resultado)=\"row\">\r\n          {{\r\n            (row.item.Quantidade.reduce(\r\n              (a, b) => parseFloat(a) + parseFloat(b),\r\n              0\r\n            ) *\r\n              row.item.Multiplicador *\r\n              row.item.FatorConversao)\r\n              | ptBR\r\n          }}\r\n        </template>\r\n\r\n        <template #foot()>\r\n          <div></div>\r\n        </template>\r\n        <template #foot(Quantidade)>\r\n          <div>Total: {{ soma | ptBR }}</div>\r\n        </template>\r\n      </b-table>\r\n    </b-card>\r\n\r\n    <b-card\r\n      header-bg-variant=\"dark\"\r\n      header-text-variant=\"white\"\r\n      v-if=\"resItem.length != 0\"\r\n    >\r\n      <template #header>\r\n        <div class=\"d-flex justify-content-between align-bottom\">\r\n          <h5 class=\"mb-0 align-middle\">Resultado</h5>\r\n        </div>\r\n      </template>\r\n      <div>\r\n        <b-row\r\n          style=\"\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n          \"\r\n        >\r\n          <h5>Resultado: {{ resultado | ptBR }}</h5>\r\n          <div>\r\n            <b-button\r\n              v-for=\"action in buttonActions\"\r\n              :key=\"action.action\"\r\n              size=\"sm\"\r\n              class=\"m-1\"\r\n              :variant=\"action.variant\"\r\n              @click=\"buttonActionClick(action.action)\"\r\n            >\r\n              {{ action.text }}\r\n            </b-button>\r\n          </div>\r\n        </b-row>\r\n        <!-- <div class=\"mt-3\">\r\n          <b-button-group>\r\n            <b-button>Button 1</b-button>\r\n            <b-button>Button 2</b-button>\r\n            <b-button>Button 3</b-button>\r\n          </b-button-group>\r\n        </div> -->\r\n      </div>\r\n    </b-card>\r\n    <br />\r\n\r\n    <!--  MODAIS -->\r\n    <b-modal\r\n      centered\r\n      id=\"modal-itens\"\r\n      ref=\"modal\"\r\n      title=\"Adicionar quantidade\"\r\n      @hidden=\"resetModal\"\r\n      @ok=\"handleOk\"\r\n    >\r\n      <form ref=\"form\" @submit.stop.prevent=\"handleSubmit\">\r\n        <label>Quantidade</label>\r\n        <b-form-group\r\n          :state=\"nameState\"\r\n          invalid-feedback=\"Necessário informar uma quantidade\"\r\n        >\r\n          <b-form-tags\r\n            v-model=\"qtde\"\r\n            size=\"sm\"\r\n            required\r\n            placeholder=\"Adicionar quantidades\"\r\n            :state=\"nameState\"\r\n          ></b-form-tags>\r\n        </b-form-group>\r\n\r\n        <label>Multiplicador</label>\r\n        <b-form-input v-model=\"multiplicador\" size=\"sm\" required></b-form-input>\r\n        <label>Fator de conversão</label>\r\n        <b-form-input v-model=\"fConversao\" size=\"sm\" required></b-form-input>\r\n      </form>\r\n    </b-modal>\r\n\r\n    <b-modal\r\n      id=\"modal-prevent-closing\"\r\n      ref=\"modal\"\r\n      title=\"Justificativa para acerto de estoque\"\r\n      @show=\"resetModal2\"\r\n      @hidden=\"resetModal2\"\r\n      @ok=\"handleOk2\"\r\n    >\r\n      <form ref=\"form\" @submit.stop.prevent=\"handleSubmit2\">\r\n        <b-form-group\r\n          label=\"Justificativa\"\r\n          label-for=\"name-input\"\r\n          invalid-feedback=\"Campo obrigatório\"\r\n          :state=\"nameState\"\r\n        >\r\n          <b-form-input\r\n            id=\"name-input\"\r\n            v-model=\"name\"\r\n            :state=\"nameState\"\r\n            required\r\n          ></b-form-input>\r\n        </b-form-group>\r\n      </form>\r\n    </b-modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport ApiService from \"../../../services/api.service\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      log: [],\r\n      collapse_deposito: true,\r\n      nameState: null,\r\n\r\n      qtde: [],\r\n      multiplicador: 1,\r\n      fConversao: 0,\r\n      // empenhoFisico: 0,\r\n      pnp: 0,\r\n      pnf: 0,\r\n\r\n      name: \"\",\r\n      nameState: null,\r\n      justificativa: \"\",\r\n\r\n      selected: {\r\n        empresa: 8,\r\n        deposito: null,\r\n        item: \"\",\r\n      },\r\n\r\n      fields: [\r\n        { key: \"Quantidade\", label: \"Quantidade\", visible: true },\r\n        { key: \"Multiplicador\", label: \"Multiplicador\", visible: true },\r\n        { key: \"FatorConversao\", label: \"Fator de Conversão\", visible: true },\r\n        { key: \"Resultado\", label: \"Resultado\", visible: true },\r\n        { key: \"actions\", label: \"Ações\", visible: true },\r\n      ],\r\n\r\n      resItem: [],\r\n\r\n      contagem: [],\r\n      contagemNew: [],\r\n\r\n      empresas: [],\r\n      depositos: [],\r\n\r\n      buttonActions: [\r\n        { text: \"Aguardar\", action: 1, variant: \"\" },\r\n        { text: \"Conferência\", action: 2, variant: \"success\" },\r\n        { text: \"Acerta estoque\", action: 3, variant: \"danger\" },\r\n      ],\r\n    };\r\n  },\r\n\r\n  created() {\r\n    this.buscaParametros();\r\n  },\r\n\r\n  computed: {\r\n    depositosList() {\r\n      return this.depositos.filter(\r\n        (dep) => dep.Empresa == this.selected.empresa\r\n      );\r\n    },\r\n\r\n    soma() {\r\n      return this.contagem.reduce(\r\n        (a, b) =>\r\n          a +\r\n          b.Quantidade.reduce((a, b) => parseFloat(a) + parseFloat(b), 0) *\r\n            b.Multiplicador *\r\n            b.FatorConversao,\r\n        0\r\n      );\r\n    },\r\n\r\n    resultado() {\r\n      return (\r\n        parseFloat(this.soma) +\r\n        parseFloat(this.pnp) -\r\n        parseFloat(this.pnf) -\r\n        parseFloat(this.resItem.Estoque)\r\n      );\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    async buscaParametros() {\r\n      await ApiService.get(\"v2/AppConferenciaEstoque/Empresas/Get\").then(\r\n        (res) => {\r\n          this.empresas = res.data.Data;\r\n        }\r\n      );\r\n      await ApiService.get(\"v2/AppConferenciaEstoque/Depositos/Get\").then(\r\n        (res) => {\r\n          this.depositos = res.data.Data;\r\n        }\r\n      );\r\n    },\r\n\r\n    async buscarItem() {\r\n      this.contagem = [];\r\n      this.empenhoFisico = 0;\r\n      await ApiService.get(\"v2/AppConferenciaEstoque/ConsultaItem/Get\", {\r\n        empresa: this.selected.empresa,\r\n        deposito: this.selected.deposito,\r\n        item: this.selected.item,\r\n      }).then((res) => {\r\n        this.resItem = res.data.Data;\r\n        this.fConversao = this.resItem.Fator_Conversao;\r\n\r\n        if (res.data.Data.Aguardando != null) {\r\n          var confirm = window.confirm(\r\n            \"Existe uma Coferência aguardando continuidade.\\nPara continuar a conferência existente clique em OK, caso contrário em CANCELAR\"\r\n          );\r\n\r\n          if (confirm) {\r\n            var itens = this.resItem.Aguardando[0].Contagens;\r\n            this.empenhoFisico = this.resItem.Aguardando[0].EmpenhoFisico;\r\n            this.pnp = this.resItem.Aguardando[0].Pnp;\r\n            this.pnf = this.resItem.Aguardando[0].Pnf;\r\n\r\n            var qtdes = [];\r\n\r\n            itens.forEach((element) => {\r\n              qtdes = [];\r\n              element.Log.forEach((log) => {\r\n                qtdes.push(log.Quantidade);\r\n              });\r\n\r\n              this.contagem.push({\r\n                Id: element.Id,\r\n                Quantidade: qtdes,\r\n                FatorConversao: element.FatorConversao,\r\n                Multiplicador: element.Multiplicador,\r\n              });\r\n            });\r\n          }\r\n          // VER COMO FAZER PARA SALVAR SEMPRE A ULTIMA\r\n          else {\r\n            this.resItem.Aguardando = null;\r\n          }\r\n        }\r\n        console.log(\"ResItem: \", this.resItem);\r\n        this.evtDepositoChange();\r\n      });\r\n    },\r\n\r\n    evtDepositoChange() {\r\n      this.collapse_deposito = !this.collapse_deposito;\r\n    },\r\n\r\n    deleteContagem(item) {\r\n      const index = this.contagem.indexOf(item);\r\n      if (index > -1) {\r\n        this.contagem.splice(index, 1);\r\n      }\r\n    },\r\n\r\n    async salvaRegistroApi() {\r\n      console.log(this.log);\r\n      await ApiService.post(\r\n        \"v2/AppConferenciaEstoque/Conferencias/Save\",\r\n        this.log\r\n      )\r\n        .then((result) => {\r\n          this.$root.toastsuccess(\"Conferência salva com Sucesso!\");\r\n        })\r\n        .catch((e) => {\r\n          this.$root.toastddanger(e);\r\n        });\r\n    },\r\n\r\n    async AjustaConfereEstoque(acao) {\r\n      // Ação 1 Conferencia, ação 2 ajuste de estoque!\r\n      await ApiService.post(\"v2/AppConferenciaEstoque/AjustaConfere/Post\", {\r\n        acao: acao,\r\n        log: this.log,\r\n      })\r\n        .then((result) => {\r\n          this.$root.toastsuccess(\"Ajuste/Conferência feito com sucesso!\");\r\n        })\r\n        .catch((e) => {\r\n          this.$root.toastddanger(e);\r\n        });\r\n    },\r\n\r\n    async buttonActionClick(action) {\r\n      console.log(action);\r\n\r\n      this.log = {\r\n        id: this.resItem.Aguardando ? this.resItem.Aguardando[0].Id : null,\r\n        item: this.selected.item,\r\n        deposito: this.selected.deposito,\r\n        empenhoFisico: null,\r\n        pnp: this.pnp,\r\n        pnf: this.pnf,\r\n        contagens: this.contagem,\r\n        resultado: this.resultado,\r\n        totalContagens: this.soma,\r\n        estoque: this.resItem.Estoque,\r\n      };\r\n\r\n      if (action != 3) {\r\n        const confirm = window.confirm(\r\n          \"Você tem certeza que deseja continuar?\"\r\n        );\r\n\r\n        if (confirm) {\r\n          if (action == 1) {\r\n            console.log(\"Aguardar: \", this.log);\r\n            this.log.aguardando = 1;\r\n          } else {\r\n            console.log(\"Conferência: \", this.log);\r\n            this.log.aguardando = 0;\r\n            //ação confere estoque\r\n            this.AjustaConfereEstoque(1);\r\n          }\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.salvaRegistroApi();\r\n      } else {\r\n        this.log.aguardando = 0;\r\n        this.$root.$emit(\r\n          \"bv::show::modal\",\r\n          \"modal-prevent-closing\",\r\n          \"#btnShow\"\r\n        );\r\n      }\r\n    },\r\n\r\n    /* Modais */\r\n\r\n    showModalContagens() {\r\n      this.$root.$emit(\"bv::show::modal\", \"modal-itens\", \"#btnShow\");\r\n    },\r\n    checkformValidity() {\r\n      const valid = this.qtde.length > 0;\r\n      this.nameState = valid;\r\n      return valid;\r\n    },\r\n    resetModal() {\r\n      this.qtde = \"\";\r\n      this.multiplicador = 1;\r\n    },\r\n    handleOk(bvModalEvent) {\r\n      // Prevent modal from closing\r\n      bvModalEvent.preventDefault();\r\n      // Trigger submit handler\r\n      if (!this.checkformValidity()) {\r\n        return;\r\n      } else {\r\n        this.handleSubmit();\r\n      }\r\n    },\r\n\r\n    async handleSubmit() {\r\n      this.contagem.push({\r\n        Quantidade: this.qtde,\r\n        FatorConversao: this.fConversao,\r\n        Multiplicador: this.multiplicador,\r\n      });\r\n\r\n      this.resetModal();\r\n\r\n      this.$nextTick(() => {\r\n        this.$bvModal.hide(\"modal-itens\");\r\n      });\r\n    },\r\n\r\n    checkFormValidity2() {\r\n      const valid = this.$refs.form.checkValidity();\r\n      this.nameState = valid;\r\n      return valid;\r\n    },\r\n    resetModal2() {\r\n      this.name = \"\";\r\n      this.nameState = null;\r\n    },\r\n    handleOk2(bvModalEvent) {\r\n      // Prevent modal from closing\r\n      bvModalEvent.preventDefault();\r\n      // Trigger submit handler\r\n      this.handleSubmit2();\r\n    },\r\n    async handleSubmit2() {\r\n      // Exit when the form isn't valid\r\n      if (!this.checkFormValidity2()) {\r\n        return;\r\n      }\r\n      // Push the name to submitted names\r\n      this.justificativa = this.name;\r\n      this.log.justificativa = this.justificativa.toUpperCase();\r\n\r\n      this.salvaRegistroApi();\r\n      // Ação ajusta estoque.\r\n\r\n      await this.AjustaConfereEstoque(2).then(() =>\r\n        this.AjustaConfereEstoque(1)\r\n      );\r\n\r\n      // Hide the modal manually\r\n      this.$nextTick(() => {\r\n        this.$bvModal.hide(\"modal-prevent-closing\");\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style scoped>\r\n.doc {\r\n  margin-right: 12px;\r\n  margin-left: 12px;\r\n}\r\n</style>\r\n"]}]}